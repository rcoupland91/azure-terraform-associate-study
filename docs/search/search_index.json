{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"00-Getting-Started/","title":"Getting Started with Terraform Associate Prep","text":""},{"location":"00-Getting-Started/#what-youll-learn","title":"What you'll learn","text":"<ul> <li>Understand the structure of this study guide and how to navigate topic domains.</li> <li>Review Terraform basics, including workflow and core concepts.</li> <li>Identify key certification resources and study habits.</li> </ul>"},{"location":"00-Getting-Started/#topics","title":"Topics","text":"<ul> <li>Intro to Terraform</li> <li>Automating azure Deployments with Terraform</li> <li>Troubleshooting and Debugging Terraform</li> </ul>"},{"location":"00-Getting-Started/#cheat-sheet","title":"Cheat sheet","text":"<ul> <li>Terraform workflow: <code>write</code> \u279c <code>plan</code> \u279c <code>apply</code>.</li> <li>Core files: <code>main.tf</code>, <code>variables.tf</code>, <code>outputs.tf</code>.</li> <li>CLI help: <code>terraform &lt;command&gt; -help</code> for usage examples.</li> </ul>"},{"location":"00-Getting-Started/#official-documentation","title":"Official documentation","text":"<ul> <li>Terraform Overview</li> <li>Terraform CLI Documentation</li> <li>Terraform Language Documentation</li> </ul>"},{"location":"00-Getting-Started/#hands-on-task","title":"Hands-on task","text":"<p>Run the following commands in an empty directory: <pre><code>terraform init\nterraform fmt\nterraform version\n</code></pre></p>"},{"location":"00-Getting-Started/01-intro-to-terraform/","title":"Introduction to Terraform","text":"<p>Terraform is an open-source Infrastructure as Code (IaC) tool developed by HashiCorp. It lets you define, provision, and manage infrastructure using simple configuration files instead of clicking through cloud consoles.</p> <p>Terraform works across multiple cloud providers, but in this repository, the main focus is on Azure, since it\u2019s the most widely used platform in real-world DevOps and Cloud Engineering projects.</p> <p>This document provides a practical introduction to Terraform \u2014 what it is, how it works, and why it\u2019s essential for anyone building and managing modern cloud infrastructure.</p>"},{"location":"00-Getting-Started/01-intro-to-terraform/#why-infrastructure-as-code-matters","title":"Why Infrastructure as Code Matters","text":"<p>Infrastructure as Code (IaC) allows engineers to manage infrastructure the same way developers manage application code \u2014 using files that can be versioned, tested, and deployed automatically.</p> <p>Key Benefits of IaC:</p> <ul> <li>Automation: Removes manual setup and configuration, reducing human error.</li> <li>Consistency: Reproducible environments every time (\u201cit works on my machine\u201d no longer applies).</li> <li>Version Control: Track and roll back infrastructure changes through Git just like source code.</li> <li>Cost and Time Savings: Less time managing servers manually \u2192 more time building reliable systems.</li> </ul>"},{"location":"00-Getting-Started/01-intro-to-terraform/#terraform-core-workflow","title":"Terraform Core Workflow","text":"<p>Terraform follows a straightforward workflow:</p> <ol> <li>Write: Define your infrastructure in <code>.tf</code> files using the HashiCorp Configuration Language (HCL).</li> <li>Initialize: Download required providers and modules.</li> </ol> <p><pre><code>terraform init\n</code></pre> 3. Plan: Preview what Terraform will change before applying.</p> <p><pre><code>terraform plan\n</code></pre> 4. Apply: Build or update your infrastructure to match the configuration.</p> <p><pre><code>terraform apply\n</code></pre> 5. Destroy: Clean up when you\u2019re done.</p> <pre><code>terraform destroy\n</code></pre> <p>This workflow makes Terraform a powerful tool for both production infrastructure and lab or sandbox automation.</p>"},{"location":"00-Getting-Started/01-intro-to-terraform/#managing-azure-services-with-terraform","title":"Managing Azure Services with Terraform","text":"<p>Terraform connects to Azure through the AzureRM provider \u2014 a plugin that exposes all Azure resources (Virtual machines, Storage Accounts, VNETs, Keyvaults, etc.) to Terraform.</p> <p>Example provider setup:</p> <pre><code>provider \"azurerm\" {\n resource_provider_registrations = \"none\"\n subscription_id                 = local.subscription_id\n tenant_id                       = var.tenant_id\n features {}\n}\n</code></pre> <p>Example: Provisioning a Keyvault Instance</p> <pre><code>resource \"azurerm_key_vault\" \"example\" {\n  name                        = \"examplekeyvault\"\n  location                    = \"uksouth\"\n  resource_group_name         = \"testresourcegroup\"\n  tenant_id                   = \"29334838934093843894328\" #test tenant ID\n}\n</code></pre> <p>This small configuration defines and deploys a basic keyvault instance automatically \u2014 no console clicks required.</p>"},{"location":"00-Getting-Started/01-intro-to-terraform/#azure-resources-managed-with-terraform","title":"Azure Resources Managed with Terraform","text":"<ul> <li>Virtual Machines</li> <li>Storage Accounts</li> <li>Key Vaults</li> <li>VNETs and Subnets</li> <li>NSGs</li> <li>Function Apps</li> <li>SQL MI</li> <li>Frontdoor/Application Gateways</li> </ul>"},{"location":"00-Getting-Started/01-intro-to-terraform/#terraform-configuration-language-hcl-basics","title":"Terraform Configuration Language (HCL) Basics","text":"<p>Terraform\u2019s HCL (HashiCorp Configuration Language) is declarative \u2014 you describe what you want, and Terraform figures out how to get there.</p> <p>Core building blocks:</p> <ul> <li>Provider: Connects Terraform to a cloud or platform (like AzureRM).</li> <li>Resource: Represents infrastructure components (e.g., VM, Storage Account).</li> <li>Variable: Adds flexibility by letting you reuse values.</li> <li>Output: Displays key information after deployment (e.g., public IPs).</li> </ul> <p>Example with a variable:</p> <pre><code>variable \"location\" {\n  description = \"Location of Keyvault\"\n  default     = \"uksouth\"\n}\n\nresource \"azurerm_key_vault\" \"example\" {\n  name                        = \"examplekeyvault\"\n  location                    = var.location\n  resource_group_name         = \"testresourcegroup\"\n  tenant_id                   = \"29334838934093843894328\" #test tenant ID\n}\n</code></pre>"},{"location":"00-Getting-Started/01-intro-to-terraform/#file-structure-overview","title":"File Structure Overview","text":"<p>A typical Terraform configuration includes:</p> <ul> <li><code>provider.tf</code> \u2013 provider setup (AzureRM, etc.)</li> <li><code>variables.tf</code> \u2013 declared variables</li> <li><code>main.tf</code> \u2013 main infrastructure resources</li> <li><code>outputs.tf</code> \u2013 key output values (IP addresses, URLs, etc.)</li> </ul>"},{"location":"00-Getting-Started/01-intro-to-terraform/#practice-questions","title":"Practice Questions","text":""},{"location":"00-Getting-Started/01-intro-to-terraform/#question-1","title":"Question 1","text":"<p>What is Infrastructure as Code (IaC)? A) Writing infrastructure documentation in code format B) Managing infrastructure through configuration files instead of manual processes C) Using code to test infrastructure D) Converting infrastructure diagrams to code</p> Show Answer Answer: **B** - IaC is the practice of managing infrastructure through declarative configuration files that can be versioned, tested, and automated, rather than manual console clicks or scripts."},{"location":"00-Getting-Started/01-intro-to-terraform/#question-2","title":"Question 2","text":"<p>Which Terraform command downloads provider plugins and initializes the backend? A) <code>terraform plan</code> B) <code>terraform apply</code> C) <code>terraform init</code> D) <code>terraform validate</code></p> Show Answer Answer: **C** - `terraform init` initializes the working directory, downloads providers, sets up the backend, and installs modules."},{"location":"00-Getting-Started/01-intro-to-terraform/#question-3","title":"Question 3","text":"<p>What does HCL stand for in Terraform? A) HashiCorp Command Language B) HashiCorp Configuration Language C) HashiCorp Cloud Language D) HashiCorp Coding Language</p> Show Answer Answer: **B** - HCL stands for HashiCorp Configuration Language, the declarative language used to write Terraform configurations."},{"location":"00-Getting-Started/01-intro-to-terraform/#conclusion","title":"Conclusion","text":"<p>Terraform bridges the gap between infrastructure and automation. It helps teams move faster, stay consistent, and version everything from compute to networking.</p> <p>In this repo, you'll find guided labs and examples \u2014 starting simple and progressing toward advanced automation with workspaces, backends, and CI/CD integration \u2014 all built around real Azure use cases.</p>"},{"location":"00-Getting-Started/02-automating-azure-deployments-with-terraform/","title":"Automating Azure Deployments with Terraform","text":""},{"location":"00-Getting-Started/02-automating-azure-deployments-with-terraform/#learning-objectives","title":"Learning Objectives","text":"<ul> <li>Understand how to integrate Terraform with CI/CD pipelines.</li> <li>Learn GitHub Actions workflow for Terraform automation.</li> <li>Master OIDC authentication for secure Azure access.</li> <li>Apply best practices for automated infrastructure deployments.</li> </ul>"},{"location":"00-Getting-Started/02-automating-azure-deployments-with-terraform/#1-storing-terraform-state-securely-storage-account-backend-resource-lock","title":"1. Storing Terraform State Securely (Storage Account Backend, resource Lock)","text":"<p>Note: This topic is covered in detail in Section 01 - State Management. This is a quick reference for CI/CD contexts.</p> <p>For teams, store Terraform state remotely in Azure Storage Account for durability.</p> <p>Quick Reference: - Create Storage Account with versioning enabled - Configure backend in <code>terraform</code> block (see Section 01 for details) - Ensure permissions for Storage Account (Get/Put/List)</p>"},{"location":"00-Getting-Started/02-automating-azure-deployments-with-terraform/#2-cicd-pipeline-setup-with-github-actions","title":"2. CI/CD Pipeline Setup with GitHub Actions","text":"<p>Concept: Automate Terraform workflows in CI/CD using GitHub Actions or Azure Devops Pipelines. Trigger on push/pull requests for <code>plan</code>, and on merge for <code>apply</code>. Use App Registrations for secure Azure access without long-lived credentials. (Federated credentials)</p> <p>Example: GitHub Actions Workflow (.github/workflows/terraform.yml)</p> <pre><code>name: Terraform CI/CD\n\non:\n  push:\n    branches: [main]\n  pull_request:\n    branches: [main]\n\njobs:\n  terraform:\n    runs-on: ubuntu-latest\n    permissions:\n      id-token: write\n      contents: read\n\n    steps:\n      - uses: actions/checkout@v4\n\n      - name: Azure Login (OIDC) \n        uses: azure/login@v2 \n        with: \n          client-id: ${{ secrets.AZURE_CLIENT_ID }} \n          tenant-id: ${{ secrets.AZURE_TENANT_ID }} \n          subscription-id: ${{ secrets.AZURE_SUBSCRIPTION_ID }}\n\n      - name: Setup Terraform\n        uses: hashicorp/setup-terraform@v3\n        with:\n          terraform_version: 1.12.0\n\n      - name: Terraform Init\n        run: terraform init\n\n      - name: Terraform Validate\n        run: terraform validate\n\n      - name: Terraform Plan\n        if: github.event_name == 'pull_request'\n        run: terraform plan -out=plan.tfout\n\n      - name: Terraform Apply\n        if: github.event_name == 'push' &amp;&amp; github.ref == 'refs/heads/main'\n        run: terraform apply -auto-approve\n</code></pre> <p>Example: GitHub Actions Workflow (.github/workflows/terraform.yml)</p> <pre><code>trigger:\n  branches:\n    include:\n      - main\n\npr:\n  branches:\n    include:\n      - main\n\npool:\n  vmImage: ubuntu-latest\n\nvariables:\n  TF_VERSION: '1.12.0'\n\nsteps:\n  - checkout: self\n\n  # Authenticate to Azure using the Service Connection\n  - task: AzureCLI@2\n    displayName: \"Azure Login\"\n    inputs:\n      azureSubscription: \"My-Azure-Service-Connection\"   # Name of your service connection\n      scriptType: bash\n      scriptLocation: inlineScript: |\n        echo \"Logged into Azure\"\n\n  - task: TerraformInstaller@1\n    displayName: \"Install Terraform\"\n    inputs:\n      terraformVersion: $(TF_VERSION)\n\n  - script: terraform init\n    displayName: \"Terraform Init\"\n\n  - script: terraform validate\n    displayName: \"Terraform Validate\"\n\n  - script: terraform plan -out plan.tfout\n    displayName: \"Terraform Plan\"\n    condition: eq(variables['Build.Reason'], 'PullRequest')\n\n  - script: terraform apply -auto-approve\n    displayName: \"Terraform Apply\"\n    condition: and(succeeded(), eq(variables['Build.SourceBranch'], 'refs/heads/main'))\n</code></pre> <p>Key Points: - Use OIDC trust policy in Azure App Reg for GitHub. - Plan on PRs for review; apply on main merges. - Store outputs/secrets securely in GitHub repo settings.</p> <p>Best Practice: - Require PR approvals before merge. - Use workspaces for env separation (dev/prod). - Add notifications (e.g., Slack/MS Teams) on failures.</p>"},{"location":"00-Getting-Started/02-automating-azure-deployments-with-terraform/#3-lab-exercise","title":"3. Lab Exercise","text":"<ol> <li>Create Storage Account in Azure.  </li> <li>Configure Terraform backend in your .tf file.  </li> <li>Run <code>terraform init</code> to migrate state to Azure Storage Account.  </li> <li>Set up GitHub repo with the workflow YAML.  </li> <li>Push changes and observe plan/apply in Actions tab.  </li> <li>Clean up: <code>terraform destroy</code>.</li> </ol>"},{"location":"00-Getting-Started/02-automating-azure-deployments-with-terraform/#4-key-takeaways","title":"4. Key Takeaways","text":"<ul> <li>Secure State: Storage Account for storage, Resource group locksprevents corruption.  </li> <li>Automation: GitHub Actions for safe, automated deployments.  </li> <li>Security: Use OIDC over access keys.</li> </ul>"},{"location":"00-Getting-Started/02-automating-azure-deployments-with-terraform/#5-practice-questions","title":"5. Practice Questions","text":""},{"location":"00-Getting-Started/02-automating-azure-deployments-with-terraform/#question-1","title":"Question 1","text":"<p>In a GitHub Actions workflow, what is the recommended method for authenticating to Azure? A) Hardcode Azure credentials in the workflow file B) Store credentials as GitHub Secrets C) Use OIDC to assume an Azure role/App Reg D) Use the Azure CLI default profile</p> Show Answer Answer: **C** - OIDC (OpenID Connect) allows GitHub Actions to assume Azure roles without storing long-lived credentials. This is more secure than storing access keys as secrets."},{"location":"00-Getting-Started/02-automating-azure-deployments-with-terraform/#question-2","title":"Question 2","text":"<p>What should a Terraform CI/CD pipeline do on pull requests? A) Run <code>terraform apply</code> automatically B) Run <code>terraform plan</code> to show what would change C) Run <code>terraform destroy</code> to clean up D) Skip Terraform validation</p> Show Answer Answer: **B** - On pull requests, run `terraform plan` to preview changes without applying them. Apply should only happen on merge to main/master after review."},{"location":"00-Getting-Started/03-troubleshooting-and-debugging-terraform/","title":"Troubleshooting and Debugging Terraform","text":""},{"location":"00-Getting-Started/03-troubleshooting-and-debugging-terraform/#learning-objectives","title":"Learning Objectives","text":"<ul> <li>Identify common Terraform error categories and their solutions.</li> <li>Learn debugging techniques using TF_LOG and other tools.</li> <li>Understand how to resolve state-related issues.</li> <li>Master state manipulation commands for fixing issues.</li> </ul>"},{"location":"00-Getting-Started/03-troubleshooting-and-debugging-terraform/#1-overview","title":"1. Overview","text":"<p>Terraform errors usually fall into a few buckets:</p> <ul> <li>Backend/state problems (Storage Accounts, resource locks)</li> <li>Auth/provider problems (Azure creds, region, profile)</li> <li>Drift or \u201cresource already exists\u201d problems</li> <li>Bad config problems (syntax, wrong refs, cycles)</li> <li>Provisioner / apply-time problems</li> </ul> <p>This section gives you a fast way to figure out which bucket you\u2019re in, and what to run first.</p>"},{"location":"00-Getting-Started/03-troubleshooting-and-debugging-terraform/#2-turn-on-logging-first-thing","title":"2. Turn on Logging (First Thing)","text":"<p>When Terraform is being vague, turn on TF_LOG.</p> <p>Linux/macOS:</p> <pre><code>export TF_LOG=DEBUG\nexport TF_LOG_PATH=terraform.log\nterraform apply\n</code></pre> <p>Windows (PowerShell):</p> <pre><code>$env:TF_LOG=\"DEBUG\"\n$env:TF_LOG_PATH=\"terraform.log\"\nterraform apply\n</code></pre> <p>After that, check <code>terraform.log</code> in the current folder. Turn it off when done:</p> <pre><code>unset TF_LOG\n</code></pre>"},{"location":"00-Getting-Started/03-troubleshooting-and-debugging-terraform/#3-common-error-error-loading-state-accessdenied-azure-storage-account-backend","title":"3. Common Error: \"Error loading state: AccessDenied\" (Azure Storage Account backend)","text":"<p>What it means: - Terraform tried to read/write state to the Storage Account and Azure blocked it. - Usually wrong azure app reg attempting to access with wrong perms, wrong storage account</p> <p>Checklist:</p> <ol> <li>Check AzureRM tfstate name in backend:</li> </ol> <pre><code>backend \"azurerm\" {\n resource_group_name  = \"testrg\"\n storage_account_name = \"testtfstatesa\"\n container_name       = \"test-tfstate\"\n key = \"testfile.tfstate\"\n\n}\n</code></pre> <ol> <li>Confirm your App Reg has correct RBAC perms :</li> <li>store</li> <li>read</li> <li>lock</li> <li>update</li> </ol> <p>If your pipeline fails with: Error loading state: AccessDenied: Access Denied Your next step is: enable TF_LOG=DEBUG and re-run \u2014 not \u201cterraform login.\u201d</p>"},{"location":"00-Getting-Started/03-troubleshooting-and-debugging-terraform/#4-common-error-error-acquiring-the-state-lock","title":"4. Common Error: \"Error acquiring the state lock\"","text":"<p>Happens when:</p> <ul> <li>Another terraform apply is running</li> <li>A previous run crashed and left the lock</li> <li>You killed terraform mid-run</li> </ul> <p>What to do:</p> <ol> <li>If you know no one else is running Terraform:</li> </ol> <pre><code>terraform force-unlock &lt;LOCK_ID&gt;\n</code></pre> <p>LOCK_ID will be in the error message.</p> <ol> <li>If using resource locks, you can also remove the lock item manually (Azure Storage account/Resource Group lock)</li> </ol>"},{"location":"00-Getting-Started/03-troubleshooting-and-debugging-terraform/#5-common-error-resource-already-exists","title":"5. Common Error: \"Resource already exists\"","text":"<p>This shows up when:</p> <ul> <li>Someone created the resource in the console</li> <li>You imported the resource but didn\u2019t move it in state</li> <li>Your name/tag is not unique</li> </ul> <p>Fix options:</p> <p>Option A: Import it</p> <pre><code>terraform import -var-file \".tfvars\" -var-file \".tfvars\" $TerraformResource $ResourceID\n</code></pre> <p>Option B: Rename / change resource name in config Use terraform state mv if you messed up the name:</p> <pre><code>terraform state mv module.testapp_vm module.testapp_vm[0]\n</code></pre> <p>Or <pre><code>terraform state mv module.testapp_vm module.testapp_vm[\"run\"]\n</code></pre></p>"},{"location":"00-Getting-Started/03-troubleshooting-and-debugging-terraform/#6-common-error-dependency-cycle","title":"6. Common Error: \"Dependency cycle\"","text":"<p>Terraform can\u2019t figure out which resource to create first.</p> <p>Typical cause:</p> <ul> <li>Output of A references B</li> <li>B references A through a data source or variable</li> </ul> <p>Fix:</p> <ul> <li>Remove circular reference</li> <li>Sometimes use depends_on Example:</li> </ul> <pre><code>resource \"azurerm_private_endpoint\" \"test-endpoint\" {\ndepends_on = [\n  azurerm_private_endpoint.first-endpoint,\n]\n}\n</code></pre>"},{"location":"00-Getting-Started/03-troubleshooting-and-debugging-terraform/#7-debugging-provisioners","title":"7. Debugging Provisioners","text":"<p>Provisioners fail a lot more than people admit.</p> <p>If you see: Error: remote-exec provisioner error it usually means:</p> <ul> <li>SSH couldn\u2019t connect (wrong key, wrong user, instance not ready)</li> <li>Command failed (apt-get locked, yum unavailable)</li> </ul> <p>What to check:</p> <ul> <li>Does the VM have a public IP?</li> <li>Is security group allowing SSH (22) from your runner(or agent) / your IP?</li> <li>Is the SSH user correct? (ubuntu vs ec2-user vs centos)</li> <li>Add a sleep:</li> </ul> <pre><code>provisioner \"remote-exec\" {\n  inline = [\n    \"sleep 15\",\n    \"sudo apt-get update -y\"\n  ]\n}\n</code></pre> <p>Or better: move config to user_data.</p>"},{"location":"00-Getting-Started/03-troubleshooting-and-debugging-terraform/#8-state-surgery-when-things-are-out-of-sync","title":"8. State Surgery (When Things Are Out of Sync)","text":"<p>A. Remove something from state but don\u2019t delete in Azure:</p> <pre><code>terraform state rm azure_vm.old\n</code></pre> <p>Use when Terraform thinks it owns a resource but it shouldn\u2019t.</p> <p>B. Rename something in state:</p> <pre><code>terraform state mv azure_vm.web azure_vm.web01\n</code></pre> <p>Use when you copied a block and changed the name but Terraform is confused.</p> <p>C. Show what\u2019s in state:</p> <pre><code>terraform state list\nterraform state show azure_vm.web\n</code></pre>"},{"location":"00-Getting-Started/03-troubleshooting-and-debugging-terraform/#9-drift-detection","title":"9. Drift Detection","text":"<p>If someone changes things in the console, terraform plan will show changes. To refresh state without planning:</p> <pre><code>terraform refresh\n</code></pre> <p>(Heads up: refresh is being phased/moved in newer versions \u2014 but the idea is \u201csync with remote.\u201d)</p>"},{"location":"00-Getting-Started/03-troubleshooting-and-debugging-terraform/#10-good-troubleshooting-flow","title":"10. Good Troubleshooting Flow","text":"<ol> <li>terraform init (does backend work?)</li> <li>terraform validate (is the config valid?)</li> <li>terraform plan (does the provider/auth/state work?)</li> <li>export TF_LOG=DEBUG and re-run if still broken</li> <li>Check Storage Account permissions</li> <li>If state is stuck \u2192 terraform force-unlock</li> <li>If resource name is wrong \u2192 terraform state mv</li> <li>If console drift \u2192 terraform plan \u2192 apply</li> </ol>"},{"location":"00-Getting-Started/03-troubleshooting-and-debugging-terraform/#11-practice-questions","title":"11. Practice Questions","text":""},{"location":"00-Getting-Started/03-troubleshooting-and-debugging-terraform/#question-1","title":"Question 1","text":"<p>What is the first step when encountering a vague Terraform error? A) Run terraform force-unlock. B) Enable TF_LOG=DEBUG. C) Run terraform refresh. D) Delete the state file</p> Show Answer   Answer: **B** - Enabling debug logging with `TF_LOG=DEBUG` provides detailed insights into the issue without altering state or resources. This helps identify the root cause before taking corrective action."},{"location":"00-Getting-Started/03-troubleshooting-and-debugging-terraform/#question-2","title":"Question 2","text":"<p>You see \"Error acquiring the state lock\". What is the most likely cause? A) Another Terraform process is running B) The S3 bucket doesn't exist C) Credentials are invalid D) The state file is corrupted</p> Show Answer Answer: **A** - State lock errors occur when another Terraform operation is running (or crashed and left a stale lock). If no one else is running Terraform, you can use `terraform force-unlock ` to release it."},{"location":"00-Getting-Started/03-troubleshooting-and-debugging-terraform/#question-3","title":"Question 3","text":"<p>What command removes a resource from Terraform state without destroying it in the cloud? A) <code>terraform destroy</code> B) <code>terraform state rm</code> C) <code>terraform state mv</code> D) <code>terraform state delete</code></p> Show Answer Answer: **B** - `terraform state rm` removes a resource from state, but leaves the actual infrastructure intact in Azure. This is useful when moving resources between Terraform configurations or if a resource is now managed elsewhere."},{"location":"01-Understand-Infrastructure-as-Code/","title":"Understanding Infrastructure as Code","text":""},{"location":"01-Understand-Infrastructure-as-Code/#what-youll-learn","title":"What you'll learn","text":"<ul> <li>Differentiate Infrastructure as Code (IaC) from traditional provisioning.</li> <li>Explain benefits like repeatability, versioning, and collaboration.</li> <li>Recognize Terraform's place among IaC tools and workflows.</li> </ul>"},{"location":"01-Understand-Infrastructure-as-Code/#cheat-sheet","title":"Cheat sheet","text":"<ul> <li>IaC pillars: idempotency, version control, automation.</li> <li>Desired state model: declare configuration, let Terraform converge state.</li> <li>Use VCS (Git) to manage IaC history and reviews.</li> </ul>"},{"location":"01-Understand-Infrastructure-as-Code/#official-documentation","title":"Official documentation","text":"<ul> <li>Infrastructure as Code Overview</li> <li>Terraform Recommended Practices</li> <li>Version Control Best Practices</li> </ul>"},{"location":"01-Understand-Infrastructure-as-Code/#the-terraform-file-structure","title":"The Terraform File Structure","text":"<p>You need to know the anatomy of a normal project: <pre><code>main.tf         # providers + resources\nvariables.tf    # input variables\noutputs.tf      # outputs\nterraform.tfvars # values for input variables\n</code></pre></p>"},{"location":"01-Understand-Infrastructure-as-Code/#memory-trick","title":"Memory Trick:","text":"<ul> <li>MVO = main, variables, outputs</li> <li>Terraform sees all .tf files as one big file</li> </ul>"},{"location":"02-Terraform-Basics-and-CLI/","title":"Terraform Basics and CLI Mastery","text":""},{"location":"02-Terraform-Basics-and-CLI/#what-youll-learn","title":"What you'll learn","text":"<ul> <li>Navigate the Terraform CLI workflow from init to destroy.</li> <li>Interpret plan and apply output for safe infrastructure changes.</li> <li>Use CLI options to validate configuration and format code.</li> <li>Manage workspace directories and state files with common commands.</li> </ul>"},{"location":"02-Terraform-Basics-and-CLI/#topics","title":"Topics","text":"<ul> <li>Terraform CLI Commands</li> <li>Resource Targeting and Import</li> </ul>"},{"location":"02-Terraform-Basics-and-CLI/#cheat-sheet","title":"Cheat sheet","text":"<ul> <li>Initialize: <code>terraform init</code></li> <li>Format: <code>terraform fmt</code></li> <li>Validate: <code>terraform validate</code></li> <li>Preview: <code>terraform plan</code></li> <li>Apply: <code>terraform apply</code></li> <li>Destroy: <code>terraform destroy</code></li> </ul>"},{"location":"02-Terraform-Basics-and-CLI/#official-documentation","title":"Official documentation","text":"<ul> <li>CLI Overview</li> <li>Command Line Interface Usage</li> <li>Terraform Workflow</li> </ul>"},{"location":"02-Terraform-Basics-and-CLI/#hands-on-task","title":"Hands-on task","text":"<p>Create a minimal configuration and walk the workflow: <pre><code># main.tf\nterraform {\n  required_version = \"&gt;= 1.5.0\"\n}\n\nresource \"null_resource\" \"example\" {\n  provisioner \"local-exec\" {\n    command = \"echo hello\"\n  }\n}\n</code></pre> Then run: <pre><code>terraform init\nterraform plan\nterraform apply -auto-approve\n</code></pre></p>"},{"location":"02-Terraform-Basics-and-CLI/#summary","title":"Summary","text":"<p>By the end of this section, you should be able to confidently answer:</p>"},{"location":"02-Terraform-Basics-and-CLI/#what-is-terraform-and-how-does-it-work","title":"\u201cWhat is Terraform and how does it work?\u201d","text":"<p>A declarative IaC (Infrastructure as Code) tool that uses a desired-state model to provision cloud resources. It compares your written configuration against the recorded state and applies only the changes needed to make reality match your code.</p>"},{"location":"02-Terraform-Basics-and-CLI/#what-does-terraform-init-do","title":"\u201cWhat does <code>terraform init</code> do?\u201d","text":"<p>Downloads required: - Providers - Modules - Backend configuration  </p> <p>Basically initializes the working directory and gets everything ready to roll.</p>"},{"location":"02-Terraform-Basics-and-CLI/#explain-the-terraform-workflow","title":"\u201cExplain the Terraform workflow.\u201d","text":"<ol> <li><code>init</code>   \u2013 set up backend, download providers/modules  </li> <li><code>plan</code>   \u2013 preview what Terraform wants to do  </li> <li><code>apply</code>  \u2013 make the changes for real  </li> <li><code>destroy</code>\u2013 nuke everything when you\u2019re done</li> </ol>"},{"location":"02-Terraform-Basics-and-CLI/#what-is-the-difference-between-a-resource-and-a-data-source","title":"\u201cWhat is the difference between a resource and a data source?\u201d","text":"Type Purpose Creates something? <code>resource</code> Creates/manages infrastructure Yes <code>data</code> Reads existing data/infrastructure No <p>Resource = \u201cmake this thing\u201d Data source = \u201cgo look up this thing that already exists\u201d</p>"},{"location":"02-Terraform-Basics-and-CLI/#where-should-variables-outputs-and-providers-go-community-convention","title":"\u201cWhere should variables, outputs, and providers go? (Community convention)","text":"File Typical contents <code>variables.tf</code> All <code>variable</code> blocks + descriptions/defaults <code>outputs.tf</code> All <code>output</code> blocks <code>main.tf</code> Providers, resources, data sources (the meat) <code>terraform.tfvars</code> Actual variable values (or use *.auto.tfvars)"},{"location":"02-Terraform-Basics-and-CLI/#terraform-quick-fire-can-you-answer-these-smoothly","title":"Terraform Quick Fire \u2013 Can You Answer These Smoothly?","text":"<p>Practice saying each one out loud in a single, confident sentence. No stuttering allowed jr \ud83d\ude0f</p> # Question Your One-Sentence Answer (say it like you mean it) 1 What does <code>terraform init</code> do? It initializes the working directory, downloads providers and modules, configures the backend, and creates the <code>.terraform.lock.hcl</code> dependency lock file. 2 Why do we need a provider block? Because Terraform core doesn\u2019t natively speak AWS/Azure/GCP \u2014 providers are the plugins that translate your HCL into actual API calls. 3 What is a resource vs data source? Resources create or manage real infrastructure; data sources read information about things that already exist. 4 Why do we use outputs? To safely expose important values (ARNs, IPs, URLs, bucket names) from your config or modules so humans and other Terraform configs can use them after <code>apply</code>. 5 What is Terraform\u2019s workflow? <code>init</code> \u2192 <code>plan</code> \u2192 <code>apply</code> \u2192 (optional) <code>destroy</code> \u2014 turning your desired-state code into real cloud resources. <ul> <li>If you can say those comfortably? You\u2019ve internalized the fundamentals.</li> </ul>"},{"location":"02-Terraform-Basics-and-CLI/01-terraform-cli-commands/","title":"Terraform CLI Commands","text":""},{"location":"02-Terraform-Basics-and-CLI/01-terraform-cli-commands/#learning-objectives","title":"Learning Objectives","text":"<ul> <li>Master essential Terraform CLI commands for the exam.</li> <li>Understand when to use each command and common flags.</li> <li>Learn the difference between similar commands (<code>plan</code> vs <code>plan -refresh-only</code>).</li> <li>Practice commands that are frequently tested.</li> </ul>"},{"location":"02-Terraform-Basics-and-CLI/01-terraform-cli-commands/#1-core-workflow-commands","title":"1. Core Workflow Commands","text":""},{"location":"02-Terraform-Basics-and-CLI/01-terraform-cli-commands/#terraform-init","title":"<code>terraform init</code>","text":"<p>Purpose: Initializes a Terraform working directory.</p> <p>What it does: - Downloads provider plugins - Initializes backend configuration - Installs modules (if any) - Sets up <code>.terraform</code> directory</p> <p>Common flags: <pre><code>terraform init                    # Standard initialization\nterraform init -upgrade           # Upgrade provider versions\nterraform init -reconfigure      # Reconfigure backend without migration\nterraform init -migrate-state    # Migrate state to new backend\n</code></pre></p> <p>Exam tip: <code>init</code> must be run before <code>plan</code> or <code>apply</code>. If you see an error about missing providers, run <code>terraform init</code>.</p>"},{"location":"02-Terraform-Basics-and-CLI/01-terraform-cli-commands/#terraform-plan","title":"<code>terraform plan</code>","text":"<p>Purpose: Creates an execution plan showing what Terraform will do.</p> <p>What it shows: - Resources to be created (+) - Resources to be updated (~) - Resources to be destroyed (-)</p> <p>Common flags: <pre><code>terraform plan                                    # Standard plan\nterraform plan -out=tfplan                        # Save plan to file\nterraform plan -var=\"location=uksouth\"            # Set variable\nterraform plan -var-file=prod.tfvars              # Use variable file\nterraform plan -target=azure_vm.web               # Plan specific resource only\nterraform plan -refresh=false                     # Skip state refresh\nterraform plan -refresh-only                      # Only refresh state, don't plan changes\n</code></pre></p> <p>Key differences: - <code>plan -refresh=false</code>: Use cached state, faster but may miss drift - <code>plan -refresh-only</code>: Only update state from real infrastructure, don't plan changes</p> <p>Exam tip: <code>terraform plan -out=tfplan</code> saves the plan, then <code>terraform apply tfplan</code> applies it exactly as planned.</p>"},{"location":"02-Terraform-Basics-and-CLI/01-terraform-cli-commands/#terraform-apply","title":"<code>terraform apply</code>","text":"<p>Purpose: Applies the changes required to reach the desired state.</p> <p>Common flags: <pre><code>terraform apply                             # Interactive (prompts for approval)\nterraform apply -auto-approve               # Skip confirmation prompt\nterraform apply tfplan                      # Apply saved plan file\nterraform apply -target=azure_vm.web        # Apply to specific resource\nterraform apply -refresh=false              # Use cached state\nterraform apply -var=\"key=value\"            # Pass variable\n</code></pre></p> <p>Exam tip: <code>terraform apply -auto-approve</code> is useful in CI/CD pipelines.</p>"},{"location":"02-Terraform-Basics-and-CLI/01-terraform-cli-commands/#terraform-destroy","title":"<code>terraform destroy</code>","text":"<p>Purpose: Destroys all resources managed by Terraform.</p> <p>Common flags: <pre><code>terraform destroy                          # Interactive destruction\nterraform destroy -auto-approve            # Skip confirmation\nterraform destroy -target=azure_vm.web     # Destroy specific resource\n</code></pre></p>"},{"location":"02-Terraform-Basics-and-CLI/01-terraform-cli-commands/#2-validation-and-formatting-commands","title":"2. Validation and Formatting Commands","text":""},{"location":"02-Terraform-Basics-and-CLI/01-terraform-cli-commands/#terraform-fmt","title":"<code>terraform fmt</code>","text":"<p>Purpose: Rewrites Terraform configuration files to a canonical format and style.</p> <p>What it does: - Formats <code>.tf</code> files - Ensures consistent indentation - Standardizes spacing - Can format <code>.tfvars</code> files too</p> <p>Common flags: <pre><code>terraform fmt              # Format files in current directory\nterraform fmt -write       # Write formatted files (default behavior)\nterraform fmt -check       # Check if files need formatting (CI/CD)\nterraform fmt -recursive   # Format all subdirectories\nterraform fmt -diff        # Show what would change\n</code></pre></p> <p>Example: <pre><code># Before formatting (inconsistent spacing)\nresource \"azurerm_key_vault\" \"example\" {\nname                        = \"examplekeyvault\"\nlocation                    = var.location\nresource_group_name         = \"testresourcegroup\"\n  tenant_id                   = \"29334838934093843894328\" #test tenant ID\n}\n# After terraform fmt\nresource \"azurerm_key_vault\" \"example\" {\n  name                        = \"examplekeyvault\"\n  location                    = var.location\n  resource_group_name         = \"testresourcegroup\"\n  tenant_id                   = \"29334838934093843894328\" #test tenant ID\n}\n</code></pre></p> <p>Exam tip: <code>terraform fmt</code> is idempotent \u2014 running it multiple times produces the same result.</p>"},{"location":"02-Terraform-Basics-and-CLI/01-terraform-cli-commands/#terraform-validate","title":"<code>terraform validate</code>","text":"<p>Purpose: Validates the Terraform configuration files in a directory.</p> <p>What it checks: - Syntax errors - Type mismatches - Reference errors - Provider configuration issues</p> <p>Note: Does NOT check if resources exist in the cloud or if your credentials are valid.</p> <p>Common flags: <pre><code>terraform validate           # Validate configuration\nterraform validate -json     # Output in JSON format\nterraform validate -no-color # Disable color output\n</code></pre></p> <p>Example: <pre><code>terraform validate\n# Success! The configuration is valid.\n\n# Or if there's an error:\nError: Reference to undeclared input variable\n  on main.tf line 5:\n   5: location = var.invalid_var\n</code></pre></p> <p>Exam tip: Always run <code>terraform validate</code> before committing code. It's faster than <code>plan</code> and catches config errors early.</p>"},{"location":"02-Terraform-Basics-and-CLI/01-terraform-cli-commands/#terraform-version","title":"<code>terraform version</code>","text":"<p>Purpose: Displays the version of Terraform and installed providers.</p> <p>Output shows: - Terraform version - Provider versions - Terraform required version (if specified)</p> <p>Example: <pre><code>terraform version\nTerraform v1.12.0\non windows_amd64\n+ provider registry.terraform.io/hashicorp/azuread v3.8.0\n+ provider registry.terraform.io/hashicorp/azurerm v4.21.1\n</code></pre></p> <p>Common flags: <pre><code>terraform version         # Show version\nterraform version -json  # JSON output\n</code></pre></p>"},{"location":"02-Terraform-Basics-and-CLI/01-terraform-cli-commands/#3-debugging-and-inspection-commands","title":"3. Debugging and Inspection Commands","text":""},{"location":"02-Terraform-Basics-and-CLI/01-terraform-cli-commands/#terraform-console","title":"<code>terraform console</code>","text":"<p>Purpose: Interactive console for evaluating Terraform expressions.</p> <p>Use cases: - Test functions - Evaluate expressions - Debug variable values - Experiment with syntax</p> <p>Example: <pre><code>$ terraform console\n&gt; var.aks_assigned_principle_identity\nfalse\n&gt; upper(\"hello\")\nHELLO\n&gt; length([\"a\", \"b\", \"c\"])\n3\n&gt; var.aks_assigned_principle_identity != null ? var.aks_assigned_principle_identity : \"true\"\nfalse\n&gt; exit\n</code></pre></p> <p>Exam tip: Great for testing built-in functions and conditional expressions.</p>"},{"location":"02-Terraform-Basics-and-CLI/01-terraform-cli-commands/#terraform-graph","title":"<code>terraform graph</code>","text":"<p>Purpose: Creates a visual representation of resource dependencies.</p> <p>Output: - Graph in DOT format (can be visualized with Graphviz) - Shows resource relationships - Useful for understanding dependencies</p> <p>Common flags: <pre><code>terraform graph                    # Output dependency graph\nterraform graph &gt; graph.dot        # Save to file\nterraform graph -type=plan         # Plan-time graph\nterraform graph -type=apply        # Apply-time graph (default)\nterraform graph -type=destroy      # Destroy-time graph\n</code></pre></p> <p>Visualization: <pre><code>terraform graph | dot -Tpng &gt; graph.png  # Requires Graphviz installed\n</code></pre></p>"},{"location":"02-Terraform-Basics-and-CLI/01-terraform-cli-commands/#terraform-output","title":"<code>terraform output</code>","text":"<p>Purpose: Reads and displays values from Terraform state.</p> <p>Common flags: <pre><code>terraform output                    # Show all outputs\nterraform output instance_ip       # Show specific output\nterraform output -json              # JSON format\nterraform output -raw instance_ip   # Raw value (no quotes)\n</code></pre></p> <p>Example: <pre><code>$ terraform output\ninstance_ip = \"3.94.72.21\"\n\n$ terraform output -raw instance_ip\n3.94.72.21\n</code></pre></p>"},{"location":"02-Terraform-Basics-and-CLI/01-terraform-cli-commands/#4-state-management-commands","title":"4. State Management Commands","text":""},{"location":"02-Terraform-Basics-and-CLI/01-terraform-cli-commands/#terraform-state-list","title":"<code>terraform state list</code>","text":"<p>Purpose: Lists all resources in the Terraform state.</p> <p>Example: <pre><code>terraform state list\nazurerm_role_assignment.storage_blob_data_owner\nazurerm_service_plan.function_app\nazurerm_storage_account.example\n</code></pre></p>"},{"location":"02-Terraform-Basics-and-CLI/01-terraform-cli-commands/#terraform-state-show","title":"<code>terraform state show</code>","text":"<p>Purpose: Shows detailed attributes of a specific resource in state.</p> <p>Example: <pre><code>terraform state show 'azurerm_resource_group.rg[\\\"test\\\"]' # When using powershell and having multiple resources, you need to ensure quotations and backslashes are used as PowerShell will be interpreting the quotes and brackets, not Terraform itself.\n# azurerm_resource_group[\"test]:\nresource \"azurerm_resource_group\" \"rg\" {\n    id         = \"/subscriptions/{subID}/resourceGroups/test-rg\"\n    location   = \"uksouth\"\n    managed_by = null\n    name       = \"test-rg\"\n    tags       = {\n        \"Terraform\"   = \"True\"\n    }\n}\n</code></pre></p>"},{"location":"02-Terraform-Basics-and-CLI/01-terraform-cli-commands/#terraform-state-mv","title":"<code>terraform state mv</code>","text":"<p>Purpose: Moves or renames resources in state without recreating them.</p> <p>Use cases: - Renaming resources - Moving resources to/from modules - Fixing state after code refactoring</p> <p>Example: <pre><code>terraform state mv azure_vm.old azure_vm.new\nterraform state mv module.testapp_vm module.testapp_vm[0]\nterraform state mv module.testapp_vm module.testapp_vm[\"run\"]\n</code></pre></p> <p>Exam tip: This does NOT modify actual infrastructure, only the state file.</p>"},{"location":"02-Terraform-Basics-and-CLI/01-terraform-cli-commands/#terraform-state-rm","title":"<code>terraform state rm</code>","text":"<p>Purpose: Removes a resource from state WITHOUT destroying it in the cloud.</p> <p>Use cases: - Resource managed outside Terraform - Moving resource to different Terraform config - Removing from state after manual deletion</p> <p>Example: <pre><code>terraform state rm azurerm_linux_virtual_machine.old\nterraform state rm azurerm_app_service_plan.alert_function\n</code></pre></p> <p>Warning: Resource still exists in Azure. Terraform will no longer manage it.</p>"},{"location":"02-Terraform-Basics-and-CLI/01-terraform-cli-commands/#terraform-state-pull","title":"<code>terraform state pull</code>","text":"<p>Purpose: Downloads and outputs the current state.</p> <p>Use cases: - Backup state - Inspect raw state JSON - Debugging state issues</p> <p>Example: <pre><code>terraform state pull &gt; state-backup.json\n</code></pre></p>"},{"location":"02-Terraform-Basics-and-CLI/01-terraform-cli-commands/#terraform-state-push","title":"<code>terraform state push</code>","text":"<p>Purpose: Uploads a local state file to the backend.</p> <p>Warning: Use with extreme caution. Can corrupt state if used incorrectly.</p> <p>Common use case: Restoring from backup <pre><code>terraform state push state-backup.json\n</code></pre></p>"},{"location":"02-Terraform-Basics-and-CLI/01-terraform-cli-commands/#5-workspace-commands","title":"5. Workspace Commands","text":""},{"location":"02-Terraform-Basics-and-CLI/01-terraform-cli-commands/#terraform-workspace","title":"<code>terraform workspace</code>","text":"<p>Purpose: Manages Terraform workspaces.</p> <p>Common commands: <pre><code>terraform workspace list          # List all workspaces\nterraform workspace show          # Show current workspace\nterraform workspace new dev       # Create new workspace\nterraform workspace select dev    # Switch workspace\nterraform workspace delete dev   # Delete workspace (must be empty)\n</code></pre></p> <p>Exam tip: Default workspace is called <code>default</code>.</p>"},{"location":"02-Terraform-Basics-and-CLI/01-terraform-cli-commands/#6-lock-management","title":"6. Lock Management","text":""},{"location":"02-Terraform-Basics-and-CLI/01-terraform-cli-commands/#terraform-force-unlock","title":"<code>terraform force-unlock</code>","text":"<p>Purpose: Manually unlock the state.</p> <p>Use when: - Lock stuck from crashed Terraform process - Another user's lock needs release - Manual intervention required</p> <p>Example: <pre><code>terraform force-unlock &lt;LOCK_ID&gt;\n</code></pre></p> <p>Warning: Only use when you're certain no other Terraform operations are running.</p>"},{"location":"02-Terraform-Basics-and-CLI/01-terraform-cli-commands/#7-command-comparison-table","title":"7. Command Comparison Table","text":"Command Purpose Modifies State? Modifies Infrastructure? <code>terraform init</code> Initialize workspace \u274c \u274c <code>terraform plan</code> Preview changes \u274c \u274c <code>terraform apply</code> Apply changes \u2705 \u2705 <code>terraform destroy</code> Destroy resources \u2705 \u2705 <code>terraform fmt</code> Format code \u274c \u274c <code>terraform validate</code> Check syntax \u274c \u274c <code>terraform state mv</code> Move in state \u2705 \u274c <code>terraform state rm</code> Remove from state \u2705 \u274c <code>terraform refresh</code> Sync state \u2705 \u274c"},{"location":"02-Terraform-Basics-and-CLI/01-terraform-cli-commands/#8-exam-style-practice-questions","title":"8. Exam-Style Practice Questions","text":""},{"location":"02-Terraform-Basics-and-CLI/01-terraform-cli-commands/#question-1","title":"Question 1","text":"<p>Which command validates Terraform configuration syntax without checking cloud resources? A) <code>terraform plan</code> B) <code>terraform validate</code> C) <code>terraform fmt</code> D) <code>terraform init</code></p> Show Answer Answer: **B** - `terraform validate` checks syntax and configuration errors without connecting to providers."},{"location":"02-Terraform-Basics-and-CLI/01-terraform-cli-commands/#question-2","title":"Question 2","text":"<p>What is the difference between <code>terraform plan -refresh=false</code> and <code>terraform plan -refresh-only</code>? A) Both skip refreshing state B) <code>-refresh=false</code> skips refresh; <code>-refresh-only</code> only refreshes state C) Both only refresh state D) No difference</p> Show Answer Answer: **B** - `-refresh=false` uses cached state for faster plans. `-refresh-only` updates state from real infrastructure but doesn't plan changes."},{"location":"02-Terraform-Basics-and-CLI/01-terraform-cli-commands/#question-3","title":"Question 3","text":"<p>Which command rewrites Terraform files to canonical format? A) <code>terraform format</code> B) <code>terraform fmt</code> C) <code>terraform validate</code> D) <code>terraform tidy</code></p> Show Answer Answer: **B** - `terraform fmt` formats configuration files to a standard style."},{"location":"02-Terraform-Basics-and-CLI/01-terraform-cli-commands/#question-4","title":"Question 4","text":"<p>You want to rename a resource in state without recreating it. Which command should you use? A) <code>terraform state rm</code> then add new resource B) <code>terraform state mv</code> C) <code>terraform apply</code> with new name D) <code>terraform refresh</code></p> Show Answer Answer: **B** - `terraform state mv` moves/renames resources in state without touching infrastructure."},{"location":"02-Terraform-Basics-and-CLI/01-terraform-cli-commands/#question-5","title":"Question 5","text":"<p>What does <code>terraform plan -out=tfplan</code> do? A) Saves plan to file for later application B) Outputs plan to console C) Applies the plan immediately D) Validates the configuration</p> Show Answer Answer: **A** - Saves execution plan to a file. Use `terraform apply tfplan` to apply it later."},{"location":"02-Terraform-Basics-and-CLI/01-terraform-cli-commands/#9-key-takeaways","title":"9. Key Takeaways","text":"<ul> <li><code>terraform init</code>: Must run before plan/apply. Downloads providers and initializes backend.</li> <li><code>terraform validate</code>: Fast syntax/config check. Doesn't require providers.</li> <li><code>terraform fmt</code>: Formats code. Idempotent and safe to run multiple times.</li> <li><code>terraform plan -refresh-only</code>: Updates state from real infrastructure without planning changes.</li> <li><code>terraform state mv</code>: Renames resources in state without recreating them.</li> <li><code>terraform state rm</code>: Removes resource from state but keeps it in the cloud.</li> <li>Always use <code>terraform plan</code> before <code>apply</code> in production.</li> <li>Save plans with <code>-out</code> for reproducible applies.</li> </ul>"},{"location":"02-Terraform-Basics-and-CLI/01-terraform-cli-commands/#10-common-exam-patterns","title":"10. Common Exam Patterns","text":"<p>Pattern 1: Which command for syntax validation? \u2192 Always <code>terraform validate</code></p> <p>Pattern 2: Formatting code \u2192 Always <code>terraform fmt</code></p> <p>Pattern 3: Moving/renaming resources \u2192 Always <code>terraform state mv</code></p> <p>Pattern 4: Fast state refresh without planning \u2192 <code>terraform plan -refresh-only</code> or <code>terraform refresh</code></p> <p>Pattern 5: Applying saved plan \u2192 <code>terraform apply &lt;plan-file&gt;</code></p>"},{"location":"02-Terraform-Basics-and-CLI/01-terraform-cli-commands/#references","title":"References","text":"<ul> <li>Terraform CLI Commands</li> <li>Terraform State Commands</li> <li>Terraform Plan Options</li> </ul>"},{"location":"02-Terraform-Basics-and-CLI/02-resource-targeting-and-import/","title":"Resource Targeting And Import","text":""},{"location":"02-Terraform-Basics-and-CLI/02-resource-targeting-and-import/#learning-objectives","title":"Learning Objectives","text":"<ul> <li>Learn how to target specific resources for Terraform operations.</li> <li>Understand the <code>terraform import</code> process for bringing existing infrastructure under management.</li> <li>Master common import scenarios and best practices.</li> <li>Know when and how to use targeting effectively.</li> </ul>"},{"location":"02-Terraform-Basics-and-CLI/02-resource-targeting-and-import/#1-resource-targeting","title":"1. Resource Targeting","text":""},{"location":"02-Terraform-Basics-and-CLI/02-resource-targeting-and-import/#what-is-resource-targeting","title":"What is Resource Targeting?","text":"<p>Resource targeting allows you to apply Terraform operations to specific resources instead of all resources in your configuration.</p> <p>Syntax: <pre><code>terraform plan -target=resource_address\nterraform apply -target=resource_address\nterraform destroy -target=resource_address\n</code></pre></p>"},{"location":"02-Terraform-Basics-and-CLI/02-resource-targeting-and-import/#resource-address-format","title":"Resource Address Format","text":"<p>Resources are identified by their address: - Simple resource: <code>resource_type.resource_name</code> - Resource with count: <code>resource_type.resource_name[0]</code> - Resource with for_each: <code>resource_type.resource_name[\"key\"]</code> - Module resource: <code>module.module_name.resource_type.resource_name</code></p>"},{"location":"02-Terraform-Basics-and-CLI/02-resource-targeting-and-import/#basic-targeting-examples","title":"Basic Targeting Examples","text":"<p>Target a specific resource: <pre><code>terraform plan -target=azure_vm.web\nterraform apply -target=azure_vm.web\n</code></pre></p> <p>Target multiple resources: <pre><code>terraform apply \\\n  -target=azure_vm.web \\\n  -target=azure_nsg.web\n</code></pre></p> <p>Target a resource in a module: <pre><code>terraform apply -target=module.testapp_vm\n</code></pre></p> <p>Target resources with count/for_each: <pre><code># Count\nterraform apply -target=module.testapp_vm[0]\n\n# For_each\nterraform apply -target=module.testapp_vm[\"run\"]\n</code></pre></p>"},{"location":"02-Terraform-Basics-and-CLI/02-resource-targeting-and-import/#use-cases-for-targeting","title":"Use Cases for Targeting","text":"<ol> <li> <p>Testing specific resources: <pre><code>terraform apply -target=azure_vm.web\n</code></pre>    Apply only the web instance to test changes quickly.</p> </li> <li> <p>Partial applies: <pre><code>terraform apply -target=azure_vnet.main -target=azure_subnet.private\n</code></pre>    Create networking before compute resources.</p> </li> <li> <p>Incremental updates: <pre><code>terraform plan -target=azure_vm.app\nterraform apply -target=azure_vm.app\n</code></pre>    Update one component at a time.</p> </li> <li> <p>Emergency fixes: <pre><code>terraform apply -target=network_security_group.critical\n</code></pre>    Quickly fix a critical security group without touching other resources.</p> </li> </ol>"},{"location":"02-Terraform-Basics-and-CLI/02-resource-targeting-and-import/#important-limitations","title":"Important Limitations","text":"<p>\u26a0\ufe0f Targeting doesn't resolve dependencies automatically: - If resource B depends on resource A, targeting B will fail unless A exists - Terraform may create dependencies if it can determine them statically - Some dependencies require manual targeting</p> <p>Example: <pre><code># This might fail if vnet resource doesn't exist\nterraform apply -target=azure_vm.web\n\n# You need to target both\nterraform apply \\\n  -target=azure_vnet.main \\\n  -target=azure_vm.web\n</code></pre></p>"},{"location":"02-Terraform-Basics-and-CLI/02-resource-targeting-and-import/#targeting-best-practices","title":"Targeting Best Practices","text":"<p>\u2705 Do: - Use for testing specific resources during development - Use for incremental rollouts - Use for fixing individual components - Always verify dependencies</p> <p>\u274c Don't: - Don't rely on targeting as a permanent workflow - Don't skip dependency resources - Don't use targeting to avoid fixing dependency issues - Don't forget to run full <code>terraform plan</code> periodically</p>"},{"location":"02-Terraform-Basics-and-CLI/02-resource-targeting-and-import/#2-importing-existing-infrastructure","title":"2. Importing Existing Infrastructure","text":""},{"location":"02-Terraform-Basics-and-CLI/02-resource-targeting-and-import/#what-is-import","title":"What is Import?","text":"<p>Import brings existing infrastructure under Terraform management without recreating it.</p> <p>When to use: - Infrastructure was created manually (console, CLI, etc.) - Migrating from another IaC tool (CloudFormation, etc.) - Resources were created before Terraform was adopted - Fixing state drift</p>"},{"location":"02-Terraform-Basics-and-CLI/02-resource-targeting-and-import/#import-command-syntax","title":"Import Command Syntax","text":"<pre><code>terraform import resource_address infrastructure_id\n</code></pre> <p>Components: - <code>resource_address</code>: Terraform resource address (e.g., <code>'azurerm_private_dns_a_record.kv_record[\\\"key-vault-01\\\"]'</code>  ) - <code>id</code>: Azure-specific ID (e.g.,  <code>\"/subscriptions/{subID}/resourceGroups/test-rg/providers/Microsoft.Network/privateDnsZones/privatelink.vaultcore.azure.net/A/key-vault-01\")</code></p>"},{"location":"02-Terraform-Basics-and-CLI/02-resource-targeting-and-import/#step-by-step-import-process","title":"Step-by-Step Import Process","text":"<p>Step 1: Add resource block to configuration <pre><code>resource \"azurerm_private_dns_a_record\" \"kv_record\" {\n  for_each = { for dns in var.dns_records : dns.name =&gt; dns\n  # Configuration must match existing resource attributes\n    name                = \"test-DNS-record\"\n    zone_name           = \"privatelink.blob.core.windows.net\"\n    resource_group_name = \"test-rg\"\n}\n</code></pre></p> <p>Step 2: Run import command <pre><code>terraform import 'azurerm_private_dns_a_record.kv_record[\\\"key-vault-01\\\"]' \"/subscriptions/{subID}/resourceGroups/test-rg/providers/Microsoft.Network/privateDnsZones/privatelink.vaultcore.azure.net/A/key-vault-01\"\n</code></pre></p> <p>Step 3: Verify in state <pre><code>terraform state show 'azurerm_private_dns_a_record.kv_record[\\\"key-vault-01\\\"]\n</code></pre></p> <p>Step 4: Review plan <pre><code>terraform plan\n</code></pre> Terraform will show any differences between config and actual resource.</p> <p>Step 5: Update configuration to match reality Update your <code>.tf</code> file to match the imported resource's actual attributes.</p> <p>Step 6: Apply to sync <pre><code>terraform apply\n</code></pre> This should show no changes if config matches reality.</p>"},{"location":"02-Terraform-Basics-and-CLI/02-resource-targeting-and-import/#common-import-examples","title":"Common Import Examples","text":""},{"location":"02-Terraform-Basics-and-CLI/02-resource-targeting-and-import/#importing-an-azure-storage-account","title":"Importing an Azure Storage Account","text":"<pre><code># Configuration\nresource \"azurerm_storage_account\" \"data\" {\n  name                     = \"test-sa\"\n  resource_group_name      = \"test-rg\"\n  location                 = \"westeurope\"\n  account_tier             = \"Standard\"\n  account_replication_type = \"LRS\"\n}\n</code></pre> <pre><code>terraform import azurerm_storage_account.data \"/subscriptions/{subID}/resourceGroups/test-rg/providers/Microsoft.Storage/storageAccounts/test-sa\"\n</code></pre>"},{"location":"02-Terraform-Basics-and-CLI/02-resource-targeting-and-import/#importing-an-azure-vm","title":"Importing an Azure VM","text":"<pre><code># Configuration\nresource \"azurerm_linux_virtual_machine\" \"web\" {\n  name                = \"myvm01\"\n  resource_group_name = \"test-rg\"\n  location            = \"uksouth\"\n  size                = \"Standard_B1s\"\n\n  admin_username      = \"azureuser\"\n\n  network_interface_ids = [\n    \"/subscriptions/&lt;SUB_ID&gt;/resourceGroups/test-rg/providers/Microsoft.Network/networkInterfaces/myvm01-nic\"\n  ]\n\n  os_disk {\n    caching              = \"ReadWrite\"\n    storage_account_type = \"Standard_LRS\"\n  }\n\n  source_image_reference {\n    publisher = \"Canonical\"\n    offer     = \"0001-com-ubuntu-server-focal\"\n    sku       = \"20_04-lts\"\n    version   = \"latest\"\n  }\n}\n</code></pre> <pre><code>terraform import azurerm_linux_virtual_machine.web \"/subscriptions/{subID}/resourceGroups/test-rg/providers/Microsoft.Compute/virtualMachines/myvm01\"\n</code></pre> <p>Note: Import only the instance. Additional resources may need separate imports.</p>"},{"location":"02-Terraform-Basics-and-CLI/02-resource-targeting-and-import/#importing-a-vnet","title":"Importing a VNET","text":"<pre><code>resource \"azurerm_virtual_network\" \"main\" {\n  name                = \"my-vnet\"\n  resource_group_name = \"test-rg\"\n  location            = \"uksouth\"\n  address_space       = [\"10.0.0.0/16\"]\n}\n</code></pre> <pre><code>terraform import azurerm_virtual_network.main \"/subscriptions/{subID}/resourceGroups/test-rg/providers/Microsoft.Network/virtualNetworks/my-vnet\"\n</code></pre>"},{"location":"02-Terraform-Basics-and-CLI/02-resource-targeting-and-import/#importing-resources-with-count","title":"Importing Resources with Count","text":"<pre><code>resource \"azurerm_linux_virtual_machine\" \"web\" {\n  count               = 2\n  name                = \"myvm-${count.index}\"\n  resource_group_name = \"test-rg\"\n  location            = \"uksouth\"\n  size                = \"Standard_B1s\"\n\n  admin_username      = \"azureuser\"\n\n  network_interface_ids = [\n    \"/subscriptions/{subID}/resourceGroups/test-rg/providers/Microsoft.Network/networkInterfaces/myvm-${count.index}-nic\"\n  ]\n\n  os_disk {\n    caching              = \"ReadWrite\"\n    storage_account_type = \"Standard_LRS\"\n  }\n\n  source_image_reference {\n    publisher = \"Canonical\"\n    offer     = \"0001-com-ubuntu-server-focal\"\n    sku       = \"20_04-lts\"\n    version   = \"latest\"\n  }\n}\n</code></pre> <pre><code>terraform import azurerm_linux_virtual_machine.web[0] \"/subscriptions/{subID}/resourceGroups/test-rg/providers/Microsoft.Compute/virtualMachines/myvm-0\"\n\nterraform import azurerm_linux_virtual_machine.web[1] \"/subscriptions/{subID}/resourceGroups/test-rg/providers/Microsoft.Compute/virtualMachines/myvm-1\"\n</code></pre>"},{"location":"02-Terraform-Basics-and-CLI/02-resource-targeting-and-import/#importing-resources-with-for_each","title":"Importing Resources with for_each","text":"<p><pre><code>storage_accounts = [\n  { name = \"appstore\" },\n  { name = \"webstore\" }\n]\n</code></pre> <pre><code>resource \"azurerm_storage_account\" \"logs\" {\n  for_each = { for account in var.storage_accounts : account.name =&gt; account }\n\n  name                     = each.value.name\n  resource_group_name      = azurerm_resource_group.rg[each.value.name].name\n  location                 = \"uksouth\"\n  account_tier             = \"Standard\"\n  account_replication_type = \"LRS\"\n}\n</code></pre></p> <pre><code>terraform import 'azurerm_storage_account.logs[\"appstore\"]' \"/subscriptions/&lt;SUB_ID&gt;/resourceGroups/&lt;RG_NAME&gt;/providers/Microsoft.Storage/storageAccounts/appstore\"\nterraform import 'azurerm_storage_account.logs[\"webstore\"]' \"/subscriptions/&lt;SUB_ID&gt;/resourceGroups/&lt;RG_NAME&gt;/providers/Microsoft.Storage/storageAccounts/webstore\"\n</code></pre>"},{"location":"02-Terraform-Basics-and-CLI/02-resource-targeting-and-import/#importing-module-resources","title":"Importing Module Resources","text":"<pre><code>module \"vnet\" {\n  source = \"./modules/vnet-gw\"\n}\n</code></pre> <pre><code>terraform import module.vpc.azure_vnet.main vnet-01\n</code></pre>"},{"location":"02-Terraform-Basics-and-CLI/02-resource-targeting-and-import/#finding-resource-ids","title":"Finding Resource IDs","text":"<p>Azure CLI: <pre><code># List all VMs with name + resource ID\naz vm list --query '[].{name:name, id:id, rg:resourceGroup}' -o table\n\n# List all storage accounts\naz storage account list --query '[].{name:name, rg:resourceGroup, id:id}' -o table\n\n# Get a specific storage account\u2019s resource ID\naz storage account show -g &lt;RESOURCE_GROUP&gt; -n &lt;ACCOUNT_NAME&gt; --query id -o tsv\n\n# Vnet\naz network vnet list --query '[].{name:name, rg:resourceGroup, id:id, address:addressSpace}' -o table\n</code></pre></p> <p>Azure Portal:</p>"},{"location":"02-Terraform-Basics-and-CLI/02-resource-targeting-and-import/#virtual-machine","title":"Virtual Machine","text":"<ul> <li>Azure Portal \u2192 Virtual Machines \u2192 Settings \u2192 Properties \u2192 Resource ID</li> </ul>"},{"location":"02-Terraform-Basics-and-CLI/02-resource-targeting-and-import/#storage-account","title":"Storage Account","text":"<ul> <li>Azure Portal \u2192 Storage Accounts \u2192 Settings \u2192 Properties \u2192 Resource ID</li> </ul>"},{"location":"02-Terraform-Basics-and-CLI/02-resource-targeting-and-import/#virtual-network","title":"Virtual Network","text":"<ul> <li>Azure Portal \u2192 Virtual Networks \u2192 Settings \u2192 Properties \u2192 Resource ID</li> </ul>"},{"location":"02-Terraform-Basics-and-CLI/02-resource-targeting-and-import/#import-challenges","title":"Import Challenges","text":""},{"location":"02-Terraform-Basics-and-CLI/02-resource-targeting-and-import/#challenge-1-configuration-mismatch","title":"Challenge 1: Configuration Mismatch","text":"<p>After import, <code>terraform plan</code> shows many changes because your configuration doesn't match reality.</p> <p>Solution: 1. Run <code>terraform show azurerm_linux_virtual_machine.web</code> (or resource equivalent) to see actual attributes 2. Update your configuration to match 3. Run <code>terraform plan</code> again to verify</p>"},{"location":"02-Terraform-Basics-and-CLI/02-resource-targeting-and-import/#challenge-2-missing-dependencies","title":"Challenge 2: Missing Dependencies","text":"<p>Resource exists but depends on other resources not in Terraform.</p> <p>Example: <pre><code>terraform import azurerm_linux_virtual_machine.web \"/subscriptions/{subID}/resourceGroups/test-rg/providers/Microsoft.Compute/virtualMachines/myvm01\"\n# Error: Network Security group nsg-test doesn't exist in state\n</code></pre></p> <p>Solution: 1. Import dependencies first:    <pre><code>terraform import azurerm_network_security_group.web sg-test\nterraform import azurerm_linux_virtual_machine.web \"/subscriptions/{subID}/resourceGroups/test-rg/providers/Microsoft.Compute/virtualMachines/myvm01\"\n</code></pre></p>"},{"location":"02-Terraform-Basics-and-CLI/02-resource-targeting-and-import/#challenge-3-complex-resources","title":"Challenge 3: Complex Resources","text":"<p>Some resources have many attributes that must match exactly.</p> <p>Solution: - Use <code>terraform show</code> to get all attributes - Copy attributes into configuration - Or use tools like <code>terraformer</code> for bulk imports</p>"},{"location":"02-Terraform-Basics-and-CLI/02-resource-targeting-and-import/#import-vs-manual-state-manipulation","title":"Import vs Manual State Manipulation","text":"<p>Import (recommended): - \u2705 Safe and verified - \u2705 Creates proper resource in state - \u2705 Validates resource exists</p> <p>Manual state add (advanced, risky): <pre><code># NOT recommended - use import instead\nterraform state rm azurerm_linux_virtual_machine.web\nterraform import azurerm_linux_virtual_machine.web \"/subscriptions/{subID}/resourceGroups/test-rg/providers/Microsoft.Compute/virtualMachines/myvm01\"\n</code></pre></p>"},{"location":"02-Terraform-Basics-and-CLI/02-resource-targeting-and-import/#bulk-import-strategies","title":"Bulk Import Strategies","text":"<p>Option 1: Script multiple imports <pre><code>#!/bin/bash\nterraform import azurerm_linux_virtual_machine.web[0] \"/subscriptions/{subID}/resourceGroups/test-rg/providers/Microsoft.Compute/virtualMachines/myvm-0\"\nterraform import azurerm_linux_virtual_machine.web[1] \"/subscriptions/{subID}/resourceGroups/test-rg/providers/Microsoft.Compute/virtualMachines/myvm-1\"\n</code></pre></p> <p>Option 2: Use terraformer (third-party tool) <pre><code>terraformer import azure --resources=virtual_network,subnet,network_security_group --subscription=\"&lt;SUBSCRIPTION_ID&gt;\" --resource-group=\"&lt;RESOURCE_GROUP_NAME&gt;\"\n</code></pre></p>"},{"location":"02-Terraform-Basics-and-CLI/02-resource-targeting-and-import/#3-combining-targeting-and-import","title":"3. Combining Targeting and Import","text":""},{"location":"02-Terraform-Basics-and-CLI/02-resource-targeting-and-import/#workflow-import-and-verify","title":"Workflow: Import and Verify","text":"<pre><code># 1. Import the resource\nterraform import azurerm_linux_virtual_machine.web \"/subscriptions/{subID}/resourceGroups/test-rg/providers/Microsoft.Compute/virtualMachines/myvm\"\n\n# 2. Plan with targeting to see differences\nterraform plan -target=azurerm_linux_virtual_machine.web\n\n# 3. Update configuration if needed\n\n# 4. Apply to sync\nterraform apply -target=azurerm_linux_virtual_machine.web\n</code></pre>"},{"location":"02-Terraform-Basics-and-CLI/02-resource-targeting-and-import/#workflow-import-dependencies-first","title":"Workflow: Import Dependencies First","text":"<pre><code># 1. Import Vnet\nterraform import azurerm_virtual_network.main \"/subscriptions/{subID}/resourceGroups/test-rg/providers/Microsoft.Network/virtualNetworks/my-vnet\"\n\n# 2. Import network security group\nterraform import azurerm_network_security_group.web sg-test\n\n# 3. Import Virtual Machine (depends on above)\nterraform import azurerm_linux_virtual_machine.web \"/subscriptions/{subID}/resourceGroups/test-rg/providers/Microsoft.Compute/virtualMachines/myvm01\"\n\n# 4. Plan all imported resources\nterraform plan -target=azurerm_virtual_network.main -target=azurerm_network_security_group.web -target=azurerm_linux_virtual_machine.web\n</code></pre>"},{"location":"02-Terraform-Basics-and-CLI/02-resource-targeting-and-import/#4-practice-questions","title":"4. Practice Questions","text":""},{"location":"02-Terraform-Basics-and-CLI/02-resource-targeting-and-import/#question-1","title":"Question 1","text":"<p>You want to apply changes to only one Virtual Machine without affecting others. What command should you use? A) <code>terraform apply -filter=azurerm_linux_virtual_machine.web</code> B) <code>terraform apply -target=azurerm_linux_virtual_machine.web</code> C) <code>terraform apply -resource=azurerm_linux_virtual_machine.web</code> D) <code>terraform apply azurerm_linux_virtual_machine.web</code></p> Show Answer Answer: **B** - Use `-target` flag to apply operations to specific resources. The syntax is `terraform apply -target=resource_address`."},{"location":"02-Terraform-Basics-and-CLI/02-resource-targeting-and-import/#question-2","title":"Question 2","text":"<p>What is the correct import command syntax? A) <code>terraform import infrastructure_id resource_address</code> B) <code>terraform import resource_address infrastructure_id</code> C) <code>terraform import -resource=resource_address infrastructure_id</code> D) <code>terraform import resource_address -id=infrastructure_id</code></p> Show Answer Answer: **B** - The syntax is `terraform import resource_address infrastructure_id`. The resource address (terraform address) comes first, then the actual infrastructure ID (azure resource)."},{"location":"02-Terraform-Basics-and-CLI/02-resource-targeting-and-import/#question-3","title":"Question 3","text":"<p>After importing a resource, <code>terraform plan</code> shows many changes. What should you do? A) Run <code>terraform apply</code> immediately B) Delete the imported resource and recreate it C) Update your configuration to match the actual resource attributes D) Ignore the changes</p> Show Answer Answer: **C** - After import, you should review `terraform state show` to see actual attributes, then update your configuration to match. This prevents unwanted changes on the next apply."},{"location":"02-Terraform-Basics-and-CLI/02-resource-targeting-and-import/#5-key-takeaways","title":"5. Key Takeaways","text":"<ul> <li>Targeting: Use <code>-target</code> to operate on specific resources. Syntax: <code>terraform plan -target=resource_address</code>.</li> <li>Import: Brings existing infrastructure under Terraform management. Syntax: <code>terraform import resource_address infrastructure_id</code>.</li> <li>Import process: Add resource block \u2192 import \u2192 verify state \u2192 update config \u2192 apply.</li> <li>Targeting limitations: Doesn't automatically resolve all dependencies - may need to target dependencies manually.</li> <li>Configuration matching: After import, update your <code>.tf</code> file to match actual resource attributes.</li> <li>Dependencies: Import dependent resources (network security groups, Vnets) before resources that depend on them.</li> <li>Verification: Always run <code>terraform plan</code> after import to identify configuration mismatches.</li> </ul>"},{"location":"02-Terraform-Basics-and-CLI/02-resource-targeting-and-import/#references","title":"References","text":"<ul> <li>Terraform Resource Targeting</li> <li>Terraform Import</li> <li>Import Command</li> </ul>"},{"location":"03-Terraform-Configuration-Language/","title":"Terraform Configuration Language","text":""},{"location":"03-Terraform-Configuration-Language/#what-youll-learn","title":"What you'll learn","text":"<ul> <li>Declare variables, outputs, locals, and dynamic expressions.</li> <li>Use functions, conditional logic, <code>for_each</code>, and <code>count</code> effectively.</li> <li>Structure modules with clear input/output contracts using the language syntax.</li> <li>Apply provisioners and meta-arguments responsibly.</li> </ul>"},{"location":"03-Terraform-Configuration-Language/#topics","title":"Topics","text":"<ul> <li>Variables and Outputs</li> <li>For Each vs Count</li> <li>Lifecycle Blocks</li> </ul>"},{"location":"03-Terraform-Configuration-Language/#cheat-sheet","title":"Cheat sheet","text":"<ul> <li>Variable definition: <code>variable \"name\" { type = string }</code></li> <li>Reference locals: <code>local.example</code></li> <li>Conditional: <code>condition ? true_val : false_val</code></li> <li>Loop with for_each: <code>for_each = toset(var.names)</code></li> <li>Output: <code>output \"id\" { value = resource.id }</code></li> </ul>"},{"location":"03-Terraform-Configuration-Language/#official-documentation","title":"Official documentation","text":"<ul> <li>Language Overview</li> <li>Expressions and Functions</li> <li>Meta-Arguments</li> </ul>"},{"location":"03-Terraform-Configuration-Language/#hands-on-task","title":"Hands-on task","text":"<p>Create a <code>variables.tf</code> and <code>main.tf</code>: <pre><code>variable \"environment\" {\n  type    = string\n  default = \"dev\"\n}\n\nlocals {\n  tags = {\n    environment = var.environment\n    owner       = \"platform\"\n  }\n}\n\nresource \"null_resource\" \"configured\" {\n  for_each = local.tags\n\n  triggers = {\n    key   = each.key\n    value = each.value\n  }\n}\n</code></pre> Run <code>terraform console</code> and evaluate <code>local.tags</code> and <code>null_resource.configured[\"environment\"].triggers</code>.</p>"},{"location":"03-Terraform-Configuration-Language/01-variables-and-outputs/","title":"Variables And Outputs","text":""},{"location":"03-Terraform-Configuration-Language/01-variables-and-outputs/#learning-objectives","title":"Learning Objectives","text":"<ul> <li>Understand how variables make Terraform configurations reusable and dynamic.</li> <li>Learn the different variable types, defaults, and precedence.</li> <li>Use outputs to share data between resources, modules, and users.</li> <li>Follow best practices for sensitive data, organization, and documentation.</li> </ul>"},{"location":"03-Terraform-Configuration-Language/01-variables-and-outputs/#1-why-use-variables","title":"\ud83e\udde9 1. Why Use Variables?","text":"<p>Hardcoding values (like instance types or AMI IDs) limits flexibility and reusability. Variables allow Terraform to behave like a parameterized template, making it easy to: - Reuse configurations across environments (dev, test, prod) - Avoid duplication - Inject values dynamically (from CLI, files, or pipelines)</p>"},{"location":"03-Terraform-Configuration-Language/01-variables-and-outputs/#2-declaring-variables","title":"2. Declaring Variables","text":"<p>Variables are typically defined in a file named <code>variables.tf</code>:</p> <pre><code>variable \"account_tier\" {\n  type        = string\n  default     = \"Standard\"\n}\n</code></pre> <p>You reference a variable in code with the prefix var.:</p> <pre><code>resource \"azurerm_storage_account\" \"data\" {\n  name                     = \"test-sa\"\n  resource_group_name      = \"test-rg\"\n  location                 = \"westeurope\"\n  account_tier             = var.account_tier\n  account_replication_type = \"LRS\"\n}\n</code></pre> <p>If no default is provided, Terraform will prompt you during plan or apply.</p>"},{"location":"03-Terraform-Configuration-Language/01-variables-and-outputs/#3-variable-types","title":"3. Variable Types","text":"<p>Terraform supports multiple data types.</p> Type Example Description string <code>\"Standard\"</code> Text value number <code>3</code> Integer or float bool <code>true</code> Boolean value list(string) <code>[\"dev\", \"test\", \"prod\"]</code> Ordered list of strings map(string) <code>{ region = \"uksouth\", env = \"dev\" }</code> Key/value pairs object <code>object({ name = string, size = number })</code> Complex structure tuple <code>[true, \"Standard\", 2]</code> Fixed collection of values set(string) <code>set([\"Standard\", \"Premium\"])</code> Unique, unordered values"},{"location":"03-Terraform-Configuration-Language/01-variables-and-outputs/#4-variable-precedence","title":"4. Variable Precedence","text":"<p>Terraform reads variables from multiple sources. If the same variable is defined in multiple places, the following precedence order applies (highest \u2192 lowest):</p> Source Example Priority CLI flags <code>terraform apply -var=\"region=uksouth\"</code> \ud83e\udd47 Highest <code>.tfvars</code> file passed explicitly <code>terraform apply -var-file=prod.tfvars</code> Environment variables <code>export TF_VAR_region=uksouth</code> Auto-loaded files <code>*.auto.tfvars</code> <code>terraform.tfvars</code> Auto-loaded default file Variable default in code <code>default = \"uksouth\"</code> \ud83e\udd49 Lowest <p>Example question (exam-style):</p> <p>A variable is defined in terraform.tfvars, as an environment variable, and in the variable block with a default. Which value will Terraform use?</p> <p>Answer: The environment variable (TF_VAR) value.</p>"},{"location":"03-Terraform-Configuration-Language/01-variables-and-outputs/#5-sensitive-variable-credentialspasswords","title":"5. Sensitive Variable (Credentials/Passwords)","text":"<p>Mark sensitive variables to prevent Terraform from displaying them in logs or outputs with the sensitive = true tag.  <pre><code>variable \"db_password\" {\n  description = \"Database password\"\n  type        = string\n  sensitive   = true\n}\n</code></pre> Sensitive values still exist in memory and state, but they\u2019ll be redacted in CLI output: <pre><code>Outputs:\n\ndb_password = (sensitive value)\n</code></pre> For true secrecy, store them securely (Azure Key Vault, Devops Variable groups, etc.) and retrieve with data sources.</p>"},{"location":"03-Terraform-Configuration-Language/01-variables-and-outputs/#6-variable-files-tfvars","title":"6. Variable Files (.tfvars)","text":"<p>Instead of defining values interactively, use a .tfvars file.</p> <p>terraform.tfvars: <pre><code>region         = \"uksouth\"\naccount_tier   = \"Standard\"\nenvironment    = \"dev\"\n</code></pre> Then apply:  <pre><code>terraform apply\n\n# or specify custom files:\nterraform apply -var-file=prod.tfvars\n</code></pre> This keeps configurations clean and environment-specific.</p>"},{"location":"03-Terraform-Configuration-Language/01-variables-and-outputs/#7-outputs","title":"7. Outputs","text":"<p>Outputs expose information after Terraform creates resources \u2014 for example, the public IP of an instance or the ARN of a resource. <pre><code>output \"virtual_machine_ip\" {\n  description = \"IP of the Virtual Machine\"\n  value       = azurerm_linux_virtual_machine.web.private_ip_address\n}\n</code></pre> Run:  <pre><code>terraform output\nterraform output virtual_machine_ip\n</code></pre> Marking Outputs as Sensitive <pre><code>output \"db_password\" {\n  value     = azurerm_mssql_managed_instance.main.password\n  sensitive = true\n}\n</code></pre> This hides it in CLI output but still stores it in state.</p>"},{"location":"03-Terraform-Configuration-Language/01-variables-and-outputs/#8-sharing-data-between-modules","title":"8. Sharing Data Between Modules","text":"<p>Outputs are also how modules pass data between each other.</p> <p>Child module vnet/outputs.tf: <pre><code>output \"subnet_id\" {\n  value = azurerm_subnet.private.id\n}\n</code></pre> Root Module (main.tf) : <pre><code>module \"vnet\" {\n  source = \"./vnet\"\n}\n\nresource \"azurerm_private_endpoint\" \"example\" {\n  name                = \"my-pep\"\n  location            = azurerm_resource_group.main.location\n  resource_group_name = azurerm_resource_group.main.name\n  subnet_id           = module.vnet.subnet_id\n\n  private_service_connection {\n    name                           = \"myConnection\"\n    private_connection_resource_id = azurerm_storage_account.example.id\n    subresource_names              = [\"blob\"]\n    is_manual_connection           = false\n  }\n}\n</code></pre></p>"},{"location":"03-Terraform-Configuration-Language/01-variables-and-outputs/#9-practical-example","title":"9. Practical Example","text":"<p>variables.tf <pre><code>variable \"account_tier\" {\n  type        = string\n  default     = \"Standard\"\n}\n</code></pre> main.tf <pre><code>provider \"azurerm\" {\n  region = \"uksouth\"\n}\n\nresource \"azurerm_storage_account\" \"data\" {\n  name                     = \"test-sa\"\n  resource_group_name      = \"test-rg\"\n  location                 = \"uksouth\"\n  account_tier             = var.account_tier\n  account_replication_type = \"LRS\"\n}\n\noutput \"storage_account_id\" {\n  value       = azurerm_storage_account.web.id\n  description = \"Storage Accounts ID\"\n}\n</code></pre> Run:  <pre><code>terraform apply -var=\"account_tier=Standard\"\n</code></pre></p>"},{"location":"03-Terraform-Configuration-Language/01-variables-and-outputs/#note-resource-ids-in-examples-are-placeholders-in-real-deployments-use-data-sources-to-fetch-the-latest-resource-ids","title":"Note: Resource IDs in examples are placeholders. In real deployments, use ` data sources to fetch the latest Resource IDs.","text":""},{"location":"03-Terraform-Configuration-Language/01-variables-and-outputs/#10-best-practices","title":"10. Best Practices","text":"Practice Reason Group variables logically in <code>variables.tf</code> Improves readability Use clear names and descriptions Easier for teams to maintain Use <code>.tfvars</code> files for environment-specific data Keeps configs clean Never store secrets in plain <code>.tfvars</code> or code Use Azure Key Vaults, Devops Variables, etc Use outputs sparingly Only expose what's necessary Combine outputs with <code>sensitive = true</code> Hide confidential info"},{"location":"03-Terraform-Configuration-Language/01-variables-and-outputs/#11-practice-questions","title":"11. Practice Questions","text":""},{"location":"03-Terraform-Configuration-Language/01-variables-and-outputs/#question-1","title":"Question 1","text":"<p>A variable is defined in <code>terraform.tfvars</code>, as an environment variable <code>TF_VAR_region</code>, and in the variable block with a default value. Which value will Terraform use? A) The default value B) The value from terraform.tfvars C) The environment variable value D) Terraform will prompt for input</p> Show Answer Answer: **C** - Environment variables (TF_VAR_*) have higher precedence than .tfvars files and defaults. Precedence order: CLI flags &gt; .tfvars &gt; environment variables &gt; defaults."},{"location":"03-Terraform-Configuration-Language/01-variables-and-outputs/#question-2","title":"Question 2","text":"<p>What does <code>sensitive = true</code> do for a variable? A) Encrypts the value in the state file B) Prevents the value from being stored in state C) Hides the value from CLI output but still stores it in state D) Requires the value to be provided via secret manager</p> Show Answer Answer: **C** - `sensitive = true` redacts the value from Terraform CLI output and logs, but the value is still stored in state. For true security, use external secret management."},{"location":"03-Terraform-Configuration-Language/01-variables-and-outputs/#question-3","title":"Question 3","text":"<p>How do you reference a module's output value in the root module? A) <code>module.&lt;module-name&gt;.&lt;output-name&gt;</code> B) <code>output.&lt;module-name&gt;.&lt;output-name&gt;</code> C) <code>var.&lt;module-name&gt;.&lt;output-name&gt;</code> D) <code>module.&lt;module-name&gt;.output.&lt;output-name&gt;</code></p> Show Answer Answer: **A** - Module outputs are accessed using `module..`. For example, `module.vpc.vpc_id` gets the vpc_id output from the vpc module."},{"location":"03-Terraform-Configuration-Language/01-variables-and-outputs/#12-key-takeaways","title":"12. Key Takeaways","text":"<ul> <li>Variables make Terraform reusable, modular, and environment-friendly.</li> <li>Precedence determines which variable value Terraform uses at runtime.</li> <li>Sensitive variables mask output but still exist in state \u2014 protect the state file.</li> <li>Outputs help share data between resources, modules, and users.</li> <li>Together, variables + outputs make your Terraform code maintainable and scalable.</li> </ul>"},{"location":"03-Terraform-Configuration-Language/02-for-each-vs-count/","title":"For Each Vs Count","text":""},{"location":"03-Terraform-Configuration-Language/02-for-each-vs-count/#learning-objectives","title":"Learning Objectives","text":"<ul> <li>Understand when to use <code>for_each</code> vs <code>count</code> to create multiple resource instances.</li> <li>Learn the key differences, limitations, and best practices for each.</li> <li>Master exam-style questions about resource creation patterns.</li> <li>Recognize common pitfalls and when each approach is appropriate.</li> </ul>"},{"location":"03-Terraform-Configuration-Language/02-for-each-vs-count/#1-overview-creating-multiple-resources","title":"1. Overview: Creating Multiple Resources","text":"<p>Terraform provides two meta-arguments to create multiple instances of a resource: - <code>count</code>: Creates resources based on a number - <code>for_each</code>: Creates resources based on a map or set</p> <p>Both serve similar purposes but have different use cases and behaviors.</p>"},{"location":"03-Terraform-Configuration-Language/02-for-each-vs-count/#2-using-count","title":"2. Using <code>count</code>","text":""},{"location":"03-Terraform-Configuration-Language/02-for-each-vs-count/#basic-syntax","title":"Basic Syntax","text":"<pre><code>resource \"azurerm_linux_virtual_machine\" \"web\" {\n  count               = 2\n  name                = \"myvm-${count.index}\"\n  resource_group_name = \"test-rg\"\n  location            = \"uksouth\"\n  size                = \"Standard_B1s\"\n\n  admin_username      = \"azureuser\"\n\n  network_interface_ids = [\n    \"/subscriptions/{subID}/resourceGroups/test-rg/providers/Microsoft.Network/networkInterfaces/myvm-${count.index}-nic\"\n  ]\n\n  os_disk {\n    caching              = \"ReadWrite\"\n    storage_account_type = \"Standard_LRS\"\n  }\n\n  source_image_reference {\n    publisher = \"Canonical\"\n    offer     = \"0001-com-ubuntu-server-focal\"\n    sku       = \"20_04-lts\"\n    version   = \"latest\"\n  }\n}\n</code></pre> <p>What it does: - Creates 3 identical EC2 instances - <code>count.index</code> provides 0, 1, 2 for each instance - Resource address: <code>azurerm_linux_virtual_machine.web[0]</code>, <code>azurerm_linux_virtual_machine.web[1]</code>, <code>azurerm_linux_virtual_machine.web[2]</code></p>"},{"location":"03-Terraform-Configuration-Language/02-for-each-vs-count/#referencing-resources-created-with-count","title":"Referencing Resources Created with <code>count</code>","text":"<pre><code># Output all instance IDs\noutput \"instance_ids\" {\n  value = azurerm_linux_virtual_machine.web[*].id\n}\n\n# Output specific instance\noutput \"first_instance_id\" {\n  value = azurerm_linux_virtual_machine.web[0].id\n}\n\n# Reference in another resource\nresource \"azurerm_network_interface\" \"vmnic\" {\n  count               = 2\n  name                = \"vmnic-${count.index}\"\n  location            = azurerm_resource_group.rg.location\n  resource_group_name = azurerm_resource_group.rg.name\n\n  ip_configuration {\n    name                          = \"internal\"\n    subnet_id                     = azurerm_subnet.app.id\n    private_ip_address_allocation = \"Dynamic\"\n    load_balancer_backend_address_pools_ids = [\n      azurerm_lb_backend_address_pool.example.id\n    ]\n  }\n}\n</code></pre>"},{"location":"03-Terraform-Configuration-Language/02-for-each-vs-count/#when-to-use-count","title":"When to Use <code>count</code>","text":"<p>\u2705 Good for: - Creating a known number of identical resources - Simple scenarios where you just need N copies - When order/index matters</p> <p>\u274c Not ideal for: - Resources that need unique names/identifiers - When you might need to remove middle items (causes recreation) - Maps or sets of items with unique keys</p>"},{"location":"03-Terraform-Configuration-Language/02-for-each-vs-count/#3-using-for_each","title":"3. Using <code>for_each</code>","text":""},{"location":"03-Terraform-Configuration-Language/02-for-each-vs-count/#basic-syntax-with-map","title":"Basic Syntax (with Map)","text":"<pre><code>storage_accounts = [\n  { name = \"sa-01\" },\n  { name = \"sa-02\" }\n]\n</code></pre> <pre><code>resource \"azurerm_storage_account\" \"example\" {\n  for_each = { for account in var.storage_accounts : account.name =&gt; account if var.environment != \"dr\" }\n\n  name                     = each.value.name\n  resource_group_name      = azurerm_resource_group.rg[each.value.name].name\n  location                 = var.location\n  account_tier             = try(each.value.account_tier, \"Standard\")\n  account_kind             = try(each.value.account_kind, \"StorageV2\")\n  account_replication_type = try(each.value.account_replication_type, \"LRS\")\n}\n</code></pre> <p>What it does: - Creates 3 instances with unique keys: <code>sa-01</code>, <code>sa-02</code> - <code>each.key = the key values as per \"account.name\" (sa-01) -</code>each.value<code>= the map value (e.g., \"sa-01\") - Resource address:</code>azurerm_storage_account.example[\"sa-01\"]<code>,</code>azurerm_storage_account.example[\"sa-02\"]`, etc.</p>"},{"location":"03-Terraform-Configuration-Language/02-for-each-vs-count/#referencing-resources-created-with-for_each","title":"Referencing Resources Created with <code>for_each</code>","text":"<pre><code># Output all instance IDs as map\noutput \"instance_ids\" {\n  value = {\n    for k, instance in azurerm_storage_account.example : k =&gt; instance.id\n  }\n}\n\n# Output specific instance\noutput \"storage_account_output\" {\n  value = azurerm_storage_account.example[\"sa-01\"].id\n}\n\n# Reference in another resource\nresource \"azurerm_storage_account_network_rules\" \"sa_fw_rules\" {\n   storage_account_id = values(azurerm_storage_account.example)[*].id\n}\n</code></pre>"},{"location":"03-Terraform-Configuration-Language/02-for-each-vs-count/#when-to-use-for_each","title":"When to Use <code>for_each</code>","text":"<p>\u2705 Good for: - Resources with unique identifiers (names, tags) - Maps or sets of items - When you need to add/remove specific items without affecting others - Resources that should not be recreated when list order changes</p> <p>\u274c Not ideal for: - Simple \"create N copies\" scenarios (count is simpler) - When order/index is what matters</p>"},{"location":"03-Terraform-Configuration-Language/02-for-each-vs-count/#4-key-differences-count-vs-for_each","title":"4. Key Differences: <code>count</code> vs <code>for_each</code>","text":"Feature <code>count</code> <code>for_each</code> Input Type Number Map or Set Resource Address <code>resource[0]</code>, <code>resource[1]</code> <code>resource[\"key\"]</code> Index Access <code>count.index</code> <code>each.key</code>, <code>each.value</code> Removing Middle Item Recreates all items after it Only affects that specific item Order Matters \u2705 Yes \u274c No Use with Maps \u274c No (convert to list) \u2705 Yes Use with Sets \u274c No \u2705 Yes Better for Unique IDs \u274c No \u2705 Yes"},{"location":"03-Terraform-Configuration-Language/02-for-each-vs-count/#5-practical-comparison-examples","title":"5. Practical Comparison Examples","text":""},{"location":"03-Terraform-Configuration-Language/02-for-each-vs-count/#example-1-simple-web-servers","title":"Example 1: Simple Web Servers","text":"<p>Using <code>count</code>: <pre><code>resource \"azurerm_linux_virtual_machine\" \"web\" {\n  count               = 2\n  name                = \"myvm-${count.index}\"\n  resource_group_name = \"test-rg\"\n  location            = \"uksouth\"\n  size                = \"Standard_B1s\"\n\n  admin_username      = \"azureuser\"\n\n  network_interface_ids = [\n    \"/subscriptions/{subID}/resourceGroups/test-rg/providers/Microsoft.Network/networkInterfaces/myvm-${count.index}-nic\"\n  ]\n\n  os_disk {\n    caching              = \"ReadWrite\"\n    storage_account_type = \"Standard_LRS\"\n  }\n\n  source_image_reference {\n    publisher = \"Canonical\"\n    offer     = \"0001-com-ubuntu-server-focal\"\n    sku       = \"20_04-lts\"\n    version   = \"latest\"\n  }\n}\n</code></pre></p> <p>Using <code>for_each</code>: <pre><code>resource \"azurerm_linux_virtual_machine\" \"web\" {\n  for_each = toset([\"web-1\", \"web-2\", \"web-3\"])\n\n  ami           = \"ami-0123456789abcdef0\"  # Example AMI ID\n  instance_type = \"t2.micro\"\n  tags = {\n    Name = each.key\n  }\n}\n\nresource \"azurerm_linux_virtual_machine\" \"web\" {\n  for_each = toset([\"web-1\", \"web-2\", \"web-3\"])\n  name                = \"${each.value}-nic\"\n  resource_group_name = \"test-rg\"\n  location            = \"uksouth\"\n  size                = \"Standard_B1s\"\n\n  admin_username      = \"azureuser\"\n\n  network_interface_ids = [\n    \"/subscriptions/{subID}/resourceGroups/test-rg/providers/Microsoft.Network/networkInterfaces/myvm-${each.value}-nic\"\n  ]\n\n  os_disk {\n    caching              = \"ReadWrite\"\n    storage_account_type = \"Standard_LRS\"\n  }\n\n  source_image_reference {\n    publisher = \"Canonical\"\n    offer     = \"0001-com-ubuntu-server-focal\"\n    sku       = \"20_04-lts\"\n    version   = \"latest\"\n  }\n}\n</code></pre></p>"},{"location":"03-Terraform-Configuration-Language/02-for-each-vs-count/#example-2-different-instance-types","title":"Example 2: Different Instance Types","text":"<p>Using <code>for_each</code> (better choice): <pre><code>resource \"azurerm_linux_virtual_machine\" \"web\" {\n  for_each = {\n    frontend = \"Standard_B2s\"\n    backend  = \"Standard_D2s_v3\"\n    cache    = \"Standard_B1ms\"\n  }\n\n  name                = each.key\n  resource_group_name = \"test-rg\"\n  location            = \"uksouth\"\n  size                = each.value\n  admin_username      = \"azureuser\"\n\n  network_interface_ids = [\n    azurerm_network_interface.webnic[each.key].id\n  ]\n\n  os_disk {\n    caching              = \"ReadWrite\"\n    storage_account_type = \"Standard_LRS\"\n  }\n\n  source_image_reference {\n    publisher = \"Canonical\"\n    offer     = \"0001-com-ubuntu-server-focal\"\n    sku       = \"20_04-lts\"\n    version   = \"latest\"\n  }\n}\n</code></pre></p> <p>Why <code>for_each</code> here? - Each virtual machine has unique configuration - Names map to roles (frontend, backend, cache) - Removing one doesn't affect others' addresses</p>"},{"location":"03-Terraform-Configuration-Language/02-for-each-vs-count/#6-common-pitfalls-and-gotchas","title":"6. Common Pitfalls and Gotchas","text":""},{"location":"03-Terraform-Configuration-Language/02-for-each-vs-count/#pitfall-1-removing-middle-item-with-count","title":"Pitfall 1: Removing Middle Item with <code>count</code>","text":"<pre><code># Initial: count = 3 creates [0], [1], [2]\n# Change to: count = 2\n# Result: [0] stays, [1] becomes new [1] (was [2]), [2] destroyed\n# Old [1] is destroyed even though you only wanted to remove [2]\n</code></pre> <p>Solution: Use <code>for_each</code> if you need to remove specific items.</p>"},{"location":"03-Terraform-Configuration-Language/02-for-each-vs-count/#pitfall-2-for_each-requires-map-or-set","title":"Pitfall 2: <code>for_each</code> Requires Map or Set","text":"<pre><code># \u274c This will ERROR\nresource \"azurerm_linux_virtual_machine\" \"web\" {\n  for_each = [\"web-1\", \"web-2\"]  # List, not set!\n}\n\n# \u2705 Correct - convert to set\nresource \"azurerm_linux_virtual_machine\" \"web\" {\n  for_each = toset([\"web-1\", \"web-2\"])\n}\n</code></pre>"},{"location":"03-Terraform-Configuration-Language/02-for-each-vs-count/#pitfall-3-cannot-use-both-count-and-for_each","title":"Pitfall 3: Cannot Use Both <code>count</code> and <code>for_each</code>","text":"<pre><code># \u274c ERROR: Cannot use both count and for_each\nresource \"azurerm_linux_virtual_machine\" \"web\" {\n  count    = 3\n  for_each = { a = \"b\" }\n}\n</code></pre> <p>You must choose one or the other.</p>"},{"location":"03-Terraform-Configuration-Language/02-for-each-vs-count/#pitfall-4-changing-from-count-to-for_each","title":"Pitfall 4: Changing from <code>count</code> to <code>for_each</code>","text":"<pre><code># Initial state with count\nresource \"azurerm_linux_virtual_machine\" \"web\" {\n  count = 2\n  # Creates: azurerm_linux_virtual_machine.web[0], azurerm_linux_virtual_machine.web[1]\n}\n\n# Changing to for_each\nresource \"azurerm_linux_virtual_machine\" \"web\" {\n  for_each = toset([\"web-1\", \"web-2\"])\n  # Creates: azurerm_linux_virtual_machine.web[\"web-1\"], azurerm_linux_virtual_machine.web[\"web-2\"]\n}\n</code></pre> <p>This will cause Terraform to destroy old resources and create new ones. Solution: Use <code>terraform state mv</code> to migrate: <pre><code>terraform state mv 'azurerm_linux_virtual_machine.web[0]' 'azurerm_linux_virtual_machine.web[\"web-1\"]'\nterraform state mv 'azurerm_linux_virtual_machine.web[1]' 'azurerm_linux_virtual_machine.web[\"web-2\"]'\n</code></pre></p>"},{"location":"03-Terraform-Configuration-Language/02-for-each-vs-count/#7-converting-between-count-and-for_each","title":"7. Converting Between <code>count</code> and <code>for_each</code>","text":""},{"location":"03-Terraform-Configuration-Language/02-for-each-vs-count/#converting-list-to-for_each","title":"Converting List to <code>for_each</code>","text":"<pre><code>variable \"server_names\" {\n  type    = list(string)\n  default = [\"web-1\", \"web-2\", \"web-3\"]\n}\n\n# Option 1: Convert list to set\nresource \"azurerm_linux_virtual_machine\" \"web\" {\n  for_each = toset(var.server_names)\n  # ...\n}\n\n# Option 2: Convert list to map with index\nresource \"azurerm_linux_virtual_machine\" \"web\" {\n  for_each = {\n    for idx, name in var.server_names : name =&gt; idx\n  }\n  # ...\n}\n</code></pre>"},{"location":"03-Terraform-Configuration-Language/02-for-each-vs-count/#converting-map-to-count","title":"Converting Map to <code>count</code>","text":"<pre><code>variable \"vms\" {\n  type = map(string)\n  default = {\n    web-1 = \"t2.micro\"\n    web-2 = \"t3.small\"\n  }\n}\n\n# Convert map to count (loses key names)\nresource \"azurerm_linux_virtual_machine\" \"web\" {\n  count = length(var.vms)\n\n  size = values(var.vms)[count.index]\n  tags = {\n    Name = keys(var.vms)[count.index]\n  }\n}\n</code></pre> <p>Note: Converting map \u2192 count loses the ability to reference by key and causes issues when removing items.</p>"},{"location":"03-Terraform-Configuration-Language/02-for-each-vs-count/#8-real-world-examples","title":"8. Real-World Examples","text":""},{"location":"03-Terraform-Configuration-Language/02-for-each-vs-count/#example-1-multi-region-resources","title":"Example 1: Multi-Region Resources","text":"<pre><code>variable \"regions\" {\n  type = set(string)\n  default = [\"uksouth\", \"ukwest\"]\n}\n\nresource \"azurerm_storage_account\" \"logs\" {\n  for_each = var.regions\n\n  name = \"company-logs-${each.value}\"\n\n  # Use provider alias for each region\n  provider = azurerm.region[each.value]\n}\n</code></pre> <p>Why <code>for_each</code>? Each storage account has unique name based on region key.</p>"},{"location":"03-Terraform-Configuration-Language/02-for-each-vs-count/#example-2-dynamic-security-groups","title":"Example 2: Dynamic Security Groups","text":"<pre><code>locals {\n  security_groups = {\n    web = {\n      ports = [80, 443]\n      cidr  = \"0.0.0.0/0\"\n    }\n    db = {\n      ports = [3306]\n      cidr  = \"10.0.0.0/16\"\n    }\n  }\n}\n\nresource \"azurerm_network_security_group\" \"ingress\" {\n  for_each = {\n    for sg_name, sg_config in local.security_groups :\n    sg_name =&gt; sg_config\n  }\n}\n</code></pre>"},{"location":"03-Terraform-Configuration-Language/02-for-each-vs-count/#example-3-conditional-resource-creation","title":"Example 3: Conditional Resource Creation","text":"<pre><code># Using count (simpler for boolean)\nvariable \"enabled_for_disk_encryption\" {\n  type    = bool\n  default = true\n}\n\nresource \"azurerm_key_vault\" \"main\" {\n  count = var.enabled_for_disk_encryption ? 1 : 0\n\n  # ...\n}\n\n# Using for_each (for conditional map)\nvariable \"environments\" {\n  type = map(object({\n    enabled = bool\n    region  = string\n  }))\n  default = {\n    prod = { enabled = true, region = \"uksouth\" }\n    dev  = { enabled = false, region = \"ukwest\" }\n  }\n}\n\nresource \"azurerm_key_vault\" \"main\" {\n  for_each = {\n    for k, v in var.environments : k =&gt; v\n    if v.enabled\n  }\n\n  # Only creates resources for enabled environments\n}\n</code></pre>"},{"location":"03-Terraform-Configuration-Language/02-for-each-vs-count/#9-exam-style-practice-questions","title":"9. Exam-Style Practice Questions","text":""},{"location":"03-Terraform-Configuration-Language/02-for-each-vs-count/#question-1","title":"Question 1","text":"<p>You need to create 5 identical VMs. Which approach is simplest? A) <code>for_each</code> with a set B) <code>count = 5</code> C) <code>for_each</code> with a map D) Define 5 separate resources</p> Show Answer Answer: **B** - `count = 5` is the simplest for identical resources."},{"location":"03-Terraform-Configuration-Language/02-for-each-vs-count/#question-2","title":"Question 2","text":"<p>What happens if you remove the middle item from a <code>count</code>-based resource list? A) Only that item is removed B) All items after it are recreated C) Nothing happens D) All items are recreated</p> Show Answer Answer: **B** - With `count`, removing a middle item causes all subsequent items to be recreated with new indices."},{"location":"03-Terraform-Configuration-Language/02-for-each-vs-count/#question-3","title":"Question 3","text":"<p>Which data types can be used with <code>for_each</code>? A) List and Map B) Set and Map only C) Number and List D) Any data type</p> Show Answer Answer: **B** - `for_each` only accepts maps or sets. Lists must be converted using `toset()`."},{"location":"03-Terraform-Configuration-Language/02-for-each-vs-count/#question-4","title":"Question 4","text":"<p>You have a map of instance configurations with unique names. Removing one instance should not affect others. Which should you use? A) <code>count</code> B) <code>for_each</code> C) Both work the same D) Neither - use separate resources</p> Show Answer Answer: **B** - `for_each` is better for maps with unique keys because removing one item doesn't affect others' addresses."},{"location":"03-Terraform-Configuration-Language/02-for-each-vs-count/#question-5","title":"Question 5","text":"<p>What is the correct syntax to reference a resource created with <code>for_each</code>? A) <code>azurerm_linux_virtual_machine.web[0]</code> B) <code>azurerm_linux_virtual_machine.web[\"web-1\"]</code> C) <code>azurerm_linux_virtual_machine.web.web-1</code> D) Both A and B work</p> Show Answer Answer: **B** - Resources created with `for_each` use map-style addresses: `resource[\"key\"]`. `count` uses index: `resource[0]`."},{"location":"03-Terraform-Configuration-Language/02-for-each-vs-count/#10-decision-tree","title":"10. Decision Tree","text":"<pre><code>Need to create multiple instances?\n\u2502\n\u251c\u2500 Are they identical?\n\u2502  \u251c\u2500 Yes \u2192 Use `count = N`\n\u2502  \u2514\u2500 No \u2192 Continue\n\u2502\n\u251c\u2500 Do they have unique names/keys?\n\u2502  \u251c\u2500 Yes \u2192 Use `for_each` with map\n\u2502  \u2514\u2500 No \u2192 Continue\n\u2502\n\u251c\u2500 Is it a list of items?\n\u2502  \u251c\u2500 Yes \u2192 Convert to set: `for_each = toset(list)`\n\u2502  \u2514\u2500 No \u2192 Continue\n\u2502\n\u2514\u2500 Need to add/remove specific items without affecting others?\n   \u251c\u2500 Yes \u2192 Use `for_each`\n   \u2514\u2500 No \u2192 `count` is fine\n</code></pre>"},{"location":"03-Terraform-Configuration-Language/02-for-each-vs-count/#11-key-takeaways","title":"11. Key Takeaways","text":"<ul> <li><code>count</code>: Use for a known number of identical resources. Creates indexed addresses <code>[0]</code>, <code>[1]</code>, etc.</li> <li><code>for_each</code>: Use for maps/sets with unique keys. Creates map-style addresses <code>[\"key\"]</code>.</li> <li><code>count</code> limitation: Removing middle items causes recreation of subsequent items.</li> <li><code>for_each</code> limitation: Must use maps or sets, not plain lists.</li> <li>Cannot combine: You can't use both <code>count</code> and <code>for_each</code> on the same resource.</li> <li>Conversion: Lists can be converted to sets with <code>toset()</code> for <code>for_each</code>.</li> <li>Migration: Changing from <code>count</code> to <code>for_each</code> requires state migration with <code>terraform state mv</code>.</li> </ul>"},{"location":"03-Terraform-Configuration-Language/02-for-each-vs-count/#references","title":"References","text":"<ul> <li>Terraform count Meta-Argument</li> <li>Terraform for_each Meta-Argument</li> <li>When to Use <code>for_each</code> Instead of <code>count</code></li> </ul>"},{"location":"03-Terraform-Configuration-Language/03-lifecycle-blocks/","title":"Lifecycle Blocks","text":""},{"location":"03-Terraform-Configuration-Language/03-lifecycle-blocks/#learning-objectives","title":"Learning Objectives","text":"<ul> <li>Understand all Terraform lifecycle meta-arguments and when to use each.</li> <li>Learn how to use <code>depends_on</code> for explicit dependency management.</li> <li>Learn how to prevent accidental resource destruction.</li> <li>Master <code>create_before_destroy</code> for zero-downtime updates.</li> <li>Control resource replacement behavior with lifecycle rules.</li> </ul>"},{"location":"03-Terraform-Configuration-Language/03-lifecycle-blocks/#1-what-are-lifecycle-blocks","title":"1. What are Lifecycle Blocks?","text":"<p>The <code>lifecycle</code> block is a meta-argument that controls how Terraform creates, updates, and destroys resources. It's placed inside a resource block.</p> <p>General syntax: <pre><code>resource \"azurerm_linux_virtual_machine\" \"web\" {\n  Name           = \"web-vm-01\"\n  size = \"Standard_B1s\"\n\n  lifecycle {\n    # Lifecycle rules go here\n  }\n}\n</code></pre></p>"},{"location":"03-Terraform-Configuration-Language/03-lifecycle-blocks/#2-lifecycle-meta-arguments-overview","title":"2. Lifecycle Meta-Arguments Overview","text":"<p>Terraform provides four lifecycle rules:</p> <ol> <li><code>prevent_destroy</code> - Prevents resource destruction</li> <li><code>create_before_destroy</code> - Creates new resource before destroying old</li> <li><code>ignore_changes</code> - Ignores changes to specific attributes</li> <li><code>replace_triggered_by</code> - Forces replacement when referenced resources change</li> </ol> <p>Additionally, Terraform provides the <code>depends_on</code> meta-argument for explicit dependency management, which is closely related to lifecycle management.</p>"},{"location":"03-Terraform-Configuration-Language/03-lifecycle-blocks/#3-depends_on-explicit-dependencies","title":"3. <code>depends_on</code> - Explicit Dependencies","text":""},{"location":"03-Terraform-Configuration-Language/03-lifecycle-blocks/#purpose","title":"Purpose","text":"<p>The <code>depends_on</code> meta-argument creates explicit dependencies between resources when Terraform cannot automatically infer the dependency from resource references. It ensures resources are created, updated, or destroyed in the correct order.</p>"},{"location":"03-Terraform-Configuration-Language/03-lifecycle-blocks/#implicit-vs-explicit-dependencies","title":"Implicit vs Explicit Dependencies","text":"<p>Implicit Dependencies (automatic): <pre><code>resource \"azurerm_key_vault\" \"main\" {\n  name                        = \"${local.location_abbreviated}-${var.subscription}-${var.environment}-${each.value.name}-kv\"\n}\n\nresource \"azurerm_key_vault_access_policy\" \"user_access\" {\n\n  key_vault_id = azurerm_key_vault.main.id ## Implicit Dependency\n}\n</code></pre></p> <p>Explicit Dependencies (using <code>depends_on</code>): <pre><code>resource \"azurerm_private_endpoint\" \"privateendpoint_aifoundry\" {\n  depends_on = [\n    azurerm_private_endpoint.pe_aisearch,\n    azapi_resource.ai_foundry\n  ]\n}\n</code></pre></p>"},{"location":"03-Terraform-Configuration-Language/03-lifecycle-blocks/#when-to-use-depends_on","title":"When to Use <code>depends_on</code>","text":"<p>Use <code>depends_on</code> when:</p> <ol> <li>No direct reference exists:    ```hcl    # Resource A must exist before Resource B, but B doesn't reference A    resource \"azapi_resource\" \"ai_foundry\" {    }</li> </ol> <p>resource \"azurerm_private_endpoint\" \"pe_aifoundry\" {   depends_on = [     azurerm_private_endpoint.pe_aisearch,     azapi_resource.ai_foundry   ]}    ```</p> <ol> <li>Side effects or external dependencies: <pre><code>resource \"azapi_resource\" \"ai_foundry\" {}\n</code></pre> <code>hcl        resource \"time_sleep\" \"wait_project_identities\" {    depends_on = [     azapi_resource.ai_foundry   ]    create_duration = \"10s\" }</code></li> </ol>"},{"location":"03-Terraform-Configuration-Language/03-lifecycle-blocks/#common-use-cases","title":"Common Use Cases","text":""},{"location":"03-Terraform-Configuration-Language/03-lifecycle-blocks/#use-case-1-a-vm-must-wait-for-a-log-analytics-workspace-to-finish-provisioning","title":"Use Case 1: A VM must wait for a Log Analytics Workspace to finish provisioning","text":"<pre><code>resource \"azurerm_log_analytics_workspace\" \"log-analytics\" {\n  name                = \"log-analytics1\"\n  location            = azurerm_resource_group.rg.location\n  resource_group_name = azurerm_resource_group.rg.name\n}\n\nresource \"azurerm_linux_virtual_machine\" \"vm\" {\n  name                = \"myvm\"\n  resource_group_name = azurerm_resource_group.rg.name\n  location            = azurerm_resource_group.rg.location\n  size                = \"Standard_B2s\"\n  admin_username      = \"azureuser\"\n\n  network_interface_ids = [\n    azurerm_network_interface.nic.id\n  ]\n\n  depends_on = [\n    azurerm_log_analytics_workspace.log-analytics\n  ]\n}\n</code></pre>"},{"location":"03-Terraform-Configuration-Language/03-lifecycle-blocks/#use-case-2-ensure-a-secret-is-created-only-after-the-access-policy-exists","title":"Use Case 2: Ensure a secret is created only after the access policy exists","text":"<pre><code>resource \"azurerm_key_vault\" \"kv\" {\n  name                = \"my-kv\"\n  location            = azurerm_resource_group.rg.location\n  resource_group_name = azurerm_resource_group.rg.name\n  sku_name            = \"standard\"\n}\n\nresource \"azurerm_key_vault_access_policy\" \"ap\" {\n  key_vault_id = azurerm_key_vault.kv.id\n  tenant_id    = data.azurerm_client_config.current.tenant_id\n  object_id    = data.azurerm_client_config.current.object_id\n\n  secret_permissions = [\"Set\", \"Get\"]\n}\n\nresource \"azurerm_key_vault_secret\" \"secret\" {\n  name         = \"db-password\"\n  value        = \"supersecret\"\n  key_vault_id = azurerm_key_vault.kv.id\n\n  depends_on = [azurerm_key_vault_access_policy.ap]\n}\n</code></pre>"},{"location":"03-Terraform-Configuration-Language/03-lifecycle-blocks/#use-case-3-a-module-that-deploys-an-aks-cluster-must-wait-for-a-private-dns-zone-and-a-key-vault","title":"Use Case 3: A module that deploys an AKS cluster must wait for a Private DNS zone and a Key Vault","text":"<pre><code>resource \"azurerm_private_dns_zone\" \"aks_dns\" {\n  name                = \"privatelink.westeurope.azmk8s.io\"\n  resource_group_name = azurerm_resource_group.rg.name\n}\n\nresource \"azurerm_key_vault\" \"kv\" {\n  name                = \"my-kv\"\n  location            = azurerm_resource_group.rg.location\n  resource_group_name = azurerm_resource_group.rg.name\n  sku_name            = \"standard\"\n}\n\nmodule \"aks\" {\n  source = \"./modules/aks\"\n\n  cluster_name = \"my-aks\"\n  location     = azurerm_resource_group.rg.location\n  rg_name      = azurerm_resource_group.rg.name\n\n  depends_on = [\n    azurerm_private_dns_zone.aks_dns,\n    azurerm_key_vault.kv\n  ]\n}\n</code></pre>"},{"location":"03-Terraform-Configuration-Language/03-lifecycle-blocks/#use-case-4-data-source-dependencies","title":"Use Case 4: Data Source Dependencies","text":"<pre><code>resource \"azurerm_subnet\" \"app\" {\n  name                 = \"app\"\n  resource_group_name  = azurerm_resource_group.rg.name\n  virtual_network_name = azurerm_virtual_network.vnet.name\n  address_prefixes     = [\"10.0.2.0/24\"]\n}\n\ndata \"azurerm_subnet\" \"app_data\" {\n  name                 = azurerm_subnet.app.name\n  virtual_network_name = azurerm_virtual_network.vnet.name\n  resource_group_name  = azurerm_resource_group.rg.name\n\n  depends_on = [azurerm_subnet.app]\n}\n</code></pre>"},{"location":"03-Terraform-Configuration-Language/03-lifecycle-blocks/#important-notes","title":"Important Notes","text":"<ol> <li><code>depends_on</code> affects order, not relationships:</li> <li>It only controls creation/destruction order</li> <li>It doesn't create a data dependency</li> <li> <p>Resources can still reference each other without <code>depends_on</code> if there's a direct reference</p> </li> <li> <p>Use sparingly:</p> </li> <li>Terraform usually infers dependencies automatically</li> <li>Only use when automatic inference isn't sufficient</li> <li> <p>Overuse can make configurations harder to understand</p> </li> <li> <p>Works with modules: <pre><code>module \"app\" {\n  source = \"./modules/app\"\n\n  depends_on = [\n    module.database,\n    module.cache\n  ]\n}\n</code></pre></p> </li> <li> <p>Works with data sources:    ```hcl resource \"azurerm_subnet\" \"app\" {   name                 = \"app\"   resource_group_name  = azurerm_resource_group.rg.name   virtual_network_name = azurerm_virtual_network.vnet.name   address_prefixes     = [\"10.0.2.0/24\"] }</p> </li> </ol> <p>data \"azurerm_subnet\" \"app_data\" {   name                 = azurerm_subnet.app.name   virtual_network_name = azurerm_virtual_network.vnet.name   resource_group_name  = azurerm_resource_group.rg.name</p> <p>depends_on = [azurerm_subnet.app] }    ```</p>"},{"location":"03-Terraform-Configuration-Language/03-lifecycle-blocks/#combining-depends_on-with-lifecycle-rules","title":"Combining <code>depends_on</code> with Lifecycle Rules","text":"<pre><code>resource \"azurerm_key_vault\" \"kv\" {\n  name                = \"my-kv\"\n  location            = azurerm_resource_group.rg.location\n  resource_group_name = azurerm_resource_group.rg.name\n\n  lifecycle {\n    prevent_destroy = true\n  }\n}\n\nresource \"azurerm_virtual_machine_extension\" \"ext\" {\n  name                 = \"config\"\n  virtual_machine_id   = azurerm_linux_virtual_machine.vm.id\n  publisher            = \"Microsoft.Azure.Extensions\"\n  type                 = \"CustomScript\"\n  type_handler_version = \"2.1\"\n\n  depends_on = [\n    azurerm_key_vault.kv\n  ]\n}\n</code></pre>"},{"location":"03-Terraform-Configuration-Language/03-lifecycle-blocks/#real-world-example-complete-dependency-chain","title":"Real-World Example: Complete Dependency Chain","text":"<pre><code># 1. Virtual Network (no dependencies)\nresource \"azurerm_virtual_network\" \"vnet\" {\n  name                = \"main-vnet\"\n  address_space       = [\"10.0.0.0/16\"]\n  location            = azurerm_resource_group.rg.location\n  resource_group_name = azurerm_resource_group.rg.name\n}\n\n# 2. Subnets (depend on Vnet)\nresource \"azurerm_subnet\" \"public\" {\n  name                 = \"public-subnet\"\n  resource_group_name  = azurerm_resource_group.rg.name\n  virtual_network_name = azurerm_virtual_network.vnet.name\n  address_prefixes     = [\"10.0.1.0/24\"]\n}\n\nresource \"azurerm_subnet\" \"private\" {\n  name                 = \"private-subnet\"\n  resource_group_name  = azurerm_resource_group.rg.name\n  virtual_network_name = azurerm_virtual_network.vnet.name\n  address_prefixes     = [\"10.0.2.0/24\"]\n}\n\n# 3. Public IP (depends on nothing)\nresource \"azurerm_public_ip\" \"nat_pip\" {\n  name                = \"nat-pip\"\n  location            = azurerm_resource_group.rg.location\n  resource_group_name = azurerm_resource_group.rg.name\n  allocation_method   = \"Static\"\n}\n\n\n# 4. NAT Gateway (depends on public subnet + PIP)\nresource \"azurerm_nat_gateway\" \"nat\" {\n  name                = \"main-nat\"\n  location            = azurerm_resource_group.rg.location\n  resource_group_name = azurerm_resource_group.rg.name\n\n  public_ip_address_ids = [\n    azurerm_public_ip.nat_pip.id\n  ]\n\n  depends_on = [\n    azurerm_public_ip.nat_pip,\n    azurerm_subnet.public\n  ]\n}\n\nresource \"azurerm_subnet_nat_gateway_association\" \"private_nat\" {\n  subnet_id      = azurerm_subnet.private.id\n  nat_gateway_id = azurerm_nat_gateway.nat.id\n\n  depends_on = [\n    azurerm_nat_gateway.nat\n  ]\n}\n\n# 5. Route Tables (depend on gateways + subnets)\nresource \"azurerm_route_table\" \"public\" {\n  name                = \"public-rt\"\n  location            = azurerm_resource_group.rg.location\n  resource_group_name = azurerm_resource_group.rg.name\n\n  route {\n    name           = \"internet\"\n    address_prefix = \"0.0.0.0/0\"\n    next_hop_type  = \"Internet\"\n  }\n\n  depends_on = [\n    azurerm_subnet.public\n  ]\n}\n\nresource \"azurerm_route_table\" \"private\" {\n  name                = \"private-rt\"\n  location            = azurerm_resource_group.rg.location\n  resource_group_name = azurerm_resource_group.rg.name\n\n  route {\n    name                   = \"nat\"\n    address_prefix         = \"0.0.0.0/0\"\n    next_hop_type          = \"VirtualAppliance\"\n    next_hop_in_ip_address = azurerm_nat_gateway.nat.private_ip_address\n  }\n\n  depends_on = [\n    azurerm_nat_gateway.nat,\n    azurerm_subnet.private\n  ]\n}\n\n# 6. VM (depends on all networking)\nresource \"azurerm_network_interface\" \"nic\" {\n  name                = \"vm-nic\"\n  location            = azurerm_resource_group.rg.location\n  resource_group_name = azurerm_resource_group.rg.name\n\n  ip_configuration {\n    name                          = \"internal\"\n    subnet_id                     = azurerm_subnet.public.id\n    private_ip_address_allocation = \"Dynamic\"\n  }\n\n  depends_on = [\n    azurerm_route_table.public,\n    azurerm_public_ip.nat_pip\n  ]\n}\n\nresource \"azurerm_linux_virtual_machine\" \"vm\" {\n  name                = \"web-vm\"\n  resource_group_name = azurerm_resource_group.rg.name\n  location            = azurerm_resource_group.rg.location\n  size                = \"Standard_B2s\"\n  admin_username      = \"azureuser\"\n  network_interface_ids = [\n    azurerm_network_interface.nic.id\n  ]\n\n  depends_on = [\n    azurerm_network_interface.nic\n  ]\n}\n</code></pre>"},{"location":"03-Terraform-Configuration-Language/03-lifecycle-blocks/#4-prevent_destroy","title":"4. <code>prevent_destroy</code>","text":""},{"location":"03-Terraform-Configuration-Language/03-lifecycle-blocks/#purpose_1","title":"Purpose","text":"<p>Prevents Terraform from destroying the resource, even when running <code>terraform destroy</code> or when the resource is removed from configuration.</p>"},{"location":"03-Terraform-Configuration-Language/03-lifecycle-blocks/#syntax","title":"Syntax","text":"<pre><code>resource \"azurerm_key_vault\" \"kv\" {\n  name                = \"my-kv\"\n  location            = azurerm_resource_group.rg.location\n  resource_group_name = azurerm_resource_group.rg.name\n\n  lifecycle {\n    prevent_destroy = true\n  }\n}\n</code></pre>"},{"location":"03-Terraform-Configuration-Language/03-lifecycle-blocks/#use-cases","title":"Use Cases","text":"<ul> <li>Critical production resources (databases, state containers)</li> <li>Resources that can't be recreated (unique names, historical data)</li> <li>Safety net for important infrastructure</li> </ul>"},{"location":"03-Terraform-Configuration-Language/03-lifecycle-blocks/#behavior","title":"Behavior","text":"<pre><code># With prevent_destroy = true\nterraform destroy\n# Error: Instance cannot be destroyed because prevent_destroy is set to true\n</code></pre>"},{"location":"03-Terraform-Configuration-Language/03-lifecycle-blocks/#overriding-prevent_destroy","title":"Overriding <code>prevent_destroy</code>","text":"<p>To destroy a protected resource, you must: 1. Remove <code>prevent_destroy = true</code> from the configuration 2. Run <code>terraform apply</code> to update the lifecycle rule 3. Then run <code>terraform destroy</code></p> <p>Or use <code>terraform destroy -target</code> (this still respects <code>prevent_destroy</code> - you'll get an error).</p> <p>Actually, the only way is to remove the lifecycle rule first.</p>"},{"location":"03-Terraform-Configuration-Language/03-lifecycle-blocks/#example-protecting-state-bucket","title":"Example: Protecting State Bucket","text":"<pre><code>resource \"azurerm_key_vault\" \"kv\" {\n  name                = \"my-kv\"\n  location            = azurerm_resource_group.rg.location\n  resource_group_name = azurerm_resource_group.rg.name\n\n  lifecycle {\n    prevent_destroy = true ## Dont ever delete this KV\n  }\n}\n</code></pre>"},{"location":"03-Terraform-Configuration-Language/03-lifecycle-blocks/#5-create_before_destroy","title":"5. <code>create_before_destroy</code>","text":""},{"location":"03-Terraform-Configuration-Language/03-lifecycle-blocks/#purpose_2","title":"Purpose","text":"<p>Creates the new resource before destroying the old one. Essential for zero-downtime updates.</p>"},{"location":"03-Terraform-Configuration-Language/03-lifecycle-blocks/#syntax_1","title":"Syntax","text":"<pre><code>resource \"azurerm_network_interface\" \"nic\" {\n  name                = \"app-nic\"\n  location            = azurerm_resource_group.rg.location\n  resource_group_name = azurerm_resource_group.rg.name\n\n  ip_configuration {\n    name                          = \"internal\"\n    subnet_id                     = azurerm_subnet.new_subnet.id\n    private_ip_address_allocation = \"Dynamic\"\n  }\n\n  lifecycle {\n    create_before_destroy = true\n  }\n\n  depends_on = [\n    azurerm_subnet.new_subnet\n  ]\n}\n</code></pre>"},{"location":"03-Terraform-Configuration-Language/03-lifecycle-blocks/#default-behavior-without-create_before_destroy","title":"Default Behavior (without <code>create_before_destroy</code>)","text":"<pre><code># Changing azurerm_network_interface name from app-nic to app-nic1\n# Default: Destroy old \u2192 Create new\n# Result: Downtime during transition\n</code></pre>"},{"location":"03-Terraform-Configuration-Language/03-lifecycle-blocks/#with-create_before_destroy-true","title":"With <code>create_before_destroy = true</code>","text":"<pre><code># Changing azurerm_network_interface name from app-nic to app-nic1\n# With rule: Create new \u2192 Destroy old\n# Result: Both exist temporarily, no downtime\n</code></pre>"},{"location":"03-Terraform-Configuration-Language/03-lifecycle-blocks/#use-cases_1","title":"Use Cases","text":"<ul> <li>Load balancer targets - Keep old instance until new one is healthy</li> <li>Database instances - Ensure new instance is ready before destroying old</li> <li>Any resource where downtime is unacceptable</li> </ul>"},{"location":"03-Terraform-Configuration-Language/03-lifecycle-blocks/#important-considerations","title":"Important Considerations","text":"<ol> <li> <p>Resource name conflicts: <pre><code>resource \"azurerm_network_interface\" \"nic\" {\n  name                = \"app-nic-${random_id.suffix.hex}\" # If name is unique, you may need to make it dynamic\n  location            = azurerm_resource_group.rg.location\n  resource_group_name = azurerm_resource_group.rg.name\n\n  ip_configuration {\n    name                          = \"internal\"\n    subnet_id                     = azurerm_subnet.new_subnet.id\n    private_ip_address_allocation = \"Dynamic\"\n  }\n\n  lifecycle {\n    create_before_destroy = true\n  }\n\n  depends_on = [\n    azurerm_subnet.new_subnet\n  ]\n}\n</code></pre></p> </li> <li> <p>State file size:</p> </li> <li>Both resources exist in state temporarily</li> <li> <p>Can cause issues if resource names are fixed</p> </li> <li> <p>Cost implications:</p> </li> <li>Two resources exist briefly</li> <li>May incur double cost during transition</li> </ol>"},{"location":"03-Terraform-Configuration-Language/03-lifecycle-blocks/#example-network-interface-nic-replacement-without-downtime","title":"Example: Network Interface (NIC) replacement without downtime","text":"<pre><code>resource \"azurerm_network_interface\" \"nic\" {\n  name                = \"app-nic\"\n  location            = azurerm_resource_group.rg.location\n  resource_group_name = azurerm_resource_group.rg.name\n\n  ip_configuration {\n    name                          = \"internal\"\n    subnet_id                     = azurerm_subnet.app.id\n    private_ip_address_allocation = \"Dynamic\"\n  }\n\n  lifecycle {\n    create_before_destroy = true\n  }\n}\n</code></pre>"},{"location":"03-Terraform-Configuration-Language/03-lifecycle-blocks/#6-ignore_changes","title":"6. <code>ignore_changes</code>","text":""},{"location":"03-Terraform-Configuration-Language/03-lifecycle-blocks/#purpose_3","title":"Purpose","text":"<p>Tells Terraform to ignore changes to specific attributes during <code>terraform plan</code> and <code>terraform apply</code>.</p>"},{"location":"03-Terraform-Configuration-Language/03-lifecycle-blocks/#syntax_2","title":"Syntax","text":"<pre><code>resource \"azurerm_monitor_diagnostic_setting\" \"ai_foundry_diag\" {\n\n  name               = \"diag-log\"\n  target_resource_id = azapi_resource.ai_foundry[each.value.name].id\n  log_analytics_workspace_id = var.diag_log_workspace\n\n  dynamic \"enabled_log\" {\n    for_each = try(data.azurerm_monitor_diagnostic_categories.foundry_service[each.value.name].log_category_types, [])\n    content {\n      category = enabled_log.value\n    }\n  }\n\n  depends_on = [\n    azapi_resource.ai_foundry,\n  ]\n\n  lifecycle {\n    ignore_changes = [\n      # Ignore changes to enabled_log\n      enabled_log,\n    ]\n  }\n}\n</code></pre>"},{"location":"03-Terraform-Configuration-Language/03-lifecycle-blocks/#ignoring-all-changes-to-an-attribute-list","title":"Ignoring All Changes to an Attribute List","text":"<pre><code>resource \"azurerm_linux_virtual_machine\" \"web\" {\n  # ...\n\n  lifecycle {\n    ignore_changes = [\n      tags,                    # All tags ignored\n      user_data,               # All user_data ignored\n    ]\n  }\n}\n</code></pre>"},{"location":"03-Terraform-Configuration-Language/03-lifecycle-blocks/#ignoring-specific-attributes","title":"Ignoring Specific Attributes","text":"<pre><code>resource \"azurerm_service_plan\" \"fnapp\" {\n  name                = \"app-sp\"\n  resource_group_name = \"test-rg\n  location            = var.location\n  os_type             = each.value.os_type\n  sku_name            = each.value.sku_name\n\n  tags = local.tags\n\n  lifecycle {\n    ignore_changes = [\n      tags[\"Environment\"],       # Only ignore this specific tag\n    ]\n  }\n}\n</code></pre> <p>Note: Attribute-level ignoring (like <code>tags[\"Environment\"]</code>) may not work in all Terraform versions. Generally, <code>ignore_changes = [tags]</code> ignores all tags.</p>"},{"location":"03-Terraform-Configuration-Language/03-lifecycle-blocks/#use-cases_2","title":"Use Cases","text":"<ol> <li> <p>External modifications: <pre><code># Someone changes tags in Azure Portal\n# Terraform won't try to revert them\nlifecycle {\n  ignore_changes = [tags]\n}\n</code></pre></p> </li> <li> <p>Auto-scaling adjustments:    ```hcl   resource \"azurerm_linux_virtual_machine_scale_set\" \"shared_agent_scale_set\" {   name                = \"linus-scale-set\"   instances           = var.shared_agents_count #1</p> </li> </ol> <p>lifecycle {     ignore_changes = [       tags[\"__AzureDevOpsElasticPool\"],       tags[\"__AzureDevOpsElasticPoolTimeStamp\"],       instances, # number of isntances configured under AzDO settings     ]   }    }    ```</p>"},{"location":"03-Terraform-Configuration-Language/03-lifecycle-blocks/#combining-with-replace_triggered_by","title":"Combining with <code>replace_triggered_by</code>","text":"<pre><code>resource \"azurerm_linux_virtual_machine\" \"vm\" {\n  name                = \"app-vm\"\n  resource_group_name = azurerm_resource_group.rg.name\n  location            = azurerm_resource_group.rg.location\n  size                = \"Standard_B2s\"\n  admin_username      = \"azureuser\"\n\n  network_interface_ids = [\n    azurerm_network_interface.nic.id\n  ]\n\n  lifecycle {\n    create_before_destroy = true\n    replace_triggered_by  = [\n      azurerm_network_interface.nic\n    ]\n  }\n}\n</code></pre>"},{"location":"03-Terraform-Configuration-Language/03-lifecycle-blocks/#7-replace_triggered_by","title":"7. <code>replace_triggered_by</code>","text":""},{"location":"03-Terraform-Configuration-Language/03-lifecycle-blocks/#purpose_4","title":"Purpose","text":"<p>Forces resource replacement when referenced resources or their attributes change.</p>"},{"location":"03-Terraform-Configuration-Language/03-lifecycle-blocks/#syntax_3","title":"Syntax","text":"<pre><code>resource \"azurerm_linux_virtual_machine\" \"vm\" {\n  name                = \"app-vm\"\n  resource_group_name = azurerm_resource_group.rg.name\n  location            = azurerm_resource_group.rg.location\n  size                = \"Standard_B2s\"\n  admin_username      = \"azureuser\"\n\n  network_interface_ids = [\n    azurerm_network_interface.nic.id\n  ]\n\n  lifecycle {\n    create_before_destroy = true\n    replace_triggered_by  = [\n      azurerm_network_interface.nic\n    ]\n  }\n}\n</code></pre>"},{"location":"03-Terraform-Configuration-Language/03-lifecycle-blocks/#use-cases_3","title":"Use Cases","text":"<ol> <li>VM and NIC dependencies:    ```hcl resource \"azurerm_network_interface\" \"nic\" {   name                = \"web-nic\"   location            = azurerm_resource_group.rg.location   resource_group_name = azurerm_resource_group.rg.name</li> </ol> <p>ip_configuration {     name                          = \"internal\"     subnet_id                     = azurerm_subnet.web.id     private_ip_address_allocation = \"Dynamic\"   } }</p> <p>resource \"azurerm_linux_virtual_machine\" \"vm\" {   name                = \"web-vm\"   resource_group_name = azurerm_resource_group.rg.name   location            = azurerm_resource_group.rg.location   size                = \"Standard_B2s\"   admin_username      = \"azureuser\"   network_interface_ids = [     azurerm_network_interface.nic.id   ]</p> <p>lifecycle {     create_before_destroy = true     replace_triggered_by  = [       azurerm_network_interface.nic     ]   } }</p> <p>```</p> <ol> <li>Subnet or VNet changes that require NIC replacement:    ```hcl resource \"azurerm_subnet\" \"app\" {   name                 = \"app-subnet\"   resource_group_name  = azurerm_resource_group.rg.name   virtual_network_name = azurerm_virtual_network.vnet.name   address_prefixes     = [\"10.0.2.0/24\"] }</li> </ol> <p>resource \"azurerm_network_interface\" \"nic\" {   # ...   lifecycle {     replace_triggered_by = [       azurerm_subnet.app     ]   } }</p> <p>```</p> <ol> <li>Public IP changes that require dependent resources to be replaced:    ```hcl resource \"azurerm_public_ip\" \"pip\" {   name                = \"web-pip\"   location            = azurerm_resource_group.rg.location   resource_group_name = azurerm_resource_group.rg.name   allocation_method   = \"Static\" }</li> </ol> <p>resource \"azurerm_lb\" \"lb\" {   name                = \"web-lb\"   location            = azurerm_resource_group.rg.location   resource_group_name = azurerm_resource_group.rg.name</p> <p>frontend_ip_configuration {     name                 = \"public\"     public_ip_address_id = azurerm_public_ip.pip.id   }</p> <p>lifecycle {     create_before_destroy = true     replace_triggered_by  = [       azurerm_public_ip.pip     ]   } }</p> <p>```</p>"},{"location":"03-Terraform-Configuration-Language/03-lifecycle-blocks/#important-notes_1","title":"Important Notes","text":"<ul> <li>Only accepts resource addresses, not arbitrary expressions</li> <li>Must reference resources or their attributes (e.g., <code>azurerm_key_vault_key.example.id</code>)</li> <li>Triggers replacement, not just update</li> </ul>"},{"location":"03-Terraform-Configuration-Language/03-lifecycle-blocks/#8-combining-lifecycle-rules","title":"8. Combining Lifecycle Rules","text":"<p>You can use multiple lifecycle rules together:</p> <pre><code>resource \"azurerm_linux_virtual_machine\" \"critical\" {\n  name                = \"critical-vm\"\n  resource_group_name = azurerm_resource_group.rg.name\n  location            = azurerm_resource_group.rg.location\n  size                = \"Standard_B2s\"\n  admin_username      = \"azureuser\"\n\n  network_interface_ids = [\n    azurerm_network_interface.nic.id\n  ]\n\n  source_image_reference {\n    publisher = \"Canonical\"\n    offer     = \"0001-com-ubuntu-server-jammy\"\n    sku       = \"22_04-lts\"\n    version   = var.image_version   # e.g., \"latest\" or a pinned version\n  }\n\n  tags = {\n    Environment = \"prod\"\n  }\n\n  lifecycle {\n    prevent_destroy       = true\n    create_before_destroy = true\n    ignore_changes        = [tags]\n    replace_triggered_by  = [\n      var.image_version\n    ]\n  }\n}\n</code></pre> <p>Note: <code>replace_triggered_by</code> cannot accept variables directly. You'd need to reference a resource that changes when the variable changes.</p>"},{"location":"03-Terraform-Configuration-Language/03-lifecycle-blocks/#9-real-world-examples","title":"9. Real-World Examples","text":""},{"location":"03-Terraform-Configuration-Language/03-lifecycle-blocks/#example-1-production-database-azure-sql","title":"Example 1: Production Database (Azure SQL)","text":"<pre><code>resource \"azurerm_mssql_server\" \"prod\" {\n  name                         = \"prod-sql-server\"\n  resource_group_name          = azurerm_resource_group.rg.name\n  location                     = azurerm_resource_group.rg.location\n  version                      = \"12.0\"\n  administrator_login          = \"sqladmin\"\n  administrator_login_password = var.admin_password\n\n  lifecycle {\n    prevent_destroy = true\n    ignore_changes = [\n      tags,\n      identity,                     # Azure may add system-assigned identity\n    ]\n  }\n}\n\nresource \"azurerm_mssql_database\" \"production\" {\n  name           = \"prod-db\"\n  server_id      = azurerm_mssql_server.prod.id\n  sku_name       = \"S2\"\n  max_size_gb    = 250\n\n  lifecycle {\n    prevent_destroy = true\n    ignore_changes = [\n      max_size_gb,                  # Azure auto-scales storage\n      zone_redundant,               # Azure may toggle this based on region\n    ]\n  }\n}\n</code></pre>"},{"location":"03-Terraform-Configuration-Language/03-lifecycle-blocks/#example-2-load-balancer-target-azure-vm-backend-pool","title":"Example 2: Load Balancer Target (Azure VM + Backend Pool)","text":"<pre><code>resource \"azurerm_linux_virtual_machine\" \"app\" {\n  name                = \"app-vm\"\n  resource_group_name = azurerm_resource_group.rg.name\n  location            = azurerm_resource_group.rg.location\n  size                = \"Standard_B2s\"\n  admin_username      = \"azureuser\"\n  network_interface_ids = [\n    azurerm_network_interface.nic.id\n  ]\n\n  lifecycle {\n    create_before_destroy = true\n  }\n}\n\nresource \"azurerm_lb_backend_address_pool_address\" \"app\" {\n  name                    = \"app-backend\"\n  backend_address_pool_id = azurerm_lb_backend_address_pool.app.id\n  virtual_network_id       = azurerm_virtual_network.vnet.id\n  ip_address               = azurerm_network_interface.nic.private_ip_address\n\n  lifecycle {\n    create_before_destroy = true\n  }\n}\n</code></pre>"},{"location":"03-Terraform-Configuration-Language/03-lifecycle-blocks/#example-3-auto-managed-tags-azure-modifies-tags-frequently","title":"Example 3: Auto-Managed Tags (Azure modifies tags frequently)","text":"<pre><code>resource \"azurerm_linux_virtual_machine\" \"web\" {\n  name                = \"web-vm\"\n  resource_group_name = azurerm_resource_group.rg.name\n  location            = azurerm_resource_group.rg.location\n  size                = \"Standard_B2s\"\n  admin_username      = \"azureuser\"\n  network_interface_ids = [\n    azurerm_network_interface.nic.id\n  ]\n\n  tags = {\n    Name        = \"web-server\"\n    Environment = \"prod\"\n    ManagedBy   = \"terraform\"\n    CostCenter  = \"engineering\"\n  }\n\n  lifecycle {\n    ignore_changes = [\n      tags[\"CostCenter\"],           # Allow external tag management\n      tags[\"resourceUsage\"],        # Azure auto-applies this\n      identity,                     # Azure may add system identity\n    ]\n  }\n}\n</code></pre>"},{"location":"03-Terraform-Configuration-Language/03-lifecycle-blocks/#10-exam-style-practice-questions","title":"10. Exam-Style Practice Questions","text":""},{"location":"03-Terraform-Configuration-Language/03-lifecycle-blocks/#question-1","title":"Question 1","text":"<p>Which lifecycle rule prevents Terraform from destroying a resource? A) <code>create_before_destroy</code> B) <code>prevent_destroy</code> C) <code>ignore_changes</code> D) <code>replace_triggered_by</code></p> Show Answer Answer: **B** - `prevent_destroy = true` prevents resource destruction."},{"location":"03-Terraform-Configuration-Language/03-lifecycle-blocks/#question-2","title":"Question 2","text":"<p>You need to update an Virtual Machine instance with zero downtime. Which lifecycle rule should you use? A) <code>prevent_destroy = true</code> B) <code>create_before_destroy = true</code> C) <code>ignore_changes = [instance_type]</code> D) <code>replace_triggered_by = [azurerm_linux_virtual_machine.example.id]</code></p> Show Answer Answer: **B** - `create_before_destroy = true` creates the new resource before destroying the old, ensuring zero downtime."},{"location":"03-Terraform-Configuration-Language/03-lifecycle-blocks/#question-3","title":"Question 3","text":"<p>You want Terraform to ignore changes made to tags in the Azure Portal. Which rule should you use? A) <code>prevent_destroy = true</code> B) <code>create_before_destroy = true</code> C) <code>ignore_changes = [tags]</code> D) No lifecycle rule needed</p> Show Answer Answer: **C** - `ignore_changes = [tags]` tells Terraform to ignore tag modifications."},{"location":"03-Terraform-Configuration-Language/03-lifecycle-blocks/#question-4","title":"Question 4","text":"<p>What happens when you try to destroy a resource with <code>prevent_destroy = true</code>? A) Resource is destroyed after confirmation B) Terraform prompts for confirmation C) Terraform shows an error and stops D) Resource is removed from state but not destroyed</p> Show Answer Answer: **C** - Terraform will error and stop, preventing destruction of the protected resource."},{"location":"03-Terraform-Configuration-Language/03-lifecycle-blocks/#question-5","title":"Question 5","text":"<p>Which lifecycle rule forces a resource to be recreated when another resource changes? A) <code>replace_triggered_by</code> B) <code>create_before_destroy</code> C) <code>ignore_changes</code> D) <code>prevent_destroy</code></p> Show Answer Answer: **A** - `replace_triggered_by` forces replacement when referenced resources change."},{"location":"03-Terraform-Configuration-Language/03-lifecycle-blocks/#question-6","title":"Question 6","text":"<p>When should you use <code>depends_on</code>? A) Always, to ensure correct resource ordering B) Only when Terraform cannot automatically infer dependencies C) Never, Terraform always infers dependencies correctly D) Only for data sources</p> Show Answer Answer: **B** - Use `depends_on` when Terraform cannot automatically infer dependencies from resource references, such as when resources must be created in order but don't directly reference each other."},{"location":"03-Terraform-Configuration-Language/03-lifecycle-blocks/#question-7","title":"Question 7","text":"<p>What is the difference between implicit and explicit dependencies? A) Implicit dependencies use <code>depends_on</code>, explicit don't B) Explicit dependencies use <code>depends_on</code>, implicit are inferred from references C) There is no difference D) Implicit dependencies are faster</p> Show Answer Answer: **B** - Explicit dependencies use the `depends_on` meta-argument. Implicit dependencies are automatically inferred by Terraform when one resource references another."},{"location":"03-Terraform-Configuration-Language/03-lifecycle-blocks/#11-decision-guide","title":"11. Decision Guide","text":"<p>When to use <code>prevent_destroy</code>: - Critical resources (databases, state containers etc) - Resources that can't be recreated - Production safety net</p> <p>When to use <code>create_before_destroy</code>: - Zero-downtime updates required - Load balancer targets - Resources serving traffic</p> <p>When to use <code>ignore_changes</code>: - Attributes modified externally (console, scripts) - Auto-scaling managed attributes - Tags managed by other systems</p> <p>When to use <code>replace_triggered_by</code>: - Need to force recreation on dependency changes - Launch template updates should recreate instances - Configuration changes require full replacement</p> <p>When to use <code>depends_on</code>: - Resources must be created in order but don't reference each other - Side effects or external dependencies - Multiple resources must be ready before another can be created - Data sources need resources to exist first</p>"},{"location":"03-Terraform-Configuration-Language/03-lifecycle-blocks/#12-key-takeaways","title":"12. Key Takeaways","text":"<ul> <li><code>depends_on</code>: Creates explicit dependencies when Terraform cannot infer them automatically. Use when resources must be created in a specific order but don't directly reference each other.</li> <li><code>prevent_destroy</code>: Protects resources from accidental destruction. Must be removed before destroying.</li> <li><code>create_before_destroy</code>: Creates new resource before destroying old (zero-downtime updates). Watch for name conflicts.</li> <li><code>ignore_changes</code>: Tells Terraform to ignore changes to specific attributes (useful for external modifications).</li> <li><code>replace_triggered_by</code>: Forces resource replacement when referenced resources change. Only accepts resource addresses.</li> <li>All rules can be combined in a single <code>lifecycle</code> block.</li> <li><code>prevent_destroy</code> takes precedence - even <code>terraform destroy -target</code> will fail.</li> <li>Use lifecycle rules judiciously - they can mask configuration drift and cause unexpected behavior.</li> <li>Implicit vs Explicit: Terraform usually infers dependencies automatically. Use <code>depends_on</code> only when necessary.</li> </ul>"},{"location":"03-Terraform-Configuration-Language/03-lifecycle-blocks/#references","title":"References","text":"<ul> <li>Terraform Lifecycle Meta-Arguments</li> <li>Terraform depends_on Meta-Argument</li> <li>Resource Behavior</li> </ul>"},{"location":"03-Terraform-Configuration-Language/04-custom-validation-rules/","title":"14 - Custom Validation Rules","text":""},{"location":"03-Terraform-Configuration-Language/04-custom-validation-rules/#learning-objectives","title":"Learning Objectives","text":"<ul> <li>Understand how to validate variable inputs using <code>validation</code> blocks.</li> <li>Learn how to use <code>precondition</code> and <code>postcondition</code> blocks for resource validation.</li> <li>Master custom error messages and validation conditions.</li> <li>Apply validation rules to common real-world scenarios.</li> </ul>"},{"location":"03-Terraform-Configuration-Language/04-custom-validation-rules/#1-overview-of-validation-in-terraform","title":"1. Overview of Validation in Terraform","text":"<p>Terraform provides several mechanisms to validate configurations and catch errors early:</p> <ol> <li>Variable Validation - Validate input variables before they're used</li> <li>Preconditions - Validate assumptions before resource creation/modification</li> <li>Postconditions - Validate resource outputs after creation</li> </ol> <p>These validation mechanisms help catch configuration errors early and provide clear error messages.</p>"},{"location":"03-Terraform-Configuration-Language/04-custom-validation-rules/#2-variable-validation-blocks","title":"2. Variable Validation Blocks","text":""},{"location":"03-Terraform-Configuration-Language/04-custom-validation-rules/#purpose","title":"Purpose","text":"<p>Variable validation allows you to enforce rules on variable values before Terraform uses them in your configuration. This catches errors during <code>terraform plan</code> or <code>terraform apply</code>.</p>"},{"location":"03-Terraform-Configuration-Language/04-custom-validation-rules/#basic-syntax","title":"Basic Syntax","text":"<pre><code>variable \"vm_size\" {\n  description = \"Azure VM size\"\n  type        = string\n\n  validation {\n    condition     = can(regex(\"^Standard_B[0-9]+[a-z]?$\", var.vm_size))\n    error_message = \"VM size must be a B-series instance (e.g., Standard_B2s, Standard_B4ms).\"\n  }\n}\n</code></pre>"},{"location":"03-Terraform-Configuration-Language/04-custom-validation-rules/#validation-block-components","title":"Validation Block Components","text":"<ul> <li><code>condition</code>: A boolean expression that must evaluate to <code>true</code> for validation to pass</li> <li><code>error_message</code>: Custom error message shown when validation fails</li> </ul>"},{"location":"03-Terraform-Configuration-Language/04-custom-validation-rules/#common-validation-patterns","title":"Common Validation Patterns","text":""},{"location":"03-Terraform-Configuration-Language/04-custom-validation-rules/#pattern-1-string-format-validation","title":"Pattern 1: String Format Validation","text":"<pre><code>variable \"vm_size\" {\n  description = \"Azure VM size\"\n  type        = string\n\n  validation {\n    condition     = can(regex(\"^Standard_B[0-9]+[a-z]?$\", var.vm_size))\n    error_message = \"VM size must be a B-series instance (e.g., Standard_B2s, Standard_B4ms).\"\n  }\n}\n</code></pre>"},{"location":"03-Terraform-Configuration-Language/04-custom-validation-rules/#pattern-2-value-range-validation","title":"Pattern 2: Value Range Validation","text":"<pre><code>variable \"vm_count\" {\n  description = \"Number of Azure VMs to deploy\"\n  type        = number\n\n  validation {\n    condition     = var.vm_count &gt;= 1 &amp;&amp; var.vm_count &lt;= 20\n    error_message = \"VM count must be between 1 and 20.\"\n  }\n}\n</code></pre>"},{"location":"03-Terraform-Configuration-Language/04-custom-validation-rules/#pattern-3-allowed-values-validation","title":"Pattern 3: Allowed Values Validation","text":"<pre><code>variable \"environment\" {\n  description = \"Deployment environment\"\n  type        = string\n\n  validation {\n    condition     = contains([\"dev\", \"test\", \"stage\", \"prod\"], var.environment)\n    error_message = \"Environment must be one of: dev, test, stage, prod.\"\n  }\n}\n</code></pre>"},{"location":"03-Terraform-Configuration-Language/04-custom-validation-rules/#pattern-4-cidr-block-validation","title":"Pattern 4: CIDR Block Validation","text":"<pre><code>variable \"vnet_cidr\" {\n  description = \"VNet CIDR block\"\n  type        = string\n\n  validation {\n    condition     = can(cidrhost(var.vnet_cidr, 0))\n    error_message = \"VNet CIDR must be a valid IPv4 CIDR block (e.g., 10.1.0.0/16).\"\n  }\n}\n</code></pre>"},{"location":"03-Terraform-Configuration-Language/04-custom-validation-rules/#pattern-5-multiple-validation-rules","title":"Pattern 5: Multiple Validation Rules","text":"<pre><code>variable \"admin_password\" {\n  description = \"Admin password for Azure VM\"\n  type        = string\n  sensitive   = true\n\n  validation {\n    condition     = length(var.admin_password) &gt;= 12\n    error_message = \"Password must be at least 12 characters long.\"\n  }\n\n  validation {\n    condition     = can(regex(\"[A-Z]\", var.admin_password))\n    error_message = \"Password must contain at least one uppercase letter.\"\n  }\n\n  validation {\n    condition     = can(regex(\"[a-z]\", var.admin_password))\n    error_message = \"Password must contain at least one lowercase letter.\"\n  }\n\n  validation {\n    condition     = can(regex(\"[0-9]\", var.admin_password))\n    error_message = \"Password must contain at least one number.\"\n  }\n\n  validation {\n    condition     = can(regex(\"[^A-Za-z0-9]\", var.admin_password))\n    error_message = \"Password must contain at least one special character.\"\n  }\n}\n</code></pre>"},{"location":"03-Terraform-Configuration-Language/04-custom-validation-rules/#using-functions-in-validation","title":"Using Functions in Validation","text":"<pre><code>variable \"tags\" {\n  description = \"Resource tags\"\n  type        = map(string)\n\n  validation {\n    condition     = alltrue([for k, v in var.tags : length(k) &lt;= 128 &amp;&amp; length(v) &lt;= 256])\n    error_message = \"Tag keys must be &lt;= 128 characters and values &lt;= 256 characters.\"\n  }\n}\n</code></pre>"},{"location":"03-Terraform-Configuration-Language/04-custom-validation-rules/#3-precondition-blocks","title":"3. Precondition Blocks","text":""},{"location":"03-Terraform-Configuration-Language/04-custom-validation-rules/#purpose_1","title":"Purpose","text":"<p>Preconditions validate assumptions about resources or data sources before Terraform creates or modifies resources. They're placed in <code>lifecycle</code> blocks.</p>"},{"location":"03-Terraform-Configuration-Language/04-custom-validation-rules/#basic-syntax_1","title":"Basic Syntax","text":"<pre><code>resource \"azurerm_linux_virtual_machine\" \"web\" {\n  name           = var.name\n  size = var.size\n\n  lifecycle {\n    precondition {\n      condition     = var.size != \"Standard_DS3_v2\"\n      error_message = \"Standard_DS3_v2 instance type is not supported.\"\n    }\n  }\n}\n</code></pre>"},{"location":"03-Terraform-Configuration-Language/04-custom-validation-rules/#common-use-cases","title":"Common Use Cases","text":""},{"location":"03-Terraform-Configuration-Language/04-custom-validation-rules/#use-case-1-validate-data-source-results-validate-that-a-shared-image-gallery-version-exists","title":"Use Case 1: Validate Data Source Results - Validate that a Shared Image Gallery version exists","text":"<pre><code>data \"azurerm_shared_image_version\" \"latest\" {\n  name                = var.image_version\n  image_name          = var.image_name\n  gallery_name        = var.gallery_name\n  resource_group_name = var.gallery_rg\n}\n\nresource \"azurerm_linux_virtual_machine\" \"vm\" {\n  name                = \"web-vm\"\n  resource_group_name = azurerm_resource_group.rg.name\n  location            = azurerm_resource_group.rg.location\n  size                = \"Standard_B2s\"\n  admin_username      = \"azureuser\"\n\n  source_image_id = data.azurerm_shared_image_version.latest.id\n\n  lifecycle {\n    precondition {\n      condition     = data.azurerm_shared_image_version.latest.id != null\n      error_message = \"No valid image version found in Shared Image Gallery.\"\n    }\n  }\n}\n</code></pre>"},{"location":"03-Terraform-Configuration-Language/04-custom-validation-rules/#use-case-2-validate-module-inputs-validate-vnet-cidr-and-enforce-minimum-subnet-size","title":"Use Case 2: Validate Module Inputs - Validate VNet CIDR and enforce minimum subnet size","text":"<pre><code>module \"network\" {\n  source = \"./modules/network\"\n\n  vnet_cidr = var.vnet_cidr\n\n  lifecycle {\n    precondition {\n      condition     = can(cidrhost(var.vnet_cidr, 0))\n      error_message = \"VNet CIDR must be a valid IPv4 CIDR block.\"\n    }\n\n    precondition {\n      condition     = tonumber(split(\"/\", var.vnet_cidr)[1]) &lt;= 24\n      error_message = \"VNet CIDR must be /24 or larger (e.g., /16, /20).\"\n    }\n  }\n}\n</code></pre>"},{"location":"03-Terraform-Configuration-Language/04-custom-validation-rules/#use-case-3-validate-resource-dependencies-prevent-nsg-rules-from-allowing-00000-in-production","title":"Use Case 3: Validate Resource Dependencies - Prevent NSG rules from allowing 0.0.0.0/0 in production","text":"<pre><code>resource \"azurerm_network_security_group\" \"web\" {\n  name                = \"web-nsg\"\n  location            = azurerm_resource_group.rg.location\n  resource_group_name = azurerm_resource_group.rg.name\n\n  security_rule {\n    name                       = \"allow-http\"\n    priority                   = 100\n    direction                  = \"Inbound\"\n    access                     = \"Allow\"\n    protocol                   = \"Tcp\"\n    source_port_range          = \"*\"\n    destination_port_range     = \"80\"\n    source_address_prefix      = var.allowed_cidr\n    destination_address_prefix = \"*\"\n  }\n\n  lifecycle {\n    precondition {\n      condition     = var.allowed_cidr != \"0.0.0.0/0\" || var.environment == \"dev\"\n      error_message = \"Cannot allow 0.0.0.0/0 in non-development environments.\"\n    }\n  }\n}\n</code></pre>"},{"location":"03-Terraform-Configuration-Language/04-custom-validation-rules/#4-postcondition-blocks","title":"4. Postcondition Blocks","text":""},{"location":"03-Terraform-Configuration-Language/04-custom-validation-rules/#purpose_2","title":"Purpose","text":"<p>Postconditions validate resource outputs after Terraform creates or modifies resources. They're placed in <code>lifecycle</code> blocks and can reference the resource's own attributes.</p>"},{"location":"03-Terraform-Configuration-Language/04-custom-validation-rules/#basic-syntax_2","title":"Basic Syntax","text":"<pre><code>resource \"azurerm_mssql_database\" \"main\" {\n  name           = \"prod-db\"\n  server_id      = azurerm_mssql_server.sql.id\n  sku_name       = \"S2\"\n\n  lifecycle {\n    postcondition {\n      condition     = self.status == \"Online\"\n      error_message = \"Azure SQL database must be in 'Online' state after creation.\"\n    }\n  }\n}\n</code></pre>"},{"location":"03-Terraform-Configuration-Language/04-custom-validation-rules/#common-use-cases_1","title":"Common Use Cases","text":""},{"location":"03-Terraform-Configuration-Language/04-custom-validation-rules/#use-case-1-validate-resource-state-ensure-an-azure-sql-database-is-fully-provisioned","title":"Use Case 1: Validate Resource State - Ensure an Azure SQL database is fully provisioned","text":"<pre><code>resource \"azurerm_mssql_database\" \"main\" {\n  name           = \"prod-db\"\n  server_id      = azurerm_mssql_server.sql.id\n  sku_name       = \"S2\"\n\n  lifecycle {\n    postcondition {\n      condition     = self.status == \"Online\"\n      error_message = \"Azure SQL database must be in 'Online' state after creation.\"\n    }\n  }\n}\n</code></pre>"},{"location":"03-Terraform-Configuration-Language/04-custom-validation-rules/#use-case-2-validate-output-values-validate-that-a-public-ip-actually-received-an-address","title":"Use Case 2: Validate Output Values - Validate that a Public IP actually received an address","text":"<pre><code>resource \"azurerm_public_ip\" \"pip\" {\n  name                = \"web-pip\"\n  location            = azurerm_resource_group.rg.location\n  resource_group_name = azurerm_resource_group.rg.name\n  allocation_method   = \"Static\"\n\n  lifecycle {\n    postcondition {\n      condition     = self.ip_address != null &amp;&amp; self.ip_address != \"\"\n      error_message = \"Public IP must have a valid assigned IP address.\"\n    }\n  }\n}\n</code></pre>"},{"location":"03-Terraform-Configuration-Language/04-custom-validation-rules/#use-case-3-validating-key-vault-secrets-or-identity-assignments","title":"Use Case 3: Validating Key Vault secrets or identity assignments","text":"<pre><code>resource \"azurerm_key_vault_secret\" \"db_password\" {\n  name         = \"db-password\"\n  value        = var.db_password\n  key_vault_id = azurerm_key_vault.kv.id\n\n  lifecycle {\n    postcondition {\n      condition     = self.id != null\n      error_message = \"Key Vault secret creation failed.\"\n    }\n  }\n}\n</code></pre>"},{"location":"03-Terraform-Configuration-Language/04-custom-validation-rules/#5-combining-preconditions-and-postconditions","title":"5. Combining Preconditions and Postconditions","text":"<p>You can use both preconditions and postconditions in the same resource:</p> <pre><code>resource \"azurerm_linux_virtual_machine\" \"web\" {\n  name                = \"web-vm\"\n  resource_group_name = azurerm_resource_group.rg.name\n  location            = azurerm_resource_group.rg.location\n  size                = \"Standard_B2s\"\n  admin_username      = \"azureuser\"\n  network_interface_ids = [\n    azurerm_network_interface.nic.id\n  ]\n\n  lifecycle {\n    postcondition {\n      condition     = self.private_ip_address != null\n      error_message = \"VM must have a private IP assigned.\"\n    }\n\n    postcondition {\n      condition     = self.provisioning_state == \"Succeeded\"\n      error_message = \"VM provisioning did not complete successfully.\"\n    }\n  }\n}\n</code></pre>"},{"location":"03-Terraform-Configuration-Language/04-custom-validation-rules/#6-real-world-examples","title":"6. Real-World Examples","text":""},{"location":"03-Terraform-Configuration-Language/04-custom-validation-rules/#example-1-complete-variable-validation","title":"Example 1: Complete Variable Validation","text":"<pre><code>variable \"vm_config\" {\n  description = \"Azure VM configuration\"\n  type = object({\n    vm_size      = string\n    vm_count     = number\n    environment  = string\n    allowed_cidr = string\n  })\n\n  validation {\n    condition     = contains([\"dev\", \"staging\", \"prod\"], var.vm_config.environment)\n    error_message = \"Environment must be dev, staging, or prod.\"\n  }\n\n  validation {\n    condition     = var.vm_config.vm_count &gt;= 1 &amp;&amp; var.vm_config.vm_count &lt;= 20\n    error_message = \"VM count must be between 1 and 20.\"\n  }\n\n  validation {\n    condition     = can(regex(\"^Standard_[A-Za-z0-9]+$\", var.vm_config.vm_size))\n    error_message = \"VM size must follow Azure naming (e.g., Standard_B2s).\"\n  }\n\n  validation {\n    condition     = can(cidrhost(var.vm_config.allowed_cidr, 0))\n    error_message = \"Allowed CIDR must be a valid IPv4 CIDR block.\"\n  }\n}\n\nresource \"azurerm_linux_virtual_machine\" \"web\" {\n  count               = var.vm_config.vm_count\n  name                = \"web-${count.index}\"\n  resource_group_name = azurerm_resource_group.rg.name\n  location            = azurerm_resource_group.rg.location\n  size                = var.vm_config.vm_size\n  admin_username      = \"azureuser\"\n  network_interface_ids = [\n    azurerm_network_interface.nic[count.index].id\n  ]\n\n  lifecycle {\n    precondition {\n      condition     = var.vm_config.allowed_cidr != \"0.0.0.0/0\" || var.vm_config.environment == \"dev\"\n      error_message = \"Cannot allow 0.0.0.0/0 in non-dev environments.\"\n    }\n  }\n}\n</code></pre>"},{"location":"03-Terraform-Configuration-Language/04-custom-validation-rules/#example-2-data-source-validation","title":"Example 2: Data Source Validation","text":"<pre><code>data \"azurerm_virtual_network\" \"selected\" {\n  name                = var.vnet_name\n  resource_group_name = var.vnet_rg\n\n  lifecycle {\n    precondition {\n      condition     = data.azurerm_virtual_network.selected.id != null\n      error_message = \"VNet ${var.vnet_name} not found in resource group ${var.vnet_rg}.\"\n    }\n\n    precondition {\n      condition     = length(data.azurerm_virtual_network.selected.dns_servers) &gt; 0\n      error_message = \"VNet must have DNS servers configured.\"\n    }\n  }\n}\n\nresource \"azurerm_network_interface\" \"nic\" {\n  name                = \"web-nic\"\n  location            = azurerm_resource_group.rg.location\n  resource_group_name = azurerm_resource_group.rg.name\n\n  ip_configuration {\n    name                          = \"internal\"\n    subnet_id                     = data.azurerm_virtual_network.selected.subnets[0].id\n    private_ip_address_allocation = \"Dynamic\"\n  }\n\n  lifecycle {\n    postcondition {\n      condition     = self.private_ip_address != null\n      error_message = \"NIC must have a private IP assigned.\"\n    }\n  }\n}\n</code></pre>"},{"location":"03-Terraform-Configuration-Language/04-custom-validation-rules/#example-3-module-output-validation","title":"Example 3: Module Output Validation","text":"<pre><code>module \"network\" {\n  source = \"./modules/network\"\n\n  vnet_cidr = \"10.0.0.0/16\"\n\n  lifecycle {\n    precondition {\n      condition     = can(cidrhost(\"10.0.0.0/16\", 0))\n      error_message = \"Invalid CIDR block provided to network module.\"\n    }\n  }\n}\n\nresource \"azurerm_linux_virtual_machine\" \"web\" {\n  name                = \"web-vm\"\n  resource_group_name = azurerm_resource_group.rg.name\n  location            = azurerm_resource_group.rg.location\n  size                = \"Standard_B2s\"\n  admin_username      = \"azureuser\"\n\n  network_interface_ids = [\n    azurerm_network_interface.nic.id\n  ]\n\n  lifecycle {\n    precondition {\n      condition     = module.network.public_subnet_id != null\n      error_message = \"Network module must provide a public subnet ID.\"\n    }\n  }\n}\n</code></pre>"},{"location":"03-Terraform-Configuration-Language/04-custom-validation-rules/#7-best-practices","title":"7. Best Practices","text":""},{"location":"03-Terraform-Configuration-Language/04-custom-validation-rules/#dos","title":"\u2705 Do's","text":"<ol> <li> <p>Use validation for user inputs: <pre><code>variable \"port\" {\n  type = number\n  validation {\n    condition     = var.port &gt; 0 &amp;&amp; var.port &lt;= 65535\n    error_message = \"Port must be between 1 and 65535.\"\n  }\n}\n</code></pre></p> </li> <li> <p>Provide clear error messages: <pre><code>validation {\n  condition     = var.size != \"Standard_DS3_v2\"\n  error_message = \"Standard_DS3_v2 instance type is deprecated. Use a newer sku suze instead.\"\n}\n</code></pre></p> </li> <li> <p>Validate data source results:    ```hcl data \"azurerm_shared_image_version\" \"latest\" {   name                = var.image_version   image_name          = var.image_name   gallery_name        = var.gallery_name   resource_group_name = var.gallery_rg</p> </li> </ol> <p>lifecycle {     precondition {       condition     = self.id != null       error_message = \"No image version found in Shared Image Gallery.\"     }   } }</p> <p>```</p> <ol> <li>Use postconditions to verify resource state:    ```hcl resource \"azurerm_public_ip\" \"pip\" {   name                = \"web-pip\"   resource_group_name = azurerm_resource_group.rg.name   location            = azurerm_resource_group.rg.location   allocation_method   = \"Static\"</li> </ol> <p>lifecycle {     postcondition {       condition     = self.ip_address != null       error_message = \"Public IP must have an assigned IP address.\"     }   } }    ```</p>"},{"location":"03-Terraform-Configuration-Language/04-custom-validation-rules/#donts","title":"\u274c Don'ts","text":"<ol> <li> <p>Don't over-validate: <pre><code># \u274c BAD - Too restrictive\nvalidation {\n  condition     = var.instance_type == \"Standard_DS3_v2\"\n  error_message = \"Only Standard_DS3_v2 allowed.\"\n}\n\n# \u2705 GOOD - Reasonable constraint\nvalidation {\n  condition     = can(regex(\"^DS[2-3]\\\\.[a-z]+$\", var.instance_type))\n  error_message = \"Instance type must be DS2 or DS3 family.\"\n}\n</code></pre></p> </li> <li> <p>Don't use validation for business logic: <pre><code># \u274c BAD - Business logic, not validation\nvalidation {\n  condition     = var.cost &lt; 100\n  error_message = \"Cost too high.\"\n}\n</code></pre></p> </li> <li> <p>Don't ignore validation errors:</p> </li> <li>Always fix validation errors rather than working around them</li> <li>Validation exists to prevent configuration mistakes</li> </ol>"},{"location":"03-Terraform-Configuration-Language/04-custom-validation-rules/#8-exam-style-practice-questions","title":"8. Exam-Style Practice Questions","text":""},{"location":"03-Terraform-Configuration-Language/04-custom-validation-rules/#question-1","title":"Question 1","text":"<p>What is the purpose of a <code>validation</code> block in a variable definition? A) To validate resource state after creation B) To validate variable inputs before they're used C) To validate module outputs D) To validate provider configuration</p> Show Answer Answer: **B** - Variable validation blocks validate input values before Terraform uses them in the configuration, catching errors during plan or apply."},{"location":"03-Terraform-Configuration-Language/04-custom-validation-rules/#question-2","title":"Question 2","text":"<p>Where do you place <code>precondition</code> and <code>postcondition</code> blocks? A) In the variable block B) In the resource lifecycle block C) In the provider block D) In the terraform block</p> Show Answer Answer: **B** - Preconditions and postconditions are placed in the `lifecycle` block of a resource or data source."},{"location":"03-Terraform-Configuration-Language/04-custom-validation-rules/#question-3","title":"Question 3","text":"<p>What is the difference between a precondition and a postcondition? A) Preconditions run after apply, postconditions run before B) Preconditions validate before resource creation, postconditions validate after C) There is no difference D) Preconditions are for variables, postconditions are for resources</p> Show Answer Answer: **B** - Preconditions validate assumptions before Terraform creates or modifies resources. Postconditions validate resource outputs after creation or modification."},{"location":"03-Terraform-Configuration-Language/04-custom-validation-rules/#question-4","title":"Question 4","text":"<p>You want to ensure an instance type variable only accepts DS2 or DS3 sku types. Which validation should you use? A) <code>condition = var.instance_type == \"Standard_DS2_v2\" || var.instance_type == \"Standard_DS3_v2\"</code> B) <code>condition = can(regex(\"^DS[2-3]\\\\.[a-z]+$\", var.instance_type))</code> C) <code>condition = var.instance_type != \"Standard_DS1_v2\"</code> D) No validation needed</p> Show Answer Answer: **B** - Using a regex pattern with `can()` allows validation of any DS2 or DS3 sku type, not just specific ones. This is more flexible than listing individual types."},{"location":"03-Terraform-Configuration-Language/04-custom-validation-rules/#question-5","title":"Question 5","text":"<p>When do variable validation blocks execute? A) Only during <code>terraform apply</code> B) Only during <code>terraform plan</code> C) During both <code>terraform plan</code> and <code>terraform apply</code> D) Only when the variable is used in a resource</p> Show Answer Answer: **C** - Variable validation blocks execute during both `terraform plan` and `terraform apply`, catching errors early in the workflow."},{"location":"03-Terraform-Configuration-Language/04-custom-validation-rules/#9-key-takeaways","title":"9. Key Takeaways","text":"<ul> <li>Variable validation: Use <code>validation</code> blocks in variable definitions to enforce rules on input values.</li> <li>Preconditions: Validate assumptions before resource creation/modification using <code>lifecycle { precondition { ... } }</code>.</li> <li>Postconditions: Validate resource outputs after creation/modification using <code>lifecycle { postcondition { ... } }</code>.</li> <li>Error messages: Always provide clear, helpful error messages in validation blocks.</li> <li>Early detection: Validation catches configuration errors during <code>terraform plan</code>, before any infrastructure changes.</li> <li>Multiple validations: You can have multiple validation blocks in a single variable definition.</li> <li>Functions: Use Terraform functions like <code>regex()</code>, <code>can()</code>, <code>contains()</code>, and <code>alltrue()</code> in validation conditions.</li> </ul>"},{"location":"03-Terraform-Configuration-Language/04-custom-validation-rules/#references","title":"References","text":"<ul> <li>Terraform Variable Validation</li> <li>Terraform Preconditions and Postconditions</li> <li>Terraform Functions</li> </ul>"},{"location":"03-Terraform-Configuration-Language/05-ephemeral-values-write-only/","title":"15 - Ephemeral Values and Write-Only Arguments","text":""},{"location":"03-Terraform-Configuration-Language/05-ephemeral-values-write-only/#learning-objectives","title":"Learning Objectives","text":"<ul> <li>Understand what ephemeral values are and why they shouldn't be stored in state.</li> <li>Learn about write-only arguments in Terraform resources.</li> <li>Master best practices for handling sensitive data that shouldn't persist.</li> <li>Apply these concepts to real-world Azure resource scenarios.</li> </ul>"},{"location":"03-Terraform-Configuration-Language/05-ephemeral-values-write-only/#1-overview-ephemeral-values-vs-persistent-state","title":"1. Overview: Ephemeral Values vs Persistent State","text":"<p>Terraform state stores resource attributes to track infrastructure. However, some values should never be stored in state:</p> <ul> <li>Ephemeral Values: Data that changes frequently or shouldn't be tracked (e.g., temporary tokens, session data)</li> <li>Write-Only Arguments: Resource attributes that can be set but never read back (e.g., passwords, secrets)</li> </ul> <p>Understanding these concepts is critical for security and proper Terraform usage.</p>"},{"location":"03-Terraform-Configuration-Language/05-ephemeral-values-write-only/#2-what-are-ephemeral-values","title":"2. What Are Ephemeral Values?","text":""},{"location":"03-Terraform-Configuration-Language/05-ephemeral-values-write-only/#definition","title":"Definition","text":"<p>Ephemeral values are resource attributes that: - Change frequently or are temporary - Should not be stored in Terraform state - May contain sensitive information - Are not needed for resource management</p>"},{"location":"03-Terraform-Configuration-Language/05-ephemeral-values-write-only/#examples-of-ephemeral-values","title":"Examples of Ephemeral Values","text":"<ul> <li>One-time passwords (OTP codes)</li> <li>Session keys (encryption keys that rotate)</li> <li>Dynamic credentials (RBAC Creds)</li> <li>Time-sensitive data (expiration timestamps)</li> </ul>"},{"location":"03-Terraform-Configuration-Language/05-ephemeral-values-write-only/#why-ephemeral-values-matter","title":"Why Ephemeral Values Matter","text":"<ol> <li>Security: Sensitive data shouldn't persist in state files</li> <li>State file size: Reduces state file bloat</li> <li>State file security: Limits exposure of sensitive information</li> <li>Best practices: Aligns with security best practices</li> </ol>"},{"location":"03-Terraform-Configuration-Language/05-ephemeral-values-write-only/#3-write-only-arguments","title":"3. Write-Only Arguments","text":""},{"location":"03-Terraform-Configuration-Language/05-ephemeral-values-write-only/#definition_1","title":"Definition","text":"<p>Write-only arguments are resource attributes that: - You provide the value (password, secret, key, certificate). - Azure accepts it but never returns it in API responses. - Terraform does not store the value in state. - Terraform cannot detect drift if the value changes outside Terraform. - You must use data sources or Key Vault to read values later.</p>"},{"location":"03-Terraform-Configuration-Language/05-ephemeral-values-write-only/#common-write-only-arguments-in-azure","title":"Common Write-Only Arguments in Azure","text":""},{"location":"03-Terraform-Configuration-Language/05-ephemeral-values-write-only/#example-1-azure-sql-administrator-password","title":"Example 1: Azure SQL Administrator Password","text":"<pre><code>resource \"azurerm_mssql_server\" \"main\" {\n  name                         = \"prod-sql\"\n  resource_group_name          = azurerm_resource_group.rg.name\n  location                     = azurerm_resource_group.rg.location\n  version                      = \"12.0\"\n  administrator_login          = \"sqladmin\"\n  administrator_login_password = var.admin_password  # write-only\n}\n</code></pre> <p>Key Points: - Password is set during creation - Azure doesn't return the password in API responses - Terraform state doesn't contain the password - If you change the password, Terraform won't detect drift</p>"},{"location":"03-Terraform-Configuration-Language/05-ephemeral-values-write-only/#example-2-azure-ad-application-client-secret","title":"Example 2: Azure AD Application Client Secret","text":"<pre><code>resource \"azuread_application_password\" \"app_secret\" {\n  application_object_id = azuread_application.app.id\n  value                 = var.client_secret  # write-only\n}\n</code></pre> <p>Key Points: - Entra ID never returns the secret again. - Terraform state stores only metadata, not the secret value. - Password is not in state file</p>"},{"location":"03-Terraform-Configuration-Language/05-ephemeral-values-write-only/#example-3-key-vault-secret-values-when-created-via-resource","title":"Example 3: Key Vault Secret Values (when created via resource)","text":"<pre><code>resource \"azurerm_key_vault_secret\" \"api_key\" {\n  name         = \"api-key\"\n  value        = var.api_key  # write-only\n  key_vault_id = azurerm_key_vault.kv.id\n}\n</code></pre> <p>Key Points: - Terraform sends the secret to Azure. - Azure stores it encrypted. - Terraform state does not contain the plain text.</p>"},{"location":"03-Terraform-Configuration-Language/05-ephemeral-values-write-only/#to-read-the-daya-you-must-use-a-data-source","title":"To read the daya you must use a data source","text":"<pre><code>data \"azurerm_key_vault_secret\" \"api_key\" {\n  name         = \"api-key\"\n  key_vault_id = azurerm_key_vault.kv.id\n}\n</code></pre>"},{"location":"03-Terraform-Configuration-Language/05-ephemeral-values-write-only/#4-handling-ephemeral-values","title":"4. Handling Ephemeral Values","text":""},{"location":"03-Terraform-Configuration-Language/05-ephemeral-values-write-only/#strategy-1-dont-store-in-state","title":"Strategy 1: Don't Store in State","text":"<p>For values that change frequently or are temporary:</p> <pre><code># \u274c BAD - Embedding a short-lived SAS token in Terraform-managed user data\nresource \"azurerm_linux_virtual_machine\" \"vm\" {\n  name                = \"web-vm\"\n  resource_group_name = azurerm_resource_group.rg.name\n  location            = azurerm_resource_group.rg.location\n  size                = \"Standard_B2s\"\n  admin_username      = \"azureuser\"\n\n  user_data = base64encode(templatefile(\"init.sh\", {\n    # SAS token expires every hour \u2192 DO NOT store in state\n    sas_token = var.storage_sas_token\n  }))\n}\n\n\n# \u2705 GOOD - Fetch the token at runtime using Managed Identity\nresource \"azurerm_linux_virtual_machine\" \"vm\" {\n  name                = \"web-vm\"\n  resource_group_name = azurerm_resource_group.rg.name\n  location            = azurerm_resource_group.rg.location\n  size                = \"Standard_B2s\"\n  admin_username      = \"azureuser\"\n\n  identity {\n    type = \"SystemAssigned\"\n  }\n\n  user_data = base64encode(templatefile(\"init.sh\", {\n    # VM will request a token at runtime via IMDS\n    token_endpoint = \"http://169.254.169.254/metadata/identity/oauth2/token\"\n  }))\n}\n</code></pre>"},{"location":"03-Terraform-Configuration-Language/05-ephemeral-values-write-only/#strategy-2-use-external-data-sources","title":"Strategy 2: Use External Data Sources","text":"<p>For values that need to be fetched but shouldn't persist:</p> <pre><code># Fetch a short\u2011lived Entra ID access token at apply time\ndata \"external\" \"aad_token\" {\n  program = [\n    \"bash\", \"-c\",\n    \"az account get-access-token --resource https://storage.azure.com/ --output json\"\n  ]\n}\n</code></pre> <p>Note: In practice, use RBAC roles or Managed Identities instead of temporary credentials in Terraform.</p>"},{"location":"03-Terraform-Configuration-Language/05-ephemeral-values-write-only/#strategy-3-mark-as-sensitive","title":"Strategy 3: Mark as Sensitive","text":"<p>For values that must be used but shouldn't be displayed:</p> <pre><code>variable \"sql_admin_password\" {\n  type        = string\n  sensitive   = true\n}\n\nresource \"azurerm_mssql_server\" \"main\" {\n  name                         = \"prod-sql\"\n  resource_group_name          = azurerm_resource_group.rg.name\n  location                     = azurerm_resource_group.rg.location\n  version                      = \"12.0\"\n  administrator_login          = \"sqladmin\"\n  administrator_login_password = var.sql_admin_password\n}\n</code></pre>"},{"location":"03-Terraform-Configuration-Language/05-ephemeral-values-write-only/#5-best-practices-for-write-only-arguments","title":"5. Best Practices for Write-Only Arguments","text":""},{"location":"03-Terraform-Configuration-Language/05-ephemeral-values-write-only/#dos","title":"\u2705 Do's","text":"<ol> <li>Use sensitive variables:    ```hcl variable \"sql_admin_password\" {   type      = string   sensitive = true }</li> </ol> <p>```</p> <ol> <li>Using external secret managers (Azure Key Vault):</li> </ol>"},{"location":"03-Terraform-Configuration-Language/05-ephemeral-values-write-only/#store-secret-in-key-vault","title":"Store secret in Key Vault","text":""},{"location":"03-Terraform-Configuration-Language/05-ephemeral-values-write-only/#read-secret-at-apply-time","title":"Read secret at apply time","text":""},{"location":"03-Terraform-Configuration-Language/05-ephemeral-values-write-only/#use-secret-in-a-resource","title":"Use secret in a resource","text":"<p>```hcl resource \"azurerm_key_vault_secret\" \"db_password\" {   name         = \"db-password\"   value        = var.db_password   key_vault_id = azurerm_key_vault.kv.id } data \"azurerm_key_vault_secret\" \"db_password\" {   name         = \"db-password\"   key_vault_id = azurerm_key_vault.kv.id }</p> <p>resource \"azurerm_mssql_server\" \"main\" {   name                         = \"prod-sql\"   resource_group_name          = azurerm_resource_group.rg.name   location                     = azurerm_resource_group.rg.location   version                      = \"12.0\"   administrator_login          = \"sqladmin\"   administrator_login_password = data.azurerm_key_vault_secret.db_password.value }</p> <p>```</p> <ol> <li>Encrypting sensitive values (Azure AD application secrets):</li> </ol>"},{"location":"03-Terraform-Configuration-Language/05-ephemeral-values-write-only/#you-can-output-the-key-id-but-never-the-secret-value","title":"You can output the key ID, but never the secret value.","text":"<p>```hcl resource \"azuread_application_password\" \"app_secret\" {   application_object_id = azuread_application.app.id   value                 = var.client_secret  # write-only }</p> <p>```</p> <ol> <li>Document write-only arguments:    ```hcl resource \"azurerm_linux_virtual_machine\" \"vm\" {   # admin_password is write-only   # Azure never returns it, and Terraform cannot detect drift   admin_password = var.admin_password }</li> </ol> <p>```</p>"},{"location":"03-Terraform-Configuration-Language/05-ephemeral-values-write-only/#donts","title":"\u274c Don'ts","text":"<ol> <li> <p>Don't try to read write-only values: <code>hcl    # \u274c BAD - This won't work     output \"vm_password\" {       value = azurerm_linux_virtual_machine.vm.admin_password }</code></p> </li> <li> <p>Don\u2019t hardcode secrets*: <code>hcl    # \u274c BAD     variable \"admin_password\" {      default = \"Password123!\" }</code></p> </li> <li> <p>Don't commit secrets to version control: <pre><code># \u274c BAD - Never commit .tfvars with secrets\n# terraform.tfvars (committed to Git)\nsql_password = \"MySecretPassword\"\n</code></pre></p> </li> <li> <p>Don't assume write-only values persist: <pre><code># \u274c BAD - Password change won't be detected\nresource \"azurerm_mssql_server\" \"main\" {\n  password = var.db_password\n  # If password changes in Azure Portal, Terraform won't know\n}\n</code></pre></p> </li> </ol>"},{"location":"03-Terraform-Configuration-Language/05-ephemeral-values-write-only/#6-real-world-examples","title":"6. Real-World Examples","text":""},{"location":"03-Terraform-Configuration-Language/05-ephemeral-values-write-only/#example-1-azure-sql-with-key-vault","title":"Example 1: Azure SQL with Key Vault","text":"<pre><code>data \"azurerm_key_vault_secret\" \"sql_password\" {\n  name         = \"sql-admin-password\"\n  key_vault_id = azurerm_key_vault.kv.id\n}\n\nresource \"azurerm_mssql_server\" \"main\" {\n  name                         = \"prod-sql\"\n  resource_group_name          = azurerm_resource_group.rg.name\n  location                     = azurerm_resource_group.rg.location\n  version                      = \"12.0\"\n  administrator_login          = \"sqladmin\"\n  administrator_login_password = data.azurerm_key_vault_secret.sql_password.value\n}\n</code></pre>"},{"location":"03-Terraform-Configuration-Language/05-ephemeral-values-write-only/#example-2-entra-id-application-with-writeonly-secret","title":"Example 2: Entra ID application with write\u2011only secret","text":"<pre><code>resource \"azuread_application\" \"app\" {\n  display_name = \"my-app\"\n}\n\nresource \"azuread_application_password\" \"app_secret\" {\n  application_object_id = azuread_application.app.id\n  value                 = var.client_secret  # write-only\n}\n</code></pre>"},{"location":"03-Terraform-Configuration-Language/05-ephemeral-values-write-only/#example-3-vm-with-writeonly-admin-password","title":"Example 3: VM with write\u2011only admin password","text":"<pre><code>resource \"azurerm_linux_virtual_machine\" \"vm\" {\n  name                = \"prod-vm\"\n  resource_group_name = azurerm_resource_group.rg.name\n  location            = azurerm_resource_group.rg.location\n  size                = \"Standard_B2s\"\n\n  admin_username = \"azureuser\"\n  admin_password = var.admin_password  # write-only\n}\n</code></pre>"},{"location":"03-Terraform-Configuration-Language/05-ephemeral-values-write-only/#example-4-handling-password-changes","title":"Example 4: Handling Password Changes","text":"<pre><code># Problem: Azure SQL Server with ignored password drift\n# If password changes outside Terraform, Terraform won't detect it\n# Solution: Use lifecycle ignore_changes or manage via Key Vault\n\nresource \"azurerm_mssql_server\" \"main\" {\n  name                         = \"prod-sql\"\n  resource_group_name          = azurerm_resource_group.rg.name\n  location                     = azurerm_resource_group.rg.location\n  version                      = \"12.0\"\n  administrator_login          = \"sqladmin\"\n  administrator_login_password = var.sql_admin_password  # write-only\n\n  lifecycle {\n    ignore_changes = [\n      administrator_login_password\n    ]\n  }\n}\n\n\n# Another approach: Replace Azure SQL Server when password changes\nresource \"azurerm_mssql_server\" \"main\" {\n  name                         = \"prod-sql\"\n  resource_group_name          = azurerm_resource_group.rg.name\n  location                     = azurerm_resource_group.rg.location\n  version                      = \"12.0\"\n  administrator_login          = \"sqladmin\"\n  administrator_login_password = var.sql_admin_password\n\n  lifecycle {\n    replace_triggered_by = [\n      var.sql_admin_password\n    ]\n  }\n}\n</code></pre>"},{"location":"03-Terraform-Configuration-Language/05-ephemeral-values-write-only/#7-ephemeral-values-in-state-management","title":"7. Ephemeral Values in State Management","text":""},{"location":"03-Terraform-Configuration-Language/05-ephemeral-values-write-only/#understanding-state-file-contents","title":"Understanding State File Contents","text":"<pre><code># State file contains:\n{\n  \"resources\": [\n    {\n      \"type\": \"azurerm_storage_account\",\n      \"name\": \"state\",\n      \"instances\": [\n        {\n          \"attributes\": {\n            \"id\": \"/subscriptions/.../storageAccounts/tfstateprod\",\n            \"name\": \"tfstateprod\",\n            \"location\": \"uksouth\",\n            \"account_tier\": \"Standard\",\n            \"account_replication_type\": \"LRS\",\n            \"primary_blob_endpoint\": \"https://tfstateprod.blob.core.windows.net/\",\n            \"primary_access_key\": null,   # \u274c Not stored (write-only)\n            \"secondary_access_key\": null  # \u274c Not stored (write-only)\n          }\n        }\n      ]\n    }\n  ]\n}\n</code></pre>"},{"location":"03-Terraform-Configuration-Language/05-ephemeral-values-write-only/#what-gets-stored-vs-what-doesnt","title":"What Gets Stored vs What Doesn't","text":"Attribute Type Stored in State? Example Readable attributes \u2705 Yes <code>primary_blob_endpoint</code>, <code>id</code>, <code>account_tier</code> Write-only arguments \u274c No <code>password</code>, <code>primary_access_key</code> Sensitive ephemeral \u274c No Temporary tokens, session keys Computed attributes \u2705 Yes <code>id</code> (after creation)"},{"location":"03-Terraform-Configuration-Language/05-ephemeral-values-write-only/#8-exam-style-practice-questions","title":"8. Exam-Style Practice Questions","text":""},{"location":"03-Terraform-Configuration-Language/05-ephemeral-values-write-only/#question-1","title":"Question 1","text":"<p>What is a write-only argument in Terraform? A) An argument that can only be read, not written B) An argument that can be set but cannot be read back from the provider C) An argument that is optional D) An argument that must be provided</p> Show Answer Answer: **B** - Write-only arguments can be set during resource creation but cannot be read back from the provider API. Examples include passwords and secrets."},{"location":"03-Terraform-Configuration-Language/05-ephemeral-values-write-only/#question-2","title":"Question 2","text":"<p>Which of the following is an example of an ephemeral value that should not be stored in Terraform state? A) Azure Storage Account primary endpoint B) Azure Virtual Machine ID C) Entra ID OAuth2 access token D) Azure Resource Group name</p> Show Answer Answer: **C** - Access tokens are short\u2011lived, security\u2011sensitive, and change frequently. Terraform state should never contain temporary credentials or secrets. Storage endpoints, VM IDs, and resource group names are stable identifiers that Terraform should store."},{"location":"03-Terraform-Configuration-Language/05-ephemeral-values-write-only/#question-3","title":"Question 3","text":"<p>You set a password for an RDS database instance. Can you read that password back from Terraform state? A) Yes, it's stored in the state file B) No, passwords are write-only arguments C) Only if you mark it as sensitive D) Only if you use a data source</p> Show Answer Answer: **B** - RDS database passwords are write-only arguments. They can be set during creation but cannot be read back from the AWS API, and therefore are not stored in Terraform state."},{"location":"03-Terraform-Configuration-Language/05-ephemeral-values-write-only/#question-4","title":"Question 4","text":"<p>What is the best practice for handling database passwords in Terraform? A) Store them in terraform.tfvars files B) Hardcode them in the configuration C) Use Azure Keyvault or mark as sensitive variables D) Store them in the state file</p> Show Answer Answer: **C** - Best practice is to use Azure Keyvault to store passwords securely, or at minimum mark password variables as sensitive. Never hardcode or commit passwords to version control."},{"location":"03-Terraform-Configuration-Language/05-ephemeral-values-write-only/#question-5","title":"Question 5","text":"<p>If you change an SQL database password in the Azure Portal, will Terraform detect the change? A) Yes, Terraform will detect it during the next plan B) No, passwords are write-only so Terraform cannot detect changes C) Only if you use ignore_changes lifecycle rule D) Only if the password is stored in Secrets Manager</p> Show Answer Answer: **B** - Since passwords are write-only arguments, Terraform cannot read the current password value from Azure. Therefore, it cannot detect if the password was changed outside of Terraform. You would need to update the Terraform configuration and apply to change the password."},{"location":"03-Terraform-Configuration-Language/05-ephemeral-values-write-only/#9-key-takeaways","title":"9. Key Takeaways","text":"<ul> <li>Write-only arguments: Can be set but cannot be read back from the provider (e.g., passwords, secrets).</li> <li>Ephemeral values: Temporary or frequently changing data that shouldn't be stored in state (e.g., session tokens).</li> <li>Security: Write-only and ephemeral values are not stored in Terraform state, improving security.</li> <li>Best practices: </li> <li>Use Azure Keyvault for sensitive values</li> <li>Mark sensitive variables with <code>sensitive = true</code></li> <li>Never hardcode or commit secrets to version control</li> <li>Limitations: Terraform cannot detect changes to write-only arguments made outside of Terraform.</li> <li>State file: Write-only arguments appear as <code>null</code> or are omitted from state files.</li> <li>Drift detection: Changes to write-only arguments won't be detected during <code>terraform plan</code>.</li> </ul>"},{"location":"03-Terraform-Configuration-Language/05-ephemeral-values-write-only/#references","title":"References","text":"<ul> <li>Terraform Sensitive Variables</li> <li>AWS Secrets Manager</li> <li>Terraform State Security</li> </ul>"},{"location":"04-Modules-and-Dependency-Management/","title":"Modules and Dependency Management","text":""},{"location":"04-Modules-and-Dependency-Management/#what-youll-learn","title":"What you'll learn","text":"<ul> <li>Break infrastructure into reusable modules with clear interfaces.</li> <li>Pass variables between root modules and child modules.</li> <li>Manage module versioning and the module registry workflow.</li> <li>Use <code>depends_on</code>, <code>for_each</code>, and data sources to handle relationships.</li> </ul>"},{"location":"04-Modules-and-Dependency-Management/#topics","title":"Topics","text":"<ul> <li>Modules and Backends</li> </ul>"},{"location":"04-Modules-and-Dependency-Management/#cheat-sheet","title":"Cheat sheet","text":"<ul> <li>Call a module:   <pre><code>module \"network\" {\n  source = \"./modules/network\"\n  cidr_block = \"10.0.0.0/16\"\n}\n</code></pre></li> <li>Pin module versions: <code>version = \"~&gt; 2.0\"</code></li> <li>Explicit dependency: <code>depends_on = [module.network]</code></li> </ul>"},{"location":"04-Modules-and-Dependency-Management/#official-documentation","title":"Official documentation","text":"<ul> <li>Module Overview</li> <li>Module Registry</li> <li>Module Best Practices</li> </ul>"},{"location":"04-Modules-and-Dependency-Management/#hands-on-task","title":"Hands-on task","text":"<p>Create a simple module structure: <pre><code>mkdir -p modules/random_pet\ncat &lt;&lt;'HCL' &gt; modules/random_pet/main.tf\nresource \"random_pet\" \"this\" {\n  prefix = var.prefix\n}\n\noutput \"name\" {\n  value = random_pet.this.id\n}\nHCL\ncat &lt;&lt;'HCL' &gt; modules/random_pet/variables.tf\nvariable \"prefix\" {\n  type = string\n}\nHCL\n</code></pre> Then consume it in <code>main.tf</code> and run <code>terraform init &amp;&amp; terraform apply</code> to observe the generated pet name.</p>"},{"location":"04-Modules-and-Dependency-Management/01-modules-and-backends/","title":"Modules And Backends","text":""},{"location":"04-Modules-and-Dependency-Management/01-modules-and-backends/#learning-objectives","title":"Learning Objectives","text":"<ul> <li>Understand what modules are and how they make Terraform configurations reusable.</li> <li>Learn how to structure and call child modules.</li> <li>Explore the purpose and configuration of backends for storing state remotely.</li> <li>Apply best practices for using modules and managing backend configurations securely.</li> </ul>"},{"location":"04-Modules-and-Dependency-Management/01-modules-and-backends/#1-what-are-terraform-modules","title":"1. What Are Terraform Modules?","text":"<p>A module is a collection of Terraform configuration files in a folder. Modules let you group related resources together and reuse them across multiple projects or environments.</p> <p>You already use one module every time you run Terraform \u2014 the root module (your main working directory).</p>"},{"location":"04-Modules-and-Dependency-Management/01-modules-and-backends/#2-why-use-modules","title":"2. Why Use Modules?","text":"<p>Modules help you: - Reuse and standardize infrastructure patterns - Avoid repetitive code - Simplify environment management (dev, stage, prod) - Share architecture blueprints with teams</p> <p>Example use case: Instead of writing VNET, Subnets, and network security group resources multiple times, you define them once in a module and call it wherever needed.</p>"},{"location":"04-Modules-and-Dependency-Management/01-modules-and-backends/#3-module-structure","title":"3. Module Structure","text":"<p>A simple reusable module usually includes:</p> <pre><code>my-vnet-module/\n\u251c\u2500\u2500 main.tf          # defines the actual resources\n\u251c\u2500\u2500 variables.tf     # defines inputs\n\u251c\u2500\u2500 outputs.tf       # defines what values get returned\n\u2514\u2500\u2500 README.md        # explains usage\n</code></pre> <p>Then your root module (where you run Terraform) can call it like this:</p> <pre><code>module \"vnet\" {\n  source = \"./modules/my-vnet-module\"\n  cidr_block = \"10.0.0.0/16\"\n  env = \"dev\"\n}\n</code></pre>"},{"location":"04-Modules-and-Dependency-Management/01-modules-and-backends/#4-module-sources","title":"4. Module Sources","text":"<p>Terraform can load modules from multiple sources:</p> Source Type Example Use Case Local path <code>source = \"./modules/vnet\"</code> Within your project Git repo <code>source = \"git::https://github.com/TerminalsandCoffee/terraform-vpc.git\"</code> Shared code or team repo Terraform Registry <code>source = \"terraform-azurerm-avm-res-network-virtualnetwork\"</code> Public community modules Storage Account <code>source = \"azurerm://&lt;storage-account-name&gt;.blob.core.windows.net/&lt;container&gt;/&lt;path-to-zip&gt;\"</code> Private hosted modules"},{"location":"04-Modules-and-Dependency-Management/01-modules-and-backends/#5-passing-variables-into-modules","title":"5. Passing Variables into Modules","text":"<p>Modules use input variables to accept configuration values from the caller.</p> <p>Inside the module (<code>variables.tf</code>):</p> <pre><code>variable \"cidr_block\" {\n  type        = string\n  description = \"vnet CIDR range\"\n}\n\nvariable \"env\" {\n  type        = string\n  default     = \"dev\"\n}\n</code></pre> <p>In the root module (where module is called):</p> <pre><code>module \"vnet\" {\n  source      = \"./modules/vnet\"\n  cidr_block  = \"10.0.0.0/16\"\n  env         = \"prod\"\n}\n</code></pre>"},{"location":"04-Modules-and-Dependency-Management/01-modules-and-backends/#6-returning-outputs-from-modules","title":"6. Returning Outputs from Modules","text":"<p>Modules can export values (like resource IDs) to the root module.</p> <p>Inside the module (<code>outputs.tf</code>):</p> <pre><code>output \"vnet_id\" { \n  description = \"ID of the created VNet\" \n  value = azurerm_virtual_network.main.id \n  }\n</code></pre> <p>In the root module:</p> <pre><code>output \"vnet_id\" {\n  value = module.vnet.vnet_id\n}\n</code></pre> <p>Run:</p> <pre><code>terraform output vnet_id\n</code></pre>"},{"location":"04-Modules-and-Dependency-Management/01-modules-and-backends/#7-module-example-end-to-end","title":"7. Module Example (End-to-End)","text":"<p>Folder structure:</p> <pre><code>azure-terraform-associate-study/\n\u251c\u2500\u2500 main.tf\n\u2514\u2500\u2500 modules/\n    \u2514\u2500\u2500 storage_account/\n        \u251c\u2500\u2500 main.tf\n        \u251c\u2500\u2500 variables.tf\n        \u2514\u2500\u2500 outputs.tf\n</code></pre> <p>storage_account/main.tf:</p> <pre><code>resource \"azurerm_storage_account\" \"example\" {\n\n  name                      = var.sa_name\n  resource_group_name       = \"test-rg\"\n  location                  = var.location\n  account_tier              = \"Standard\"\n  account_replication_type  = each.value.replication_type\n  shared_access_key_enabled = false\n}\n</code></pre> <p>storage_account/variables.tf:</p> <pre><code>variable \"location\" {\n  type        = string\n  description = \"Location of resource\"\n}\n\nvariable \"sa_name\" {\n  type        = string\n  description = \"SA Name\"\n}\n</code></pre> <p>storage_account/outputs.tf:</p> <pre><code>output \"sa_name\" {\n  value       = azurerm_storage_account.example.name\n  description = \"Name of the Storage Account\"\n}\n</code></pre> <p>main.tf (root):</p> <pre><code>provider \"azurerm\" {\n  region = \"uksouth\"\n}\n\nmodule \"storage\" {\n  source      = \"./modules/storage_account\"\n  sa_name = \"test-sa\"\n  location = \"uksouth\"\n  env         = \"dev\"\n}\n\noutput \"sa_name\" {\n  value = module.storage.sa_name\n}\n</code></pre> <p>Run:</p> <pre><code>terraform init\nterraform apply -auto-approve\n</code></pre>"},{"location":"04-Modules-and-Dependency-Management/01-modules-and-backends/#8-what-is-a-backend","title":"8. What Is a Backend?","text":"<p>A backend defines where and how Terraform stores its state. It determines how state is loaded, stored, and locked during operations.</p> <p>Without a backend, Terraform defaults to a local backend \u2014 <code>terraform.tfstate</code> in your working directory.</p> <p>You can configure a remote backend for shared, secure state (e.g., Azure Storage Containers, Terraform Cloud).</p>"},{"location":"04-Modules-and-Dependency-Management/01-modules-and-backends/#9-backend-example-storage-accountcontainer","title":"9. Backend Example (Storage Account/Container)","text":"<pre><code>terraform {\n  backend \"azurerm\" {\n    resource_group_name   = \"my-tfstate-rg\"\n    storage_account_name  = \"mytfstateaccount\"\n    container_name        = \"tfstate\"\n    key                   = \"network/terraform.tfstate\"\n  }\n}\n</code></pre>"},{"location":"04-Modules-and-Dependency-Management/01-modules-and-backends/#key-points","title":"Key points:","text":"<ul> <li><code>container_name</code>: where the state file is stored</li> <li><code>key</code>: Path to the state file</li> </ul> <p>Run:</p> <pre><code>terraform init\n</code></pre> <p>Terraform will migrate or set up your remote state automatically.</p>"},{"location":"04-Modules-and-Dependency-Management/01-modules-and-backends/#10-backend-migration","title":"10. Backend Migration","text":"<p>If you initially used a local state, and then add a backend block, Terraform will detect the change and prompt you:</p> <p>\"Do you want to copy your existing state to the new backend?\"</p> <p>Always say yes to migrate the existing resources safely.</p> <p>You can also migrate manually with:</p> <pre><code>terraform init -migrate-state\n</code></pre>"},{"location":"04-Modules-and-Dependency-Management/01-modules-and-backends/#11-backend-types","title":"11. Backend Types","text":"<p>Common backend types and their use cases:</p> Backend Use Case Supports Locking?                         ` local Simple, single-user local files \u274c No s3 Team collaboration via AWS S3 + DynamoDB \u2705 Yes terraform cloud / enterprise Managed remote state with workspace automation \u2705 Yes azurerm Platform-specific remote storage \u2705 Yes, with Azure Blob Storage leases"},{"location":"04-Modules-and-Dependency-Management/01-modules-and-backends/#12-important-backend-facts-for-the-exam","title":"12. Important Backend Facts for the Exam","text":"<ul> <li>Backends are configured in the terraform block, not the provider block.</li> <li>Backend settings can\u2019t use variables or <code>count/for_each</code>.</li> <li><code>terraform init</code> is required after any backend change.</li> <li>Backends store only state, not configuration.</li> <li>Terraform never includes backend credentials in state files.</li> </ul>"},{"location":"04-Modules-and-Dependency-Management/01-modules-and-backends/#13-best-practices","title":"13. Best Practices","text":"Practice Reason Store reusable logic in modules Promotes DRY (Don\u2019t Repeat Yourself) Use remote state backends Enable team collaboration and persistence Version control your modules Track changes safely Keep backend config minimal Avoid embedding secrets in backend blocks Use consistent naming for module folders Improves readability Test modules independently Validate logic before reuse"},{"location":"04-Modules-and-Dependency-Management/01-modules-and-backends/#14-practice-questions","title":"14. Practice Questions","text":""},{"location":"04-Modules-and-Dependency-Management/01-modules-and-backends/#question-1","title":"Question 1","text":"<p>Which module source type would you use to load a module from a Git repository? A) <code>source = \"./modules/vnet\"</code> B) <code>source = \"git::https://github.com/user/module.git\"</code> C) <code>source = \"terraform-azurerm-modules/vnet/azurerm\"</code> D) <code>source = \"modules/vnet\"</code></p> Show Answer Answer: **B** - Git repositories use the `git::` protocol prefix. Option A is a local path, C is the Terraform Registry format, and D is invalid."},{"location":"04-Modules-and-Dependency-Management/01-modules-and-backends/#question-2","title":"Question 2","text":"<p>Can you use variables in the backend configuration block? A) Yes, any variable type B) Yes, but only string variables C) No, backend configuration is static and cannot use variables D) Only in certain backends</p> Show Answer Answer: **C** - Backend configuration blocks cannot use variables, functions, or any expressions. They must be static values. Use `-backend-config` flag or backend config files for dynamic values."},{"location":"04-Modules-and-Dependency-Management/01-modules-and-backends/#question-3","title":"Question 3","text":"<p>What is the purpose of the <code>required_providers</code> block in a module? A) Configure provider credentials B) Declare which providers and versions the module needs C) Set provider region D) Define provider aliases</p> Show Answer Answer: **B** - The `required_providers` block declares provider dependencies and version constraints. It doesn't configure credentials or settings, which are done in provider blocks."},{"location":"04-Modules-and-Dependency-Management/01-modules-and-backends/#15-key-takeaways","title":"15. Key Takeaways","text":"<ul> <li>Modules group resources and make Terraform reusable, maintainable, and modular.</li> <li>Inputs pass data into a module; outputs pass data out.</li> <li>Backends control where Terraform stores state (local vs remote).</li> <li>Remote backends (Storage Account/Blob Storage) provide collaboration, encryption, and locking.</li> <li>Backend config is static \u2014 cannot depend on variables.</li> <li>Together, modules and backends form the foundation of scalable Terraform architecture.</li> </ul>"},{"location":"04-Modules-and-Dependency-Management/01-modules-and-backends/#references","title":"References","text":"<ul> <li>Terraform Modules Documentation</li> <li>Terraform Backends Documentation</li> <li>Terraform Registry - Azure Modules</li> <li>Azure Backend Example (Blob Storage)</li> </ul>"},{"location":"05-State-Backends-and-Workspaces/","title":"State, Backends, and Workspaces","text":""},{"location":"05-State-Backends-and-Workspaces/#what-youll-learn","title":"What you'll learn","text":"<ul> <li>Explain the purpose of Terraform state and how it tracks resources.</li> <li>Configure remote backends for collaboration and reliability.</li> <li>Manage workspaces for multiple environments or deployments.</li> <li>Protect state with locking and partial configuration strategies.</li> </ul>"},{"location":"05-State-Backends-and-Workspaces/#topics","title":"Topics","text":"<ul> <li>State Management</li> <li>Advanced Terraform Features</li> <li>Interview Questions</li> </ul>"},{"location":"05-State-Backends-and-Workspaces/#cheat-sheet","title":"Cheat sheet","text":"<ul> <li>Inspect state: <code>terraform state list</code></li> <li>Move resources: <code>terraform state mv &lt;source&gt; &lt;destination&gt;</code></li> <li>Configure backend in <code>terraform { backend \"s3\" { ... } }</code></li> <li>Create workspace: <code>terraform workspace new staging</code></li> </ul>"},{"location":"05-State-Backends-and-Workspaces/#official-documentation","title":"Official documentation","text":"<ul> <li>State Concept</li> <li>Backends Overview</li> <li>Workspaces</li> </ul>"},{"location":"05-State-Backends-and-Workspaces/#hands-on-task","title":"Hands-on task","text":"<p>Set up a local backend with workspaces: <pre><code>terraform {\n  backend \"local\" {\n    path = \"./terraform.tfstate.d\"\n  }\n}\n</code></pre> Then run: <pre><code>terraform init\nterraform workspace new prod\nterraform state list\n</code></pre></p> <p></p>"},{"location":"05-State-Backends-and-Workspaces/01-state-management/","title":"State Management","text":""},{"location":"05-State-Backends-and-Workspaces/01-state-management/#learning-objectives","title":"Learning Objectives","text":"<ul> <li>Understand what Terraform state is and why it\u2019s critical.</li> <li>Learn how to configure remote state storage using Blob Storage in Azure</li> <li>Explore best practices for securing and managing state files.</li> <li>Understand state locking, migration, and drift detection.</li> </ul>"},{"location":"05-State-Backends-and-Workspaces/01-state-management/#1-what-is-terraform-state","title":"\ud83e\udde9 1. What Is Terraform State?","text":"<p>Terraform is declarative \u2014 it describes desired infrastructure. To track what\u2019s already deployed, it maintains a state file (<code>terraform.tfstate</code>).</p> <p>The state file: - Maps Terraform resources \u2192 real-world infrastructure (IDs, ARNs, IPs) - Stores attributes, dependencies, and metadata - Enables drift detection during <code>terraform plan</code></p> <p>Without it, Terraform wouldn\u2019t know what exists and could recreate resources unnecessarily.</p> <p>Analogy: Terraform state = Terraform\u2019s \u201cmemory\u201d or \u201cetcd\u201d (like Kubernetes). Lose it, and Terraform forgets your infrastructure.</p>"},{"location":"05-State-Backends-and-Workspaces/01-state-management/#you-must-be-able-to-say-this-cleanly-in-interviews","title":"You must be able to say this cleanly in interviews","text":"<p>\u201cTerraform state maps real infrastructure to the configuration by storing IDs, attributes, and metadata Terraform needs to plan updates.\u201d</p> <p>\u201cTerraform uses state to determine the difference between desired config and real infrastructure.\u201d</p>"},{"location":"05-State-Backends-and-Workspaces/01-state-management/#2-local-vs-remote-state","title":"\ud83d\uddc2\ufe0f 2. Local vs Remote State","text":""},{"location":"05-State-Backends-and-Workspaces/01-state-management/#local-state","title":"Local State","text":"<ul> <li>Default behavior (file saved in your working directory)</li> <li>Fine for single-user testing</li> <li>Risks: lost state, drift, no collaboration, secrets exposure</li> </ul>"},{"location":"05-State-Backends-and-Workspaces/01-state-management/#remote-state","title":"Remote State","text":"<ul> <li>Stored in a shared backend (Azure Blob Storage, Terraform Cloud, etc.)</li> <li>Enables team collaboration</li> <li>Secures access, adds locking, and provides durability</li> </ul>"},{"location":"05-State-Backends-and-Workspaces/01-state-management/#3-using-azure-for-remote-state","title":"\u2601\ufe0f 3. Using Azure for Remote State","text":""},{"location":"05-State-Backends-and-Workspaces/01-state-management/#step-1-creating-the-backend-resources","title":"Step 1: Creating the backend resources","text":"<pre><code>az group create -n tfstate-rg -l uksouth\n\naz storage account create -n tfstateaccount01 -g tfstate-rg -l uksouth --sku Standard_LRS\n\naz storage container create --account-name tfstateaccount01 -n tfstate\n\n## Azure automatically encrypts data at rest\n</code></pre>"},{"location":"05-State-Backends-and-Workspaces/01-state-management/#step-2-configure-the-backend","title":"Step 2: Configure the backend","text":"<p><pre><code>terraform {\n  backend \"azurerm\" {\n    resource_group_name   = \"tfstate-rg\"\n    storage_account_name  = \"tfstateaccount01\"\n    container_name        = \"tfstate\"\n    key                   = \"dev/network/terraform.tfstate\"\n  }\n}\n</code></pre> Then run:  <pre><code>terraform init\n</code></pre> Terraform will ask to migrate local state \u2192 remote backend.</p>"},{"location":"05-State-Backends-and-Workspaces/01-state-management/#4-state-locking","title":"4. State Locking","text":"<p>To prevent two people running terraform apply simultaneously:</p> <ul> <li>Azure uses Blob Leases for locking.</li> <li>When Terraform runs, it acquires a lease on the .tfstate blob.</li> <li>If locked, you\u2019ll see:</li> </ul> <pre><code>Error acquiring state lock\n</code></pre> <p>To unlock:</p> <p><pre><code>terraform force-unlock &lt;lock-id&gt;\n</code></pre> Used carefully \u2014 only when you KNOW no process is running.</p>"},{"location":"05-State-Backends-and-Workspaces/01-state-management/#5-security-best-practices","title":"5. Security &amp; Best Practices","text":"Practice Purpose Restrict  access Only admins/CI should access the blob container Enable Storage Account versioning Recover corrupted or deleted state Use <code>prevent_destroy</code> lifecycle rule Avoid accidental destruction of critical infra Never commit <code>.tfstate</code> files They may contain secrets"},{"location":"05-State-Backends-and-Workspaces/01-state-management/#6-important-commands","title":"6. Important Commands","text":"Command Description <code>terraform state list</code> Lists all resources tracked in state <code>terraform state show &lt;addr&gt;</code> Shows attributes of a specific resource <code>terraform state mv &lt;old&gt; &lt;new&gt;</code> Moves or renames resources inside state <code>terraform state rm &lt;addr&gt;</code> Removes a resource from state without deleting it <code>terraform state pull</code> Retrieves current state (useful for debugging)"},{"location":"05-State-Backends-and-Workspaces/01-state-management/#7-drift","title":"7. Drift","text":"<p>Drift happens when the cloud changes WITHOUT Terraform knowing.</p> <p>Examples of drift: - Someone added tags in Azure Portal - A resource was deleted manually - A security group rule changed - A load balancer got a new listener</p> <p>Terraform detects drift during: - terraform plan - terraform apply - terraform plan -refresh-only</p> <p>Note: \u201cTerraform will NOT fix drift automatically. It will show it in the plan.\u201d And if something is deleted manually? Terraform sees: \u201cExpected \u2192 found none \u2192 MUST be recreated.\u201d</p>"},{"location":"05-State-Backends-and-Workspaces/01-state-management/#8-real-world-example","title":"8. Real-World Example","text":""},{"location":"05-State-Backends-and-Workspaces/01-state-management/#terraform-backend-azurerm-resource_group_name-tfstate-rg-storage_account_name-tfstateaccount01-container_name-tfstate-key-labswebserverterraformtfstate-provider-azurerm-features-resource-azurerm_resource_group-main-name-example-rg-location-uksouth-resource-azurerm_virtual_network-main-name-example-vnet-address_space-1000016-location-azurerm_resource_groupmainlocation-resource_group_name-azurerm_resource_groupmainname-resource-azurerm_subnet-main-name-example-subnet-resource_group_name-azurerm_resource_groupmainname-virtual_network_name-azurerm_virtual_networkmainname-address_prefixes-1001024-resource-azurerm_network_interface-main-name-example-nic-location-azurerm_resource_groupmainlocation-resource_group_name-azurerm_resource_groupmainname-ip_configuration-name-internal-subnet_id-azurerm_subnetmainid-private_ip_address_allocation-dynamic-resource-azurerm_linux_virtual_machine-web-name-example-webserver-resource_group_name-azurerm_resource_groupmainname-location-azurerm_resource_groupmainlocation-size-standard_b1s-admin_username-azureuser-network_interface_ids-azurerm_network_interfacemainid-admin_ssh_key-username-azureuser-public_key-filesshid_rsapub-source_image_reference-publisher-canonical-offer-0001-com-ubuntu-server-focal-sku-20_04-lts-version-latest-output-web_ip-value-azurerm_linux_virtual_machinewebpublic_ip_address","title":"<pre><code>terraform {\n  backend \"azurerm\" {\n    resource_group_name   = \"tfstate-rg\"\n    storage_account_name  = \"tfstateaccount01\"\n    container_name        = \"tfstate\"\n    key                   = \"labs/webserver/terraform.tfstate\"\n  }\n}\n\n\nprovider \"azurerm\" {\n  features {}\n}\n\n\nresource \"azurerm_resource_group\" \"main\" {\n  name     = \"example-rg\"\n  location = \"uksouth\"\n}\n\nresource \"azurerm_virtual_network\" \"main\" {\n  name                = \"example-vnet\"\n  address_space       = [\"10.0.0.0/16\"]\n  location            = azurerm_resource_group.main.location\n  resource_group_name = azurerm_resource_group.main.name\n}\n\nresource \"azurerm_subnet\" \"main\" {\n  name                 = \"example-subnet\"\n  resource_group_name  = azurerm_resource_group.main.name\n  virtual_network_name = azurerm_virtual_network.main.name\n  address_prefixes     = [\"10.0.1.0/24\"]\n}\n\nresource \"azurerm_network_interface\" \"main\" {\n  name                = \"example-nic\"\n  location            = azurerm_resource_group.main.location\n  resource_group_name = azurerm_resource_group.main.name\n\n  ip_configuration {\n    name                          = \"internal\"\n    subnet_id                     = azurerm_subnet.main.id\n    private_ip_address_allocation = \"Dynamic\"\n  }\n}\n\nresource \"azurerm_linux_virtual_machine\" \"web\" {\n  name                = \"example-webserver\"\n  resource_group_name = azurerm_resource_group.main.name\n  location            = azurerm_resource_group.main.location\n  size                = \"Standard_B1s\"\n  admin_username      = \"azureuser\"\n\n  network_interface_ids = [\n    azurerm_network_interface.main.id\n  ]\n\n  admin_ssh_key {\n    username   = \"azureuser\"\n    public_key = file(\"~/.ssh/id_rsa.pub\")\n  }\n\n  source_image_reference {\n    publisher = \"Canonical\"\n    offer     = \"0001-com-ubuntu-server-focal\"\n    sku       = \"20_04-lts\"\n    version   = \"latest\"\n  }\n}\n\noutput \"web_ip\" {\n  value = azurerm_linux_virtual_machine.web.public_ip_address\n}\n</code></pre>","text":""},{"location":"05-State-Backends-and-Workspaces/01-state-management/#8-key-takeaways","title":"8. Key Takeaways","text":"<ul> <li>State = Terraform\u2019s source of truth for infrastructure.</li> <li>Storage account + container (locking built\u2011in via blob leases)</li> <li>Always secure state (encryption + RBAC).</li> <li>Never modify terraform.tfstate manually \u2014 use terraform state commands.</li> <li>Think of the state file as Terraform\u2019s equivalent of etcd in Kubernetes.</li> </ul>"},{"location":"05-State-Backends-and-Workspaces/01-state-management/#9-practice-questions","title":"9. Practice Questions","text":""},{"location":"05-State-Backends-and-Workspaces/01-state-management/#question-1","title":"Question 1","text":"<p>What is the primary purpose of Terraform state? A) Store Terraform configuration files B) Track the mapping between Terraform resources and real infrastructure C) Cache provider plugins D) Store variable values</p> Show Answer Answer: **B** - Terraform state tracks the mapping between resources defined in code and actual infrastructure in the cloud, storing IDs, and attributes needed for management."},{"location":"05-State-Backends-and-Workspaces/01-state-management/#question-2","title":"Question 2","text":"<p>What does Blob Leases provide in an Storage Account backend configuration? A) Stores the state file B) Provides state locking to prevent concurrent modifications C) Encrypts the state file D) Backs up the state file</p> Show Answer Answer: **B** - Blob Leases provides state locking, preventing multiple users or processes from modifying state simultaneously, which prevents corruption."},{"location":"05-State-Backends-and-Workspaces/01-state-management/#question-3","title":"Question 3","text":"<p>Which command should you use to move a resource from one address to another in state without recreating it? A) <code>terraform state rm</code> B) <code>terraform state mv</code> C) <code>terraform state push</code> D) <code>terraform state pull</code></p> Show Answer Answer: **B** - `terraform state mv` renames or moves resources within state without affecting the actual infrastructure, useful when refactoring code."},{"location":"05-State-Backends-and-Workspaces/01-state-management/#10-lab-challenge","title":"10. Lab Challenge","text":"<p>Create a remote state backend using: 1. Storage Account Container (my-terraform-lab-state) 2. Blob leases (terraform-lock-lab) 3. A simple Virtual Machine 4. Verify remote state exists by browsing to the container 5. Try intentionally applying twice to test locking</p>"},{"location":"05-State-Backends-and-Workspaces/02-advanced-terraform-features/","title":"Advanced Terraform Features","text":""},{"location":"05-State-Backends-and-Workspaces/02-advanced-terraform-features/#learning-objectives","title":"Learning Objectives","text":"<ul> <li>Understand Terraform workspaces for environment management.</li> <li>Learn how to use data sources to query existing infrastructure.</li> <li>Understand provisioners and when to use them.</li> <li>Practice with workspaces, data sources, and provisioners through hands-on examples.</li> </ul>"},{"location":"05-State-Backends-and-Workspaces/02-advanced-terraform-features/#1-workspaces-managing-multiple-environments","title":"1. Workspaces \u2013 Managing Multiple Environments","text":"<p>Concept: Workspaces in Terraform allow you to use the same configuration for multiple environments (like dev, stage, and prod) without duplicating code. Each workspace maintains its own state file, meaning the same config can manage separate resources across different environments.</p> <p>Commands:</p> <pre><code>terraform workspace new dev\nterraform workspace new prod\nterraform workspace list\nterraform workspace select dev\n</code></pre> <p>Example:</p> <pre><code>resource \"azurerm_storage_container\" \"demo\" {\n  name = \"demo-${terraform.workspace}-container\"\n}\n</code></pre> <p>When applied in each workspace: - <code>dev</code> \u2192 creates <code>demo-dev-container</code> - <code>prod</code> \u2192 creates <code>demo-prod-container</code></p> <p>Best Practice: Use workspaces for small environment differences. For major variations, use separate folders or repos.</p>"},{"location":"05-State-Backends-and-Workspaces/02-advanced-terraform-features/#2-data-sources-reading-existing-infrastructure","title":"2. Data Sources \u2013 Reading Existing Infrastructure","text":"<p>Concept: Data sources allow Terraform to query existing resources and reuse their attributes in your configuration. This is helpful when you want to reference infrastructure not managed by your Terraform code.</p> <p>Example:</p> <pre><code>data \"terraform_remote_state\" \"network\" {\n  backend = \"azurerm\"\n  config = {\n    resource_group_name  = \"state-rg\"\n    storage_account_name = \"statesa\"\n    container_name       = \"state-tfstate\"\n    key = \"state.tfstate\"\n\n    subscription_id = {SubID}\n  }\n}\n\nresource \"azurerm_private_endpoint\" \"pe_aisearch\" {\n  name                = \"name-pe\"\n  location            = var.location\n  resource_group_name = \"pe-rg\"\n  subnet_id           = data.terraform_remote_state.network.outputs.subnet_ids[&lt;subnetnames-as-per-output&gt;]\n}\n</code></pre> <p>Key Point: Data sources are read-only and will not alter or destroy the referenced resources.</p>"},{"location":"05-State-Backends-and-Workspaces/02-advanced-terraform-features/#3-provisioners-running-commands-on-resources","title":"3. Provisioners \u2013 Running Commands on Resources","text":"<p>Concept: Provisioners let you execute scripts or commands after a resource is created. They are often used to perform initial setup tasks such as configuration, file transfers, or installing software.</p> <p>Types of Provisioners: - local-exec: Runs on the local machine executing Terraform. - remote-exec: Runs commands on the remote resource via SSH or WinRM.</p> <p>Example: local-exec</p> <pre><code>resource \"azurerm_linux_virtual_machine\" \"example\" {\n  name                = \"example-vm\"\n  resource_group_name = azurerm_resource_group.main.name\n  location            = azurerm_resource_group.main.location\n  size                = \"Standard_B1s\"\n  admin_username      = \"azureuser\"\n\n  network_interface_ids = [\n    azurerm_network_interface.example.id\n  ]\n\n  admin_ssh_key {\n    username   = \"azureuser\"\n    public_key = file(\"~/.ssh/id_rsa.pub\")\n  }\n\n  source_image_reference {\n    publisher = \"Canonical\"\n    offer     = \"0001-com-ubuntu-server-focal\"\n    sku       = \"20_04-lts\"\n    version   = \"latest\"\n  }\n\n  provisioner \"local-exec\" {\n    command = \"echo ${self.public_ip_address} &gt;&gt; public_ips.txt\"\n  }\n}\n</code></pre> <p>Example: remote-exec</p> <pre><code>resource \"azurerm_resource_group\" \"main\" {\n  name     = \"example-rg\"\n  location = \"uksouth\"\n}\n\nresource \"azurerm_virtual_network\" \"main\" {\n  name                = \"example-vnet\"\n  address_space       = [\"10.0.0.0/16\"]\n  location            = azurerm_resource_group.main.location\n  resource_group_name = azurerm_resource_group.main.name\n}\n\nresource \"azurerm_subnet\" \"main\" {\n  name                 = \"example-subnet\"\n  resource_group_name  = azurerm_resource_group.main.name\n  virtual_network_name = azurerm_virtual_network.main.name\n  address_prefixes     = [\"10.0.1.0/24\"]\n}\n\nresource \"azurerm_network_security_group\" \"ssh\" {\n  name                = \"allow-ssh\"\n  location            = azurerm_resource_group.main.location\n  resource_group_name = azurerm_resource_group.main.name\n\n  security_rule {\n    name                       = \"SSH\"\n    priority                   = 100\n    direction                  = \"Inbound\"\n    access                     = \"Allow\"\n    protocol                   = \"Tcp\"\n    source_port_range          = \"*\"\n    destination_port_range     = \"22\"\n    source_address_prefix      = \"*\"\n    destination_address_prefix = \"*\"\n  }\n}\n\nresource \"azurerm_public_ip\" \"main\" {\n  name                = \"example-ip\"\n  location            = azurerm_resource_group.main.location\n  resource_group_name = azurerm_resource_group.main.name\n  allocation_method   = \"Dynamic\"\n}\n\nresource \"azurerm_network_interface\" \"main\" {\n  name                = \"example-nic\"\n  location            = azurerm_resource_group.main.location\n  resource_group_name = azurerm_resource_group.main.name\n\n  ip_configuration {\n    name                          = \"internal\"\n    subnet_id                     = azurerm_subnet.main.id\n    private_ip_address_allocation = \"Dynamic\"\n    public_ip_address_id          = azurerm_public_ip.main.id\n  }\n}\n\nresource \"azurerm_network_interface_security_group_association\" \"ssh\" {\n  network_interface_id      = azurerm_network_interface.main.id\n  network_security_group_id = azurerm_network_security_group.ssh.id\n}\n\nresource \"azurerm_linux_virtual_machine\" \"example\" {\n  name                = \"example-vm\"\n  resource_group_name = azurerm_resource_group.main.name\n  location            = azurerm_resource_group.main.location\n  size                = \"Standard_B1s\"\n  admin_username      = \"azureuser\"\n\n  network_interface_ids = [\n    azurerm_network_interface.main.id\n  ]\n\n  admin_ssh_key {\n    username   = \"azureuser\"\n    public_key = file(\"~/.ssh/id_rsa.pub\")\n  }\n\n  source_image_reference {\n    publisher = \"Canonical\"\n    offer     = \"0001-com-ubuntu-server-focal\"\n    sku       = \"20_04-lts\"\n    version   = \"latest\"\n  }\n\n  provisioner \"remote-exec\" {\n    inline = [\n      \"sudo apt-get update -y\",\n      \"echo 'Hello from remote-exec' &gt; /tmp/hello.txt\"\n    ]\n\n    connection {\n      type        = \"ssh\"\n      host        = azurerm_public_ip.main.ip_address\n      user        = \"azureuser\"\n      private_key = file(\"~/.ssh/id_rsa\")\n    }\n  }\n}\n</code></pre> <p>Best Practice: Use provisioners sparingly and only when other options (like user_data, cloud-init, or configuration management tools such as Ansible) are not practical.</p>"},{"location":"05-State-Backends-and-Workspaces/02-advanced-terraform-features/#4-terraform-import-when-how-to-use-it","title":"4. Terraform Import \u2013 When &amp; How to Use It","text":"<p><code>terraform import</code> is your lifeline when:</p> <ul> <li>A resource already exists in the cloud  </li> <li>You want Terraform to manage it going forward  </li> <li>Without recreating it  </li> <li>Zero downtime</li> </ul>"},{"location":"05-State-Backends-and-Workspaces/02-advanced-terraform-features/#import-rules-do-it-in-this-exact-order","title":"Import Rules (do it in this exact order)","text":"<ol> <li>Write the full resource block in your config first  </li> <li>Then run the import command:</li> </ol> <p><pre><code>terraform import storage_account.demo my-sa\n</code></pre> After import \u2013 reality check</p> <p>State now knows everything about the real resource  Your config must still match reality (attributes, tags, etc.) You\u2019ll likely need to manually clean up/fix the config afterward</p> <p>Import moves: Real world \u2192 State file Import does NOT generate or fix your config!</p>"},{"location":"05-State-Backends-and-Workspaces/02-advanced-terraform-features/#lab-exercise","title":"Lab Exercise","text":"<ol> <li>Create two workspaces: <pre><code>terraform workspace new dev\nterraform workspace new prod\n</code></pre></li> <li>Deploy an Virtual Machine using a data source to fetch the latest Ubuntu Image.  </li> <li>Add a local-exec provisioner to log the VMs public IP into a text file.  </li> <li>Switch between <code>dev</code> and <code>prod</code> workspaces to confirm each maintains its own instance and state.  </li> <li>Clean up resources when done: <pre><code>terraform destroy\n</code></pre></li> </ol>"},{"location":"05-State-Backends-and-Workspaces/02-advanced-terraform-features/#5-key-takeaways","title":"5. Key Takeaways","text":"<ul> <li>Workspaces: Isolate environments with unique state files.  </li> <li>Data sources: Read attributes of existing infrastructure.  </li> <li>Provisioners: Run setup scripts during resource creation or destruction.</li> <li>Import: Bring existing infrastructure under Terraform management (write config first, then import - it moves real world \u2192 state, but doesn't generate code). </li> </ul>"},{"location":"05-State-Backends-and-Workspaces/02-advanced-terraform-features/#6-practice-questions","title":"6. Practice Questions","text":""},{"location":"05-State-Backends-and-Workspaces/02-advanced-terraform-features/#question-1","title":"Question 1","text":"<p>What happens if you run <code>terraform apply</code> in a new workspace without selecting it first? A) It applies to the default workspace. B) It errors out. C) It creates resources in all workspaces. D) It creates a new workspace automatically</p> Show Answer   Answer: **A** - Terraform always operates in the current workspace. If you haven't selected a workspace, it uses the \"default\" workspace. You must use `terraform workspace select` to switch."},{"location":"05-State-Backends-and-Workspaces/02-advanced-terraform-features/#question-2","title":"Question 2","text":"<p>What is the main difference between a data source and a resource? A) Data sources are read-only, resources are managed B) Data sources cost money, resources are free C) Data sources only work with Azure, resources work everywhere D) There is no difference</p> Show Answer Answer: **A** - Data sources are read-only queries that fetch information about existing infrastructure without managing it. Resources are created, updated, and destroyed by Terraform."},{"location":"05-State-Backends-and-Workspaces/02-advanced-terraform-features/#question-3","title":"Question 3","text":"<p>When should you use provisioners instead of user_data or cloud-init? A) Always - provisioners are the recommended approach B) When you need to run commands after resource creation that can't be done with user_data C) Never - provisioners should never be used D) Only for Windows instances</p> Show Answer Answer: **B** - Provisioners should be a last resort. Use user_data, cloud-init, or configuration management tools (Ansible, Chef) first. Provisioners are useful for post-creation tasks that can't be handled by built-in initialization methods. While not deprecated, they are discouraged in favor of more reliable alternatives."},{"location":"06-Providers-and-Registry/","title":"Providers and the Terraform Registry","text":""},{"location":"06-Providers-and-Registry/#what-youll-learn","title":"What you'll learn","text":"<ul> <li>Configure provider blocks and authentication options.</li> <li>Discover and select providers from the Terraform Registry.</li> <li>Manage provider versions and handle upgrades safely.</li> <li>Use provider-specific resources and data sources effectively.</li> </ul>"},{"location":"06-Providers-and-Registry/#topics","title":"Topics","text":"<ul> <li>Provider Configuration</li> </ul>"},{"location":"06-Providers-and-Registry/#cheat-sheet","title":"Cheat sheet","text":"<ul> <li>Required providers block:   <pre><code>terraform {\n  required_providers {\n    azurerm = {\n      source  = \"hashicorp/azurerm\"\n      version = \"~&gt; 5.0\"\n    }\n  }\n}\n</code></pre></li> <li>Use multiple providers with aliases: <code>provider \"azurerm\" { alias = \"use2\" }</code></li> <li>Lock providers: <code>terraform providers lock -platform=linux_amd64</code></li> </ul>"},{"location":"06-Providers-and-Registry/#official-documentation","title":"Official documentation","text":"<ul> <li>Providers Overview</li> <li>Terraform Registry</li> <li>Provider Versioning</li> </ul>"},{"location":"06-Providers-and-Registry/#hands-on-task","title":"Hands-on task","text":"<p>Log the providers required by a configuration: <pre><code>terraform providers\nterraform providers mirror ./providers\nterraform init -upgrade\n</code></pre> Observe the <code>.terraform.lock.hcl</code> changes after running the upgrade.</p>"},{"location":"06-Providers-and-Registry/01-provider-configuration/","title":"Provider Configuration","text":""},{"location":"06-Providers-and-Registry/01-provider-configuration/#learning-objectives","title":"Learning Objectives","text":"<ul> <li>Understand how to configure Terraform providers.</li> <li>Learn provider version constraints and <code>required_providers</code> block.</li> <li>Master provider aliases for multiple provider instances.</li> <li>Understand provider requirements and configuration precedence.</li> </ul>"},{"location":"06-Providers-and-Registry/01-provider-configuration/#1-what-is-a-provider","title":"1. What is a Provider?","text":"<p>A provider is a plugin that Terraform uses to interact with APIs of cloud platforms, services, or other infrastructure systems.</p> <p>Examples: - <code>aws</code> - Amazon Web Services - <code>azurerm</code> - Microsoft Azure - <code>google</code> - Google Cloud Platform - <code>null</code> - Utility provider (does nothing) - <code>local</code> - Local system (files, etc.)</p>"},{"location":"06-Providers-and-Registry/01-provider-configuration/#2-basic-provider-configuration","title":"2. Basic Provider Configuration","text":""},{"location":"06-Providers-and-Registry/01-provider-configuration/#simple-provider-block","title":"Simple Provider Block","text":"<pre><code>provider \"azurerm\" {\n  features {}\n}\n</code></pre> <p>Key points: - Provider name: <code>azurerm</code> - Applies to all resources using this provider (unless overridden)</p>"},{"location":"06-Providers-and-Registry/01-provider-configuration/#common-azure-provider-arguments","title":"Common Azure Provider Arguments","text":"<pre><code>provider \"azurerm\" {\n  resource_provider_registrations = \"none\"  # Azure has many resource providers (e.g., Microsoft.Compute, Microsoft.Network). By default, the AzureRM provider may try to automatically register any missing providers when you deploy resources. Setting this to \"none\" disables that behavior.\n  alias                           = \"test\"  # This gives the provider configuration a name so you can reference it explicitly.\n  subscription_id                 = {subID} # This tells Terraform which Azure subscription to use for this provider instance.\n  features {}                               # This block is required even if empty.  It enables provider\u2011specific features and settings.\n}\n</code></pre> <p>Best Practice: Use Managed Identity/Entra ID Workload Identity Federation or Azure CLI authentication, not hardcoded in Terraform files.</p>"},{"location":"06-Providers-and-Registry/01-provider-configuration/#3-provider-version-constraints","title":"3. Provider Version Constraints","text":""},{"location":"06-Providers-and-Registry/01-provider-configuration/#why-version-constraints-matter","title":"Why Version Constraints Matter","text":"<p>Providers are constantly updated. Version constraints ensure: - Compatibility with your code - Predictable behavior - Control over when to upgrade</p>"},{"location":"06-Providers-and-Registry/01-provider-configuration/#the-required_providers-block","title":"The <code>required_providers</code> Block","text":"<p>Location: Must be in a <code>terraform</code> block (usually in <code>versions.tf</code> or <code>provider.tf</code>)</p> <pre><code>terraform {\n  required_providers {\n    azurerm = {\n      source                = \"hashicorp/azurerm\"\n      version               = \"~&gt; 4.57.0\"\n      configuration_aliases = [azurerm.test]\n    }\n  }\n  backend \"azurerm\" {\n  }\n}\n</code></pre>"},{"location":"06-Providers-and-Registry/01-provider-configuration/#version-constraint-syntax","title":"Version Constraint Syntax","text":"Constraint Meaning Example <code>\"&gt;= 1.0\"</code> Greater than or equal to 1.0 <code>1.0</code>, <code>2.5</code>, <code>3.0</code> \u2705 <code>\"&lt;= 2.0\"</code> Less than or equal to 2.0 <code>1.5</code>, <code>2.0</code> \u2705 <code>\"~&gt; 2.0\"</code> Allow &gt;= 2.0, &lt; 3.0 <code>2.0</code>, <code>2.9</code> \u2705, <code>3.0</code> \u274c <code>\"~&gt; 2.1\"</code> Allow &gt;= 2.1, &lt; 3.0 <code>2.1</code>, <code>2.9</code> \u2705, <code>2.0</code>, <code>3.0</code> \u274c <code>\"= 1.5.0\"</code> Exactly 1.5.0 <code>1.5.0</code> \u2705, <code>1.5.1</code> \u274c <code>\"&gt; 1.0, &lt; 2.0\"</code> Between 1.0 and 2.0 <code>1.5</code> \u2705, <code>2.0</code> \u274c <code>\"!= 2.0\"</code> Not equal to 2.0 <code>1.9</code>, <code>2.1</code> \u2705, <code>2.0</code> \u274c <p>Most common: <code>~&gt;</code> (pessimistic constraint operator)</p> <p>Example: <pre><code>version = \"~&gt; 5.0\"    # Allows 5.0.0, 5.1.0, 5.9.9, but NOT 6.0.0\nversion = \"~&gt; 5.25\"   # Allows 5.25.0, 5.25.1, but NOT 5.26.0 or 6.0.0\n</code></pre></p>"},{"location":"06-Providers-and-Registry/01-provider-configuration/#multiple-provider-constraints","title":"Multiple Provider Constraints","text":"<pre><code>terraform {\n  required_providers {\n    azurerm = {\n      source                = \"hashicorp/azurerm\"\n      version               = \"~&gt; 4.49.0\"\n      configuration_aliases = [azurerm.test]\n    }\n    azapi = {\n      source  = \"Azure/azapi\"\n      version = \"~&gt; 2.7.0\"\n    }\n    time = {\n      source  = \"hashicorp/time\"\n      version = \"~&gt; 0.13.1\"\n    }\n  }\n\n}\n</code></pre>"},{"location":"06-Providers-and-Registry/01-provider-configuration/#4-provider-sources","title":"4. Provider Sources","text":""},{"location":"06-Providers-and-Registry/01-provider-configuration/#provider-source-format","title":"Provider Source Format","text":"<pre><code>&lt;HOSTNAME&gt;/&lt;NAMESPACE&gt;/&lt;PROVIDER-NAME&gt;\n</code></pre> <p>Common patterns: - <code>hashicorp/azurerm</code> - Official HashiCorp Azure provider - <code>custom-org/custom-provider</code> - Custom provider</p>"},{"location":"06-Providers-and-Registry/01-provider-configuration/#default-registry-providers","title":"Default Registry Providers","text":"<p>For providers in the Terraform Registry, you can omit the full source:</p> <pre><code>required_providers {\n  azurerm = {\n    version = \"~&gt; 5.0\"\n    # source defaults to registry.terraform.io/hashicorp/azurerm\n  }\n}\n</code></pre>"},{"location":"06-Providers-and-Registry/01-provider-configuration/#explicit-source-full-format","title":"Explicit Source (Full Format)","text":"<pre><code>required_providers {\n  azurerm = {\n    source  = \"hashicorp/azurerm\"\n    version = \"~&gt; 4.49.0\"\n  }\n}\n</code></pre>"},{"location":"06-Providers-and-Registry/01-provider-configuration/#third-party-providers","title":"Third-Party Providers","text":"<pre><code>required_providers {\n  datadog = {\n    source  = \"DataDog/datadog\"\n    version = \"~&gt; 3.0\"\n  }\n}\n</code></pre>"},{"location":"06-Providers-and-Registry/01-provider-configuration/#5-provider-aliases","title":"5. Provider Aliases","text":""},{"location":"06-Providers-and-Registry/01-provider-configuration/#why-use-aliases","title":"Why Use Aliases?","text":"<p>Use aliases when you need: - Multiple instances of the same provider (different regions, accounts, etc.) - Different configurations for the same provider</p>"},{"location":"06-Providers-and-Registry/01-provider-configuration/#basic-alias-example","title":"Basic Alias Example","text":"<pre><code># Default Azure provider (e.g., test subscription)\nprovider \"azurerm\" {\n  features {}\n  subscription_id = var.test_subscription_id\n}\n\n# Aliased provider for a second subscription (e.g., ukwest)\nprovider \"azurerm\" {\n  alias           = \"secondary\"\n  features        = {}\n  subscription_id = var.secondary_subscription_id\n}\n\n\n# Use default provider\nresource \"azurerm_resource_group\" \"core_rg\" {\n  name     = \"rg-core\"\n  location = \"uksouth\"\n  # Uses default provider (core subscription)\n}\n\n\n# Use aliased provider\nresource \"azurerm_resource_group\" \"secondary_rg\" {\n  provider = azurerm.secondary\n\n  name     = \"rg-secondary\"\n  location = \"ukwest\"\n  # Uses the aliased provider (secondary subscription)\n}\n</code></pre>"},{"location":"06-Providers-and-Registry/01-provider-configuration/#multiple-provider-instances","title":"Multiple Provider Instances","text":"<pre><code># Main account\n# Default Azure provider (main subscription)\nprovider \"azurerm\" {\n  features {}\n  subscription_id = var.main_subscription_id\n  tenant_id       = var.tenant_id\n}\n\n# Different Azure subscription\nprovider \"azurerm\" {\n  alias           = \"dev_sub\"\n  features        = {}\n  subscription_id = var.dev_subscription_id\n  tenant_id       = var.tenant_id\n}\n\n# Same subscription, different region\nprovider \"azurerm\" {\n  alias           = \"eu_region\"\n  features        = {}\n  subscription_id = var.main_subscription_id\n  tenant_id       = var.tenant_id\n}\n\n\nresource \"azurerm_resource_group\" \"main\" {\n  name     = \"rg-main\"\n  location = \"uksouth\"\n  # Uses default provider (main subscription)\n}\n\n\nresource \"azurerm_resource_group\" \"dev\" {\n  provider = azurerm.dev_sub\n\n  name     = \"rg-dev\"\n  location = \"uksouth\"\n  # Uses dev subscription\n}\n\n\nresource \"azurerm_resource_group\" \"europe\" {\n  provider = azurerm.eu_region\n\n  name     = \"rg-europe\"\n  location = \"westeurope\"\n  # Uses main subscription but deploys in EU region\n}\n</code></pre>"},{"location":"06-Providers-and-Registry/01-provider-configuration/#alias-in-modules","title":"Alias in Modules","text":"<p>Root module: <pre><code># Default Azure provider\nprovider \"azurerm\" {\n  features {}\n  subscription_id = var.main_subscription_id\n}\n\n# Aliased provider for another subscription\nprovider \"azurerm\" {\n  alias           = \"dev_sub\"\n  features        = {}\n  subscription_id = var.dev_subscription_id\n}\n\n# Aliased provider for same subscription but different region (optional)\nprovider \"azurerm\" {\n  alias           = \"eu_region\"\n  features        = {}\n  subscription_id = var.main_subscription_id\n}\n</code></pre></p> <p>Child module (<code>modules/vnet/main.tf</code>): <pre><code># Declare the provider so the module can accept one from the root\nprovider \"azurerm\" {}\n\nresource \"azurerm_virtual_network\" \"main\" {\n  name                = \"vnet-main\"\n  location            = var.location\n  resource_group_name = var.resource_group_name\n  address_space       = [\"10.0.0.0/16\"]\n}\n</code></pre></p>"},{"location":"06-Providers-and-Registry/01-provider-configuration/#6-provider-configuration-precedence","title":"6. Provider Configuration Precedence","text":"<p>When the same provider is configured multiple times, Terraform uses this order (highest \u2192 lowest):</p> <ol> <li>Provider argument in resource block (<code>provider = azurerm.dev_sub</code>)</li> <li>Provider alias in module block (<code>providers = {azurerm = azurerm.dev_sub}</code>)</li> <li>Default provider configuration (non-aliased provider)</li> <li>Environment variables (e.g., <code>ARM_SUBSCRIPTION_ID</code>)</li> <li>Azure CLI authentication (<code>az login</code>)</li> </ol>"},{"location":"06-Providers-and-Registry/01-provider-configuration/#7-implicit-provider-configuration","title":"7. Implicit Provider Configuration","text":""},{"location":"06-Providers-and-Registry/01-provider-configuration/#default-behavior","title":"Default Behavior","text":"<p>If you don't specify a provider, Terraform uses the default (non-aliased) provider:</p> <pre><code>provider \"azurerm\" {\n  subscription_id = var.main_subscription_id\n  features {}\n}\n\n# This resource uses the default provider above\nresource \"azurerm_key_vault\" \"kv\" {\n  name           = \"kv-test\"\n  resource_group_name = \"kv-rg\"\n}\n</code></pre>"},{"location":"06-Providers-and-Registry/01-provider-configuration/#explicit-provider-reference","title":"Explicit Provider Reference","text":"<pre><code>provider \"azurerm\" {\n  subscription_id = var.main_subscription_id\n  features {}\n  alias = \"uksouth\"\n}\n\n# Explicitly use aliased provider\nresource \"azurerm_key_vault\" \"kv\" {\n  provider = azurerm.uksouth\n\n  name           = \"kv-test\"\n  resource_group_name = \"kv-rg\"\n}\n</code></pre>"},{"location":"06-Providers-and-Registry/01-provider-configuration/#8-provider-requirements-in-modules","title":"8. Provider Requirements in Modules","text":""},{"location":"06-Providers-and-Registry/01-provider-configuration/#passing-providers-to-modules","title":"Passing Providers to Modules","text":"<p>Parent module: <pre><code>provider \"azurerm\" {\n  subscription_id = var.main_subscription_id\n  features {}\n}\n\nprovider \"azurerm\" {\n  alias  = \"west\"\n  subscription_id = var.west_subscription_id\n}\n\nmodule \"multi_region\" {\n  source = \"./modules/vpc\"\n\n  providers = {\n    azurerm         = azurerm          # Pass default provider\n    azurerm.west    = azurerm.west     # Pass aliased provider\n  }\n}\n</code></pre></p> <p>Child module (<code>modules/vnet/main.tf</code>): <pre><code>terraform {\n  required_providers {\n    azurerm = {\n      source  = \"hashicorp/azurerm\"\n      version = \"~&gt; 4.49.0\"\n    }\n  }\n}\n\n# Configuration Requirements block (Terraform 0.13+)\nterraform {\n  required_providers {\n    azurerm = {\n      source                = \"hashicorp/azurerm\"\n      version               = \"~&gt; 5.0\"\n      configuration_aliases = [azurerm.west]  # Declare required alias\n    }\n  }\n}\n</code></pre></p>"},{"location":"06-Providers-and-Registry/01-provider-configuration/#9-provider-configuration-best-practices","title":"9. Provider Configuration Best Practices","text":""},{"location":"06-Providers-and-Registry/01-provider-configuration/#dos","title":"\u2705 Do's","text":"<ol> <li> <p>Use <code>required_providers</code> block: <pre><code>terraform {\n  required_providers {\n    azurerm = {\n      source  = \"hashicorp/azurerm\"\n      version = \"~&gt; 4.49.0\"\n    }\n  }\n}\n</code></pre></p> </li> <li> <p>Use version constraints:</p> </li> <li>`~&gt; 4.49.0 for patch/minor updates</li> <li> <p>Pin exact version in production if needed</p> </li> <li> <p>Store credentials securely:</p> </li> <li> <p>Never commit credentials to version control</p> </li> <li> <p>Use aliases for multiple configurations:</p> </li> <li>Different subscriptions</li> <li>Different authentication methods</li> </ol>"},{"location":"06-Providers-and-Registry/01-provider-configuration/#donts","title":"\u274c Don'ts","text":"<ol> <li> <p>Don't hardcode credentials: <code>hcl    # \u274c BAD    provider \"azurerm\" {   client_id     = \"5b432b33-a8c6-4c34-99a1-26916d4c65b6\"   client_secret = \"secret\"   tenant_id     = \"185562ad-39bc-4840-8e40-be6216340c52\"    }</code></p> </li> <li> <p>Don't omit version constraints:</p> </li> <li>Can cause unexpected breaking changes</li> <li> <p>Makes upgrades unpredictable</p> </li> <li> <p>Don't use <code>*</code> for version: <pre><code># \u274c BAD\nversion = \"*\"\n</code></pre></p> </li> </ol>"},{"location":"06-Providers-and-Registry/01-provider-configuration/#10-exam-style-practice-questions","title":"10. Exam-Style Practice Questions","text":""},{"location":"06-Providers-and-Registry/01-provider-configuration/#question-1","title":"Question 1","text":"<p>What does the version constraint <code>\"~&gt; 5.0\"</code> mean? A) Exactly version 5.0 B) Greater than or equal to 5.0, less than 6.0 C) Any version starting with 5 D) Latest version 5.x</p> Show Answer Answer: **B** - `~&gt;` (pessimistic constraint) allows &gt;= 5.0.0 and &lt; 6.0.0, so it accepts patch and minor updates but not major version changes."},{"location":"06-Providers-and-Registry/01-provider-configuration/#question-2","title":"Question 2","text":"<p>How do you use a provider alias in a resource? A) <code>alias = azurerm.west</code> B) <code>provider = azurerm.west</code> C) <code>use_provider = azurerm.west</code> D) <code>provider_alias = azurerm.west</code></p> Show Answer Answer: **B** - Use `provider = azurerm.west` to reference an aliased provider in a resource block."},{"location":"06-Providers-and-Registry/01-provider-configuration/#question-3","title":"Question 3","text":"<p>Where must the <code>required_providers</code> block be placed? A) In the provider block B) In a terraform block C) In variables.tf D) Anywhere in the configuration</p> Show Answer Answer: **B** - `required_providers` must be inside a `terraform` block, typically in `versions.tf` or `provider.tf`."},{"location":"06-Providers-and-Registry/01-provider-configuration/#question-4","title":"Question 4","text":"<p>What is the default provider source for <code>hashicorp/azurerm</code>? A) <code>hashicorp/azurerm</code> B) <code>registry.terraform.io/hashicorp/azurerm</code> C) <code>terraform.io/hashicorp/azurerm</code> D) No default, must specify</p> Show Answer Answer: **B** - The full source is `registry.terraform.io/hashicorp/azurerm`, but you can omit the full path for registry providers and just use `hashicorp/azurerm`."},{"location":"06-Providers-and-Registry/01-provider-configuration/#question-5","title":"Question 5","text":"<p>You need to create resources in multiple Azure subscriptions. What's the best approach? A) Multiple provider blocks with different subscription values B) Provider aliases C) Use the same provider and change subscription in each resource D) Create separate Terraform configurations</p> Show Answer Answer: **B** - Use provider aliases to define multiple provider instances (e.g., `azurerm.uksouth`, `azurerm.ukwest`) and reference them with `provider = azurerm.ukwest` in resources."},{"location":"06-Providers-and-Registry/01-provider-configuration/#11-common-patterns","title":"11. Common Patterns","text":""},{"location":"06-Providers-and-Registry/01-provider-configuration/#pattern-1-multi-region-setup","title":"Pattern 1: Multi-Region Setup","text":"<pre><code>terraform {\n  required_providers {\n    azurerm = {\n      source  = \"hashicorp/azurerm\"\n      version = \"~&gt; 5.0\"\n    }\n  }\n}\n\nprovider \"azurerm\" {\n  subscription_id = var.main_subscription_id\n  features {}\n}\n\nprovider \"azurerm\" {\n  alias  = \"west\"\n  region = var.west_subscription_id\n}\n\nresource \"azurerm_key_vault\" \"primary\" {\n  name = \"primary-kv\"\n}\n\nresource \"azurerm_key_vault\" \"backup\" {\n  provider = azurerm.west\n  bucket   = \"backup-kv\"\n}\n</code></pre>"},{"location":"06-Providers-and-Registry/01-provider-configuration/#pattern-2-version-pinning","title":"Pattern 2: Version Pinning","text":"<pre><code>terraform {\n  required_version = \"&gt;= 1.12\"\n\n  required_providers {\n    azurerm = {\n      source  = \"hashicorp/azurerm\"\n      version = \"5.25.0\"  # Exact version for stability\n    }\n  }\n}\n</code></pre>"},{"location":"06-Providers-and-Registry/01-provider-configuration/#pattern-3-flexible-version-range","title":"Pattern 3: Flexible Version Range","text":"<pre><code>terraform {\n  required_providers {\n    azurerm = {\n      source  = \"hashicorp/azurerm\"\n      version = \"&gt;= 4.0, &lt; 6.0\"  # Allow 4.x and 5.x\n    }\n  }\n}\n</code></pre>"},{"location":"06-Providers-and-Registry/01-provider-configuration/#12-key-takeaways","title":"12. Key Takeaways","text":"<ul> <li><code>required_providers</code>: Declares provider requirements in a <code>terraform</code> block.</li> <li>Version constraints: Use <code>~&gt;</code> for pessimistic constraints (allows patch/minor, not major).</li> <li>Provider aliases: Use <code>alias</code> to create multiple provider instances for different configs.</li> <li>Provider reference: Use <code>provider = azurerm.alias_name</code> in resources to use aliased providers.</li> <li>Source format: <code>registry.terraform.io/namespace/provider-name</code> (can omit registry for official providers).</li> <li>Never hardcode credentials: Use environment variables or Azure CLI configuration.</li> <li>Module providers: Pass providers to modules using <code>providers = { azurerm = azurerm.west }</code> block.</li> </ul>"},{"location":"06-Providers-and-Registry/01-provider-configuration/#references","title":"References","text":"<ul> <li>Terraform Provider Requirements</li> <li>Provider Configuration</li> <li>Provider Aliases</li> <li>Version Constraint Syntax</li> </ul>"},{"location":"07-Terraform-Cloud-and-Enterprise/","title":"Terraform Cloud and Enterprise","text":""},{"location":"07-Terraform-Cloud-and-Enterprise/#what-youll-learn","title":"What you'll learn","text":"<ul> <li>Differentiate Terraform Cloud (TFC) and Terraform Enterprise (TFE) features.</li> <li>Connect workspaces to VCS providers and manage remote runs.</li> <li>Enforce policy as code with Sentinel and run tasks.</li> <li>Collaborate using variable sets, private registries, and RBAC controls.</li> </ul>"},{"location":"07-Terraform-Cloud-and-Enterprise/#topics","title":"Topics","text":"<ul> <li>Terraform Cloud Enterprise</li> </ul>"},{"location":"07-Terraform-Cloud-and-Enterprise/#cheat-sheet","title":"Cheat sheet","text":"<ul> <li>Remote execution: set <code>terraform { cloud { organization = \"example\" workspaces { name = \"demo\" } } }</code></li> <li>Queue a run: <code>terraform apply</code> from connected VCS branch or <code>tfc</code> API.</li> <li>Policy sets: attach Sentinel policies to multiple workspaces.</li> <li>Run tasks: integrate external checks before apply.</li> </ul>"},{"location":"07-Terraform-Cloud-and-Enterprise/#official-documentation","title":"Official documentation","text":"<ul> <li>Terraform Cloud Overview</li> <li>Workspaces and VCS Integration</li> <li>Sentinel Policy as Code</li> <li>Run Tasks</li> </ul>"},{"location":"07-Terraform-Cloud-and-Enterprise/#hands-on-task","title":"Hands-on task","text":"<p>Create a cloud block and mock a CLI-driven run: <pre><code>terraform {\n  cloud {\n    organization = \"hashicorp-learn\"\n\n    workspaces {\n      name = \"study-guide\"\n    }\n  }\n}\n</code></pre> Then simulate a speculative run: <pre><code>terraform plan\n</code></pre> Review the run URL printed in the CLI output.</p>"},{"location":"07-Terraform-Cloud-and-Enterprise/01-terraform-cloud-enterprise/","title":"HCP Terraform (formerly Terraform Cloud) and Enterprise","text":""},{"location":"07-Terraform-Cloud-and-Enterprise/01-terraform-cloud-enterprise/#learning-objectives","title":"Learning Objectives","text":"<ul> <li>Understand HCP Terraform features and capabilities.</li> <li>Learn the difference between HCP Terraform workspaces and CLI workspaces.</li> <li>Understand Projects for organizing workspaces.</li> <li>Understand Policy as Code with Sentinel.</li> <li>Explore private module registry and VCS integration.</li> </ul>"},{"location":"07-Terraform-Cloud-and-Enterprise/01-terraform-cloud-enterprise/#1-overview-of-hcp-terraformenterprise","title":"1. Overview of HCP Terraform/Enterprise","text":""},{"location":"07-Terraform-Cloud-and-Enterprise/01-terraform-cloud-enterprise/#what-is-hcp-terraform","title":"What is HCP Terraform?","text":"<p>HCP Terraform (formerly Terraform Cloud) is HashiCorp's managed service for Terraform workflows: - Remote state storage - Remote execution (runs) - Workspace management - Projects for organizing workspaces - Team collaboration - Policy as Code (Sentinel) - Private module registry - VCS integration (GitHub, GitLab, etc.)</p> <p>HCP Terraform Enterprise (formerly Terraform Enterprise) is the self-hosted version with the same features, deployed in your infrastructure.</p> <p>Note: HCP Terraform is the new name for Terraform Cloud. The functionality remains the same, but the branding has been updated to align with HashiCorp Cloud Platform (HCP).</p>"},{"location":"07-Terraform-Cloud-and-Enterprise/01-terraform-cloud-enterprise/#key-differences-from-cli","title":"Key Differences from CLI","text":"Feature Terraform CLI HCP Terraform State Storage Local file or S3/GCS backend Managed remote state Execution Local machine Remote runners Workspaces Local workspaces HCP Terraform workspaces (different concept) Organization Manual Projects for grouping workspaces Collaboration Manual (S3 + locking) Built-in team features Policy Manual review Automated Sentinel policies Modules Terraform Registry Private registry + public"},{"location":"07-Terraform-Cloud-and-Enterprise/01-terraform-cloud-enterprise/#2-hcp-terraform-workspaces","title":"2. HCP Terraform Workspaces","text":""},{"location":"07-Terraform-Cloud-and-Enterprise/01-terraform-cloud-enterprise/#hcp-terraform-workspaces-vs-cli-workspaces","title":"HCP Terraform Workspaces vs CLI Workspaces","text":"<p>Important: These are different concepts!</p>"},{"location":"07-Terraform-Cloud-and-Enterprise/01-terraform-cloud-enterprise/#cli-workspaces","title":"CLI Workspaces","text":"<p><pre><code>terraform workspace new dev\nterraform workspace select dev\n</code></pre> - Multiple state files for same configuration - Used for environment separation - Local or remote backend</p>"},{"location":"07-Terraform-Cloud-and-Enterprise/01-terraform-cloud-enterprise/#hcp-terraform-workspaces","title":"HCP Terraform Workspaces","text":"<ul> <li>Separate configuration per workspace</li> <li>Independent state files</li> <li>Separate variables and settings</li> <li>Managed through UI or API</li> <li>Organized into Projects</li> </ul>"},{"location":"07-Terraform-Cloud-and-Enterprise/01-terraform-cloud-enterprise/#hcp-terraform-workspace-features","title":"HCP Terraform Workspace Features","text":"<p>1. Remote State: - Automatic state storage - Version history - State locking - No need to configure S3 backend</p> <p>2. Variables: - Workspace-specific variables - Environment variables - Terraform variables - Sensitive variable masking</p> <p>3. Run Triggers: - VCS-driven runs (on commit) - API-triggered runs - Scheduled runs</p> <p>4. Run Management: - Plan and apply in UI - Run history - Cost estimation - Notifications</p>"},{"location":"07-Terraform-Cloud-and-Enterprise/01-terraform-cloud-enterprise/#workspace-configuration-example","title":"Workspace Configuration Example","text":"<p>HCP Terraform UI: 1. Create workspace 2. Connect VCS (GitHub/GitLab) 3. Set workspace variables 4. Configure run triggers 5. Assign to a Project (optional)</p> <p>Or via API: <pre><code>terraform {\n  cloud {\n    organization = \"my-org\"\n\n    workspaces {\n      name = \"production\"\n    }\n  }\n}\n</code></pre></p> <p>Note: In HCP Terraform workspaces, you don't define backend blocks - HCP Terraform handles state automatically.</p>"},{"location":"07-Terraform-Cloud-and-Enterprise/01-terraform-cloud-enterprise/#3-projects","title":"3. Projects","text":""},{"location":"07-Terraform-Cloud-and-Enterprise/01-terraform-cloud-enterprise/#what-are-projects","title":"What are Projects?","text":"<p>Projects are an organizational feature in HCP Terraform that allow you to group and manage related workspaces together. Projects provide:</p> <ul> <li>Organization: Group workspaces by team, application, or environment</li> <li>Access Control: Apply team permissions at the project level</li> <li>Policy Sets: Assign Sentinel policies to projects</li> <li>Cost Management: Track costs across project workspaces</li> <li>Visual Organization: Better workspace management in the UI</li> </ul>"},{"location":"07-Terraform-Cloud-and-Enterprise/01-terraform-cloud-enterprise/#project-structure","title":"Project Structure","text":"<pre><code>Organization: my-company\n\u251c\u2500\u2500 Project: Production\n\u2502   \u251c\u2500\u2500 Workspace: prod-web\n\u2502   \u251c\u2500\u2500 Workspace: prod-database\n\u2502   \u2514\u2500\u2500 Workspace: prod-cache\n\u251c\u2500\u2500 Project: Development\n\u2502   \u251c\u2500\u2500 Workspace: dev-web\n\u2502   \u2514\u2500\u2500 Workspace: dev-database\n\u2514\u2500\u2500 Project: Shared Services\n    \u251c\u2500\u2500 Workspace: networking\n    \u2514\u2500\u2500 Workspace: security\n</code></pre>"},{"location":"07-Terraform-Cloud-and-Enterprise/01-terraform-cloud-enterprise/#creating-projects","title":"Creating Projects","text":"<p>Via UI: 1. Navigate to Projects in HCP Terraform 2. Click \"Create Project\" 3. Name the project (e.g., \"Production\", \"Development\") 4. Add description (optional) 5. Assign workspaces to the project</p> <p>Via API: <pre><code>curl \\\n  --header \"Authorization: Bearer $TOKEN\" \\\n  --header \"Content-Type: application/vnd.api+json\" \\\n  --request POST \\\n  --data @payload.json \\\n  https://app.terraform.io/api/v2/organizations/my-org/projects\n</code></pre></p>"},{"location":"07-Terraform-Cloud-and-Enterprise/01-terraform-cloud-enterprise/#project-features","title":"Project Features","text":"<p>1. Team Access: - Assign teams to projects - Control workspace access at project level - Inherit permissions to child workspaces</p> <p>2. Policy Sets: - Assign Sentinel policy sets to projects - All workspaces in project inherit policies - Override at workspace level if needed</p> <p>3. Cost Tracking: - View cost estimates across project workspaces - Track spending by project - Budget alerts per project</p> <p>4. Workspace Organization: - Filter workspaces by project - Group related infrastructure - Better visibility and management</p>"},{"location":"07-Terraform-Cloud-and-Enterprise/01-terraform-cloud-enterprise/#example-project-based-organization","title":"Example: Project-Based Organization","text":"<pre><code># Workspace configuration for a project\nterraform {\n  cloud {\n    organization = \"my-org\"\n\n    workspaces {\n      tags = [\"production\", \"web\"]\n      # Workspace will be in \"Production\" project\n    }\n  }\n}\n</code></pre> <p>Best Practices: - Organize by environment (Production, Staging, Development) - Group by application or service - Use consistent naming conventions - Apply policies at project level when possible</p>"},{"location":"07-Terraform-Cloud-and-Enterprise/01-terraform-cloud-enterprise/#4-remote-execution-runs","title":"4. Remote Execution (Runs)","text":""},{"location":"07-Terraform-Cloud-and-Enterprise/01-terraform-cloud-enterprise/#how-runs-work","title":"How Runs Work","text":"<p>Run = A single execution of <code>terraform plan</code> or <code>terraform apply</code> in HCP Terraform.</p> <p>Types of runs: 1. VCS-driven: Triggered by commits to connected repository 2. API-triggered: Created via API 3. UI-triggered: Manual runs from HCP Terraform UI 4. CLI-driven: <code>terraform plan/apply</code> queued to HCP Terraform (if configured)</p>"},{"location":"07-Terraform-Cloud-and-Enterprise/01-terraform-cloud-enterprise/#run-workflow","title":"Run Workflow","text":"<pre><code>1. Commit to GitHub\n   \u2193\n2. HCP Terraform detects change\n   \u2193\n3. Creates new run\n   \u2193\n4. Queues plan\n   \u2193\n5. Executes terraform plan remotely\n   \u2193\n6. Shows plan in UI\n   \u2193\n7. Apply (manual or auto)\n   \u2193\n8. Updates state\n</code></pre>"},{"location":"07-Terraform-Cloud-and-Enterprise/01-terraform-cloud-enterprise/#run-states","title":"Run States","text":"<ul> <li>Pending: Waiting to start</li> <li>Planning: Running <code>terraform plan</code></li> <li>Planned: Plan complete, waiting for apply</li> <li>Applying: Running <code>terraform apply</code></li> <li>Applied: Successfully applied</li> <li>Errored: Failed</li> </ul>"},{"location":"07-Terraform-Cloud-and-Enterprise/01-terraform-cloud-enterprise/#auto-apply","title":"Auto-Apply","text":"<p>Auto-apply automatically applies plans that pass: - Can be enabled per workspace - Useful for development environments - Should be disabled for production</p>"},{"location":"07-Terraform-Cloud-and-Enterprise/01-terraform-cloud-enterprise/#5-policy-as-code-with-sentinel","title":"5. Policy as Code with Sentinel","text":""},{"location":"07-Terraform-Cloud-and-Enterprise/01-terraform-cloud-enterprise/#what-is-sentinel","title":"What is Sentinel?","text":"<p>Sentinel is HashiCorp's Policy as Code framework that enforces policies on Terraform runs in HCP Terraform.</p> <p>Policy types: - Hard mandatory: Blocks run if violated - Soft mandatory: Warns but allows override - Advisory: Only warnings</p>"},{"location":"07-Terraform-Cloud-and-Enterprise/01-terraform-cloud-enterprise/#common-policy-examples","title":"Common Policy Examples","text":""},{"location":"07-Terraform-Cloud-and-Enterprise/01-terraform-cloud-enterprise/#policy-1-restrict-vm-sizes","title":"Policy 1: Restrict VM Sizes","text":"<pre><code>import \"tfplan\"\n\nallowed_sizes = [\"Standard_B1s\", \"Standard_B2s\", \"Standard_D2s_v3\"]\n\nmain = rule {\n  all tfplan.resource_changes as _, rc {\n    rc.type is not \"azurerm_linux_virtual_machine\" or\n    rc.change.after.size in allowed_sizes\n  }\n}\n</code></pre> <p>What it does: Only allows specific VM Sizes.</p>"},{"location":"07-Terraform-Cloud-and-Enterprise/01-terraform-cloud-enterprise/#policy-2-require-tags","title":"Policy 2: Require Tags","text":"<pre><code>import \"tfplan\"\n\nrequired_tags = [\"Environment\", \"Owner\", \"CostCenter\"]\n\nmain = rule {\n  all tfplan.resource_changes as _, rc {\n    rc.change.after.tags is undefined or\n    all required_tags as tag {\n      tag in rc.change.after.tags\n    }\n  }\n}\n</code></pre> <p>What it does: Ensures all resources have required tags.</p>"},{"location":"07-Terraform-Cloud-and-Enterprise/01-terraform-cloud-enterprise/#policy-3-block-public-storage-accounts","title":"Policy 3: Block Public Storage Accounts","text":"<pre><code>import \"tfplan\"\n\nmain = rule {\n  all tfplan.resource_changes as _, rc {\n    rc.type is not \"azurerm_storage_account\" or\n    rc.change.after.allow_blob_public_access is false\n  }\n}\n</code></pre> <p>What it does: Prevents creation of publicly accessible Storage Accounts.</p>"},{"location":"07-Terraform-Cloud-and-Enterprise/01-terraform-cloud-enterprise/#when-policies-run","title":"When Policies Run","text":"<p>Policies are evaluated: - After plan, before apply - Can pass, warn, or fail the run - Failed policies block apply (if hard mandatory)</p>"},{"location":"07-Terraform-Cloud-and-Enterprise/01-terraform-cloud-enterprise/#policy-sets","title":"Policy Sets","text":"<p>Policy sets group policies and assign them to: - Organizations (all workspaces) - Projects (all workspaces in project) - Workspaces (specific workspaces)</p>"},{"location":"07-Terraform-Cloud-and-Enterprise/01-terraform-cloud-enterprise/#6-private-module-registry","title":"6. Private Module Registry","text":""},{"location":"07-Terraform-Cloud-and-Enterprise/01-terraform-cloud-enterprise/#what-is-the-private-module-registry","title":"What is the Private Module Registry?","text":"<p>Allows organizations to: - Publish modules internally - Version modules - Share modules across teams - Control access</p>"},{"location":"07-Terraform-Cloud-and-Enterprise/01-terraform-cloud-enterprise/#publishing-modules","title":"Publishing Modules","text":"<p>Via UI: 1. Connect VCS repository 2. HCP Terraform detects modules 3. Auto-publishes on tags/releases</p> <p>Module structure: <pre><code>terraform-azure-vpc/\n\u251c\u2500\u2500 main.tf\n\u251c\u2500\u2500 variables.tf\n\u251c\u2500\u2500 outputs.tf\n\u2514\u2500\u2500 README.md\n</code></pre></p> <p>Versioning: - Tag in Git: <code>v1.0.0</code> - HCP Terraform creates module version</p>"},{"location":"07-Terraform-Cloud-and-Enterprise/01-terraform-cloud-enterprise/#using-private-modules","title":"Using Private Modules","text":"<pre><code>module \"vnet\" {\n  source = \"app.terraform.io/my-org/azurerm-vnet/azure\"\n  version = \"1.0.0\"\n\n  cidr_block = \"10.0.0.0/16\"\n}\n</code></pre> <p>Source format: <pre><code>&lt;HOSTNAME&gt;/&lt;ORGANIZATION&gt;/&lt;MODULE-NAME&gt;/&lt;PROVIDER&gt;\n</code></pre></p>"},{"location":"07-Terraform-Cloud-and-Enterprise/01-terraform-cloud-enterprise/#7-vcs-integration","title":"7. VCS Integration","text":""},{"location":"07-Terraform-Cloud-and-Enterprise/01-terraform-cloud-enterprise/#supported-vcs-providers","title":"Supported VCS Providers","text":"<ul> <li>GitHub</li> <li>GitHub Enterprise</li> <li>GitLab</li> <li>GitLab Enterprise</li> <li>Bitbucket Cloud</li> <li>Bitbucket Server</li> <li>Azure DevOps</li> </ul>"},{"location":"07-Terraform-Cloud-and-Enterprise/01-terraform-cloud-enterprise/#vcs-driven-workflows","title":"VCS-Driven Workflows","text":"<p>Automatic runs on: - Push to main branch - Pull request creation - Pull request updates</p> <p>Branch-based workspaces: - Different workspace per branch - <code>terraform.workspace</code> maps to branch name</p>"},{"location":"07-Terraform-Cloud-and-Enterprise/01-terraform-cloud-enterprise/#vcs-configuration","title":"VCS Configuration","text":"<ol> <li>Connect VCS:</li> <li>OAuth connection</li> <li> <p>Repository access granted</p> </li> <li> <p>Workspace settings:</p> </li> <li>Select repository</li> <li>Set working directory (if needed)</li> <li> <p>Set branch/tag</p> </li> <li> <p>Auto-apply settings:</p> </li> <li>Enable/disable auto-apply</li> <li>Which branches trigger runs</li> </ol>"},{"location":"07-Terraform-Cloud-and-Enterprise/01-terraform-cloud-enterprise/#8-cost-estimation","title":"8. Cost Estimation","text":""},{"location":"07-Terraform-Cloud-and-Enterprise/01-terraform-cloud-enterprise/#what-is-cost-estimation","title":"What is Cost Estimation?","text":"<p>HCP Terraform can estimate infrastructure costs for planned changes.</p> <p>Shows: - Monthly cost for new resources - Cost changes from updates - Total estimated cost</p> <p>Requires: - Cost estimation API enabled - Workspace with cost estimation configured</p>"},{"location":"07-Terraform-Cloud-and-Enterprise/01-terraform-cloud-enterprise/#9-team-collaboration-features","title":"9. Team Collaboration Features","text":""},{"location":"07-Terraform-Cloud-and-Enterprise/01-terraform-cloud-enterprise/#features","title":"Features","text":"<p>1. Access Control: - Organization members - Team permissions - Workspace access</p> <p>2. Run Notifications: - Slack - Email - Webhooks - Microsoft Teams</p> <p>3. Run Comments: - Add comments to runs - Request reviews - Track decisions</p> <p>4. Audit Logs: - Track who did what - When changes were made - Policy decisions</p>"},{"location":"07-Terraform-Cloud-and-Enterprise/01-terraform-cloud-enterprise/#10-practice-questions","title":"10. Practice Questions","text":""},{"location":"07-Terraform-Cloud-and-Enterprise/01-terraform-cloud-enterprise/#question-1","title":"Question 1","text":"<p>What is the main difference between Terraform CLI workspaces and HCP Terraform workspaces? A) They are the same concept B) CLI workspaces are for environments, Cloud workspaces are separate configurations C) Cloud workspaces don't support state D) CLI workspaces are cloud-based</p> Show Answer Answer: **B** - CLI workspaces use multiple state files for the same configuration (environment separation). HCP Terraform workspaces are separate configurations, each with their own state, variables, and settings."},{"location":"07-Terraform-Cloud-and-Enterprise/01-terraform-cloud-enterprise/#question-2","title":"Question 2","text":"<p>What is Sentinel used for in HCP Terraform? A) Managing state files B) Executing Terraform runs C) Policy as Code - enforcing rules on Terraform plans D) Storing modules</p> Show Answer Answer: **C** - Sentinel is the Policy as Code framework that enforces policies on Terraform runs, blocking or warning on policy violations."},{"location":"07-Terraform-Cloud-and-Enterprise/01-terraform-cloud-enterprise/#question-3","title":"Question 3","text":"<p>How do you reference a private module from HCP Terraform's registry? A) <code>source = \"./modules/vnet\"</code> B) <code>source = \"app.terraform.io/org/vnet/azure\"</code> C) <code>source = \"hashicorp/vnet/azure\"</code> D) <code>source = \"git::https://github.com/org/vnet\"</code></p> Show Answer Answer: **B** - Private modules use the format `app.terraform.io///`. Option C is the public registry format."},{"location":"07-Terraform-Cloud-and-Enterprise/01-terraform-cloud-enterprise/#question-4","title":"Question 4","text":"<p>What are Projects used for in HCP Terraform? A) Storing Terraform state files B) Organizing and grouping related workspaces C) Executing Terraform runs D) Managing provider versions</p> Show Answer Answer: **B** - Projects are used to organize and group related workspaces together, providing better management, access control, and policy assignment at the project level."},{"location":"07-Terraform-Cloud-and-Enterprise/01-terraform-cloud-enterprise/#11-key-takeaways","title":"11. Key Takeaways","text":"<ul> <li>HCP Terraform (formerly Terraform Cloud) provides managed remote state, remote execution, and collaboration features.</li> <li>HCP Terraform workspaces are different from CLI workspaces - they're separate configurations, not environment variants.</li> <li>Projects organize workspaces into logical groups for better management, access control, and policy assignment.</li> <li>Sentinel enforces Policy as Code, blocking or warning on policy violations.</li> <li>Private Module Registry allows organizations to publish and version internal modules.</li> <li>VCS Integration enables automatic runs on commits and pull requests.</li> <li>Runs execute Terraform operations remotely with full history and collaboration.</li> <li>Auto-apply can automatically apply plans (use carefully in production).</li> </ul>"},{"location":"07-Terraform-Cloud-and-Enterprise/01-terraform-cloud-enterprise/#references","title":"References","text":"<ul> <li>HCP Terraform Documentation</li> <li>HCP Terraform Projects</li> <li>Sentinel Language</li> <li>Private Module Registry</li> <li>VCS-driven Workflow</li> </ul>"},{"location":"08-Security-and-Best-Practices/","title":"Security and Terraform Best Practices","text":""},{"location":"08-Security-and-Best-Practices/#what-youll-learn","title":"What you'll learn","text":"<ul> <li>Protect sensitive data in Terraform configurations and state.</li> <li>Integrate encryption services like KMS and secret managers.</li> <li>Apply policy as code to enforce guardrails.</li> <li>Audit Terraform usage and rotate credentials safely.</li> </ul>"},{"location":"08-Security-and-Best-Practices/#topics","title":"Topics","text":"<ul> <li>Secrets Management</li> </ul>"},{"location":"08-Security-and-Best-Practices/#cheat-sheet","title":"Cheat sheet","text":"<ul> <li>Sensitive variables: <code>variable \"password\" { type = string, sensitive = true }</code></li> <li>Local file secrets: avoid committing <code>.tfvars</code>; use <code>.gitignore</code>.</li> <li>Encrypt state: enable S3 bucket encryption and DynamoDB locking.</li> <li>Policy enforcement: Sentinel or third-party policy engines before apply.</li> </ul>"},{"location":"08-Security-and-Best-Practices/#official-documentation","title":"Official documentation","text":"<ul> <li>Sensitive Data Handling</li> <li>Security Best Practices</li> </ul>"},{"location":"08-Security-and-Best-Practices/#hands-on-task","title":"Hands-on task","text":"<p>Create a variables file and encrypt it with GPG: <pre><code>cat &lt;&lt;'HCL' &gt; secrets.auto.tfvars\nroot_password = \"CorrectHorseBatteryStaple\"\nHCL\ngpg -c secrets.auto.tfvars\nrm secrets.auto.tfvars\n</code></pre> Inspect the encrypted <code>secrets.auto.tfvars.gpg</code> file into source control safely.</p>"},{"location":"08-Security-and-Best-Practices/01-secrets-management/","title":"Secrets Management","text":""},{"location":"08-Security-and-Best-Practices/01-secrets-management/#learning-objectives","title":"Learning Objectives","text":"<ul> <li>Understand best practices for handling secrets in Terraform.</li> <li>Learn different methods for managing sensitive data.</li> <li>Understand the limitations of <code>sensitive = true</code>.</li> <li>Explore integration with external secret management systems.</li> </ul>"},{"location":"08-Security-and-Best-Practices/01-secrets-management/#1-why-secrets-management-matters","title":"1. Why Secrets Management Matters","text":""},{"location":"08-Security-and-Best-Practices/01-secrets-management/#the-problem","title":"The Problem","text":"<p>Terraform configurations often need sensitive data: - Database passwords - API keys - Private keys - Access tokens - Connection strings</p> <p>Challenges: - Secrets shouldn't be in version control - State files may contain secrets (even if marked sensitive) - Secrets need to be accessible to Terraform but secure</p>"},{"location":"08-Security-and-Best-Practices/01-secrets-management/#common-mistakes","title":"Common Mistakes","text":"<p>\u274c Don't do this: <pre><code># BAD - Hardcoded secret\nresource \"azurerm_mssql_server\" \"main\" {\n  password = \"MySecretPassword123!\"\n}\n\n# BAD - In .tfvars committed to Git\npassword = \"MySecretPassword123!\"\n\n# BAD - Default value in code\nvariable \"db_password\" {\n  default = \"password123\"  # Visible in code!\n}\n</code></pre></p>"},{"location":"08-Security-and-Best-Practices/01-secrets-management/#2-terraforms-sensitive-true","title":"2. Terraform's <code>sensitive = true</code>","text":""},{"location":"08-Security-and-Best-Practices/01-secrets-management/#what-it-does","title":"What It Does","text":"<pre><code>variable \"db_password\" {\n  description = \"Database password\"\n  type        = string\n  sensitive   = true\n}\n\noutput \"connection_string\" {\n  value       = \"postgresql://user:${var.db_password}@host/db\"\n  sensitive   = true\n}\n</code></pre> <p>What <code>sensitive = true</code> does: - \u2705 Redacts value from CLI output - \u2705 Hides in <code>terraform plan</code> output - \u2705 Masks in logs</p> <p>What it doesn't do: - \u274c Doesn't encrypt in state file - \u274c Doesn't prevent storage in state - \u274c Doesn't protect from state file access</p>"},{"location":"08-Security-and-Best-Practices/01-secrets-management/#limitations","title":"Limitations","text":"<pre><code># Value is hidden in output\nterraform output\nconnection_string = (sensitive value)\n\n# But still in state file!\nterraform state show azurerm_mssql_server.main | grep password\npassword = \"MySecretPassword123!\"\n</code></pre> <p>Key point: <code>sensitive = true</code> is for display only, not encryption.</p>"},{"location":"08-Security-and-Best-Practices/01-secrets-management/#3-methods-for-managing-secrets","title":"3. Methods for Managing Secrets","text":""},{"location":"08-Security-and-Best-Practices/01-secrets-management/#method-1-environment-variables","title":"Method 1: Environment Variables","text":"<p>Best for: Simple secrets, single-user scenarios</p> <pre><code>export TF_VAR_sql_password=\"MySecretPassword123!\"\nterraform apply\n</code></pre> <p>Pros: - Not in code or files - Easy to set per environment - Works with CI/CD secrets</p> <p>Cons: - Visible in process list - Need to export before each run - No versioning or rotation</p>"},{"location":"08-Security-and-Best-Practices/01-secrets-management/#method-2-tfvars-files-not-committed","title":"Method 2: .tfvars Files (Not Committed)","text":"<pre><code># terraform.tfvars (NOT committed to Git)\ndb_password = \"MySecretPassword123!\"\n</code></pre> <p>Add to .gitignore: <pre><code>*.tfvars\n*.tfvars.json\nsecrets.tfvars\n*.auto.tfvars\n</code></pre></p> <p>Pros: - Easy to manage - Can version control structure (without values) - Works with multiple environments</p> <p>Cons: - Files can be accidentally committed - Need careful <code>.gitignore</code> management - Multiple files to manage</p>"},{"location":"08-Security-and-Best-Practices/01-secrets-management/#method-3-azure-key-vault-data-source","title":"Method 3: Azure Key Vault Data Source","text":"<p>Best for: Azure environments, rotating secrets</p> <pre><code>data \"azurerm_key_vault\" \"key_vault\" {\n  name                = \"key-vault-01\"\n  resource_group_name = \"mgmt-rg-01\"\n}\n\ndata \"azurerm_key_vault_secret\" \"server_password\" {\n  name         = \"admin-pw\"\n  key_vault_id = data.azurerm_key_vault.key_vault.id\n}\n</code></pre> <p>Pros: - Centralized secret management - Automatic rotation support - Audit logging - Encryption at rest</p> <p>Cons: - Azure-specific - Requires Secrets Manager permissions - Cost per secret</p>"},{"location":"08-Security-and-Best-Practices/01-secrets-management/#method-4-hashicorp-vault-integration","title":"Method 4: HashiCorp Vault Integration","text":"<p>Best for: Multi-cloud, enterprise environments</p> <pre><code>terraform {\n  required_providers {\n    vault = {\n      source  = \"hashicorp/vault\"\n      version = \"~&gt; 3.0\"\n    }\n  }\n}\n\nprovider \"vault\" {\n  address = \"https://vault.example.com:8200\"\n  # Token from environment variable VAULT_TOKEN\n}\n\ndata \"vault_generic_secret\" \"db_password\" {\n  path = \"secret/database/password\"\n}\n\nresource \"azurerm_mssql_server \" \"main\" {\n  password = data.vault_generic_secret.db_password.data[\"password\"]\n}\n</code></pre> <p>Pros: - Multi-cloud support - Dynamic secrets - Fine-grained access control - Audit logging</p> <p>Cons: - Requires Vault infrastructure - More complex setup - Learning curve</p>"},{"location":"08-Security-and-Best-Practices/01-secrets-management/#method-5-cicd-secret-variables","title":"Method 5: CI/CD Secret Variables","text":"<p>Best for: Automated pipelines</p> <p>GitHub Actions example: <pre><code>- name: Terraform Apply\n  env:\n    TF_VAR_db_password: ${{ secrets.DB_PASSWORD }}\n  run: terraform apply\n</code></pre></p> <p>GitLab CI example: <pre><code>variables:\n  TF_VAR_db_password: $CI_JOB_TOKEN\n\nterraform:\n  script:\n    - terraform apply\n</code></pre></p> <p>Pros: - Integrated with CI/CD - No files to manage - Per-repository secrets</p> <p>Cons: - CI/CD platform specific - Need to configure in platform UI</p>"},{"location":"08-Security-and-Best-Practices/01-secrets-management/#4-best-practices","title":"4. Best Practices","text":""},{"location":"08-Security-and-Best-Practices/01-secrets-management/#1-never-commit-secrets","title":"1. Never Commit Secrets","text":"<p>Use .gitignore: <pre><code>*.tfvars\n*.tfvars.json\n*.auto.tfvars\nsecrets/\n.env\n</code></pre></p> <p>Verify before commit: <pre><code># Check for potential secrets\ngit diff --cached | grep -i password\ngit diff --cached | grep -i secret\ngit diff --cached | grep -i key\n</code></pre></p>"},{"location":"08-Security-and-Best-Practices/01-secrets-management/#2-protect-state-files","title":"2. Protect State Files","text":"<p>State files contain secrets: <pre><code># State file has all resource attributes\nterraform state pull | grep password\n</code></pre></p> <p>Protect state files: - \u2705 Use remote backends (S3, Terraform Cloud) - \u2705 Enable encryption at rest - \u2705 Restrict access with IAM - \u2705 Enable versioning - \u2705 Use <code>sensitive = true</code> (display protection)</p>"},{"location":"08-Security-and-Best-Practices/01-secrets-management/#3-use-external-secret-managers","title":"3. Use External Secret Managers","text":"<p>For production: - AWS Secrets Manager - HashiCorp Vault - Azure Key Vault - Google Secret Manager</p> <p>Benefits: - Centralized management - Rotation support - Audit trails - Access control</p>"},{"location":"08-Security-and-Best-Practices/01-secrets-management/#4-use-separate-variable-files","title":"4. Use Separate Variable Files","text":"<p>Structure: <pre><code>.\n\u251c\u2500\u2500 terraform.tfvars          # Non-sensitive values (committed)\n\u251c\u2500\u2500 secrets.tfvars            # Secrets (NOT committed)\n\u2514\u2500\u2500 .gitignore                # Ignore secrets.tfvars\n</code></pre></p> <p>Usage: <pre><code>terraform apply -var-file=terraform.tfvars -var-file=secrets.tfvars\n</code></pre></p>"},{"location":"08-Security-and-Best-Practices/01-secrets-management/#5-rotate-secrets-regularly","title":"5. Rotate Secrets Regularly","text":"<p>If using Secrets Manager: - Enable automatic rotation - Update Terraform when secrets rotate</p> <p>If using environment variables: - Update CI/CD secret variables - Notify team of changes</p>"},{"location":"08-Security-and-Best-Practices/01-secrets-management/#6-use-sensitive-outputs-sparingly","title":"6. Use Sensitive Outputs Sparingly","text":"<pre><code># Only mark truly sensitive outputs\noutput \"db_password\" {\n  value     = azurerm_mssql_server .main.password\n  sensitive = true\n}\n</code></pre> <p>Avoid outputting secrets unless necessary: - Use data sources to fetch when needed - Don't output passwords just to view them</p>"},{"location":"08-Security-and-Best-Practices/01-secrets-management/#5-real-world-example-database-password","title":"5. Real-World Example: Database Password","text":""},{"location":"08-Security-and-Best-Practices/01-secrets-management/#scenario","title":"Scenario","text":"<p>Create an SQL instance with a secure password from Azure Keyvault</p> <p>Step 1: Create secret in Azure (one-time setup): <pre><code>az keyvault create \\\n  --name myKeyVault \\\n  --resource-group myResourceGroup \\\n  --location uksouth\n\naz keyvault secret set \\\n  --vault-name myKeyVault \\\n  --name prd-sql-password \\\n  --value \"$(openssl rand -base64 32)\"\n</code></pre></p> <p>Step 2: Terraform configuration: <pre><code>data \"azurerm_key_vault\" \"key_vault\" {\n  name                = \"key-vault-01\"\n  resource_group_name = \"mgmt-rg-01\"\n}\n\ndata \"azurerm_key_vault_secret\" \"server_password\" {\n  name         = \"prd-sql-password\"\n  key_vault_id = data.azurerm_key_vault.key_vault.id\n}\n\nresource \"azurerm_mssql_server\" \"example\" {\n  name                         = \"example-resource\"\n  resource_group_name          = azurerm_resource_group.example.name\n  location                     = azurerm_resource_group.example.location\n  version                      = \"12.0\"\n  administrator_login          = \"Example-Administrator\"\n  administrator_login_password = data.azurerm_key_vault_secret.server_password\n  minimum_tls_version          = \"1.2\"\n\n  azuread_administrator {\n    login_username = azurerm_user_assigned_identity.example.name\n    object_id      = azurerm_user_assigned_identity.example.principal_id\n  }\n\n  identity {\n    type         = \"UserAssigned\"\n    identity_ids = [azurerm_user_assigned_identity.example.id]\n  }\n\n  primary_user_assigned_identity_id            = azurerm_user_assigned_identity.example.id\n  transparent_data_encryption_key_vault_key_id = azurerm_key_vault_key.example.id\n}\n</code></pre></p> <p>Step 3: Apply: <pre><code>terraform apply\n# Password never appears in output or logs\n</code></pre></p>"},{"location":"08-Security-and-Best-Practices/01-secrets-management/#6-state-file-security","title":"6. State File Security","text":""},{"location":"08-Security-and-Best-Practices/01-secrets-management/#the-state-file-problem","title":"The State File Problem","text":"<p>State files contain ALL resource attributes, including secrets:</p> <pre><code>{\n  \"resources\": [\n    {\n      \"type\": \"azurerm_mssql_server\",\n      \"instances\": [\n        {\n          \"attributes\": {\n            \"password\": \"MySecretPassword123!\",\n            \"endpoint\": \"db.example.com\"\n          }\n        }\n      ]\n    }\n  ]\n}\n</code></pre>"},{"location":"08-Security-and-Best-Practices/01-secrets-management/#solutions","title":"Solutions","text":"<p>1. Use Remote Backends: <pre><code>data \"terraform_remote_state\" \"vdc\" {\n  backend = \"azurerm\"\n  config = {\n    resource_group_name  = \"tfstate-rg-01\"\n    storage_account_name = \"tfstatesa\"\n    container_name       = \"tfstate\"\n    key                  = \"test.tfstate\"\n    subscription_id = var.subscription\n  }\n}\n</code></pre></p> <p>2. Enable Encryption: - Encryption is enabled by default on Azure Blob Storage </p> <p>3. Restrict Access:</p> <p>Create a role assignment for the Terraform identity</p> <pre><code>az role assignment create \\\n  --assignee \"&lt;terraform-principal-id-or-object-id&gt;\" \\\n  --role \"Storage Blob Data Contributor\" \\\n  --scope \"/subscriptions/&lt;sub-id&gt;/resourceGroups/&lt;rg&gt;/providers/Microsoft.Storage/storageAccounts/&lt;account&gt;/blobServices/default/containers/&lt;container&gt;\"\n</code></pre> <p>Restrict network access</p> <pre><code>az storage account update \\\n  --name &lt;account&gt; \\\n  --resource-group &lt;rg&gt; \\\n  --default-action Deny\n\naz storage account network-rule add \\\n  --resource-group &lt;rg&gt; \\\n  --account-name &lt;account&gt; \\\n  --vnet-name &lt;vnet&gt; \\\n  --subnet &lt;subnet&gt;\n</code></pre> <p>Or use Private endpoint only</p> <pre><code>az network private-endpoint create \\\n  --name &lt;pe-name&gt; \\\n  --resource-group &lt;rg&gt; \\\n  --vnet-name &lt;vnet&gt; \\\n  --subnet &lt;subnet&gt; \\\n  --private-connection-resource-id \"/subscriptions/&lt;sub-id&gt;/resourceGroups/&lt;rg&gt;/providers/Microsoft.Storage/storageAccounts/&lt;account&gt;\" \\\n  --group-id blob \\\n  --connection-name &lt;connection-name&gt;\n</code></pre> <p>4. Use Terraform Cloud: - Automatic encryption - Access controls - Audit logs</p>"},{"location":"08-Security-and-Best-Practices/01-secrets-management/#7-practice-questions","title":"7. Practice Questions","text":""},{"location":"08-Security-and-Best-Practices/01-secrets-management/#question-1","title":"Question 1","text":"<p>What does <code>sensitive = true</code> do for a variable or output? A) Encrypts the value in the state file B) Prevents the value from being stored in state C) Hides the value from CLI output but still stores it in state D) Requires the value to be provided via secret manager</p> Show Answer Answer: **C** - `sensitive = true` only hides values from CLI output and logs. The value is still stored in the state file in plaintext. For true security, use external secret management and protect state files."},{"location":"08-Security-and-Best-Practices/01-secrets-management/#question-2","title":"Question 2","text":"<p>What is the best practice for managing database passwords in production Terraform configurations? A) Store in terraform.tfvars committed to Git B) Use Azure Key Vault or similar external secret management C) Hardcode in the resource block D) Use default values in variable definitions</p> Show Answer Answer: **B** - For production, use external secret management systems like AWS Secrets Manager, HashiCorp Vault, or Azure Key Vault. These provide encryption, rotation, and access control."},{"location":"08-Security-and-Best-Practices/01-secrets-management/#question-3","title":"Question 3","text":"<p>Why is it important to protect Terraform state files? A) State files are required for terraform plan B) State files may contain sensitive data including secrets C) State files are large and slow to download D) State files can only be used once</p> Show Answer Answer: **B** - State files contain all resource attributes, including sensitive values like passwords, even if marked with `sensitive = true`. Always use encrypted remote backends and restrict access."},{"location":"08-Security-and-Best-Practices/01-secrets-management/#8-key-takeaways","title":"8. Key Takeaways","text":"<ul> <li><code>sensitive = true</code> only hides values from CLI output - they're still in state files.</li> <li>Never commit secrets to version control - use <code>.gitignore</code> for <code>.tfvars</code> files with secrets.</li> <li>Use external secret managers (Azure Key Vault, etc) for production environments.</li> <li>Protect state files with encryption, access controls, and remote backends.</li> <li>Environment variables (<code>TF_VAR_*</code>) are simple but have limitations.</li> <li>State files contain all attributes including secrets - always encrypt and restrict access.</li> <li>Rotate secrets regularly and update Terraform configurations accordingly.</li> </ul>"},{"location":"08-Security-and-Best-Practices/01-secrets-management/#references","title":"References","text":"<ul> <li>Terraform Sensitive Variables</li> <li>AzureRM Key Vault</li> <li>HashiCorp Vault Provider</li> <li>State File Security</li> </ul>"}]}